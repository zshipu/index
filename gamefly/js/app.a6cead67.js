var qe=[{en:"Red",cn:"\u7EA2\u8272",pinyin:"h\xF3ng s\xE8",phonetic:"/red/",image:"images/color/red.png"},{en:"Orange",cn:"\u6A59\u8272",pinyin:"ch\xE9ng s\xE8",phonetic:"/\u02C8\u0254\u02D0r\u026And\u0292/",image:"images/color/orange.png"},{en:"Yellow",cn:"\u9EC4\u8272",pinyin:"hu\xE1ng s\xE8",phonetic:"/\u02C8jelo\u028A/",image:"images/color/yellow.png"},{en:"Green",cn:"\u7EFF\u8272",pinyin:"l\u01DC s\xE8",phonetic:"/\u0261ri\u02D0n/",image:"images/color/green.png"},{en:"Blue",cn:"\u84DD\u8272",pinyin:"l\xE1n s\xE8",phonetic:"/blu\u02D0/",image:"images/color/blue.png"},{en:"Purple",cn:"\u7D2B\u8272",pinyin:"z\u01D0 s\xE8",phonetic:"/\u02C8p\u025C\u02D0rpl/",image:"images/color/purple.png"},{en:"Pink",cn:"\u7C89\u8272",pinyin:"f\u011Bn s\xE8",phonetic:"/p\u026A\u014Bk/",image:"images/color/pink.png"},{en:"Brown",cn:"\u68D5\u8272",pinyin:"z\u014Dng s\xE8",phonetic:"/bra\u028An/",image:"images/color/brown.png"},{en:"Black",cn:"\u9ED1\u8272",pinyin:"h\u0113i s\xE8",phonetic:"/bl\xE6k/",image:"images/color/black.png"},{en:"White",cn:"\u767D\u8272",pinyin:"b\xE1i s\xE8",phonetic:"/wa\u026At/",image:"images/color/white.png"},{en:"Gray",cn:"\u7070\u8272",pinyin:"hu\u012B s\xE8",phonetic:"/\u0261re\u026A/",image:"images/color/gray.png"},{en:"Cyan",cn:"\u9752\u8272",pinyin:"q\u012Bng s\xE8",phonetic:"/\u02C8sa\u026A\u0259n/",image:"images/color/cyan.png"},{en:"Lime",cn:"\u9EC4\u7EFF\u8272",pinyin:"hu\xE1ng l\u01DC s\xE8",phonetic:"/la\u026Am/",image:"images/color/lime.png"},{en:"Light Blue",cn:"\u6D45\u84DD\u8272",pinyin:"qi\u01CEn l\xE1n s\xE8",phonetic:"/la\u026At blu\u02D0/",image:"images/color/light_blue.png"},{en:"Magenta",cn:"\u73AB\u7EA2\u8272",pinyin:"m\xE9i h\xF3ng s\xE8",phonetic:"/m\u0259\u02C8d\u0292ent\u0259/",image:"images/color/magenta.png"},{en:"Gold",cn:"\u91D1\u8272",pinyin:"j\u012Bn s\xE8",phonetic:"/\u0261o\u028Ald/",image:"images/color/gold.png"},{en:"Silver",cn:"\u94F6\u8272",pinyin:"y\xEDn s\xE8",phonetic:"/\u02C8s\u026Alv\u0259r/",image:"images/color/silver.png"},{en:"Navy",cn:"\u85CF\u9752\u8272",pinyin:"z\xE0ng q\u012Bng s\xE8",phonetic:"/\u02C8ne\u026Avi/",image:"images/color/navy.png"}],Ge=[{en:"Apple",cn:"\u82F9\u679C",pinyin:"p\xEDng gu\u01D2",phonetic:"/\u02C8\xE6pl/",image:"images/fruit/apple.png"},{en:"Banana",cn:"\u9999\u8549",pinyin:"xi\u0101ng ji\u0101o",phonetic:"/b\u0259\u02C8n\xE6n\u0259/",image:"images/fruit/banana.png"},{en:"Orange",cn:"\u6A59\u5B50",pinyin:"ch\xE9ng zi",phonetic:"/\u02C8\u0254\u02D0r\u026And\u0292/",image:"images/fruit/orange.png"},{en:"Grape",cn:"\u8461\u8404",pinyin:"p\xFA tao",phonetic:"/\u0261re\u026Ap/",image:"images/fruit/grape.png"},{en:"Strawberry",cn:"\u8349\u8393",pinyin:"c\u01CEo m\xE9i",phonetic:"/\u02C8str\u0254\u02D0beri/",image:"images/fruit/strawberry.png"},{en:"Watermelon",cn:"\u897F\u74DC",pinyin:"x\u012B gu\u0101",phonetic:"/\u02C8w\u0254\u02D0t\u0259rmel\u0259n/",image:"images/fruit/watermelon.png"},{en:"Pineapple",cn:"\u83E0\u841D",pinyin:"b\u014D lu\xF3",phonetic:"/\u02C8pa\u026An\xE6pl/",image:"images/fruit/pineapple.png"},{en:"Pear",cn:"\u68A8",pinyin:"l\xED",phonetic:"/per/",image:"images/fruit/pear.png"},{en:"Cherry",cn:"\u6A31\u6843",pinyin:"y\u012Bng t\xE1o",phonetic:"/\u02C8t\u0283eri/",image:"images/fruit/cherry.png"},{en:"Peach",cn:"\u6843\u5B50",pinyin:"t\xE1o zi",phonetic:"/pi\u02D0t\u0283/",image:"images/fruit/peach.png"},{en:"Lemon",cn:"\u67E0\u6AAC",pinyin:"n\xEDng m\xE9ng",phonetic:"/\u02C8lem\u0259n/",image:"images/fruit/lemon.png"},{en:"Mango",cn:"\u8292\u679C",pinyin:"m\xE1ng gu\u01D2",phonetic:"/\u02C8m\xE6\u014B\u0261o\u028A/",image:"images/fruit/mango.png"},{en:"Kiwi",cn:"\u7315\u7334\u6843",pinyin:"m\xED h\xF3u t\xE1o",phonetic:"/\u02C8ki\u02D0wi/",image:"images/fruit/kiwi.png"},{en:"Blueberry",cn:"\u84DD\u8393",pinyin:"l\xE1n m\xE9i",phonetic:"/\u02C8blu\u02D0beri/",image:"images/fruit/blueberry.png"},{en:"Avocado",cn:"\u725B\u6CB9\u679C",pinyin:"ni\xFA y\xF3u gu\u01D2",phonetic:"/\u02CC\xE6v\u0259\u02C8k\u0251\u02D0do\u028A/",image:"images/fruit/avocado.png"},{en:"Coconut",cn:"\u6930\u5B50",pinyin:"y\u0113 zi",phonetic:"/\u02C8ko\u028Ak\u0259n\u028Ct/",image:"images/fruit/coconut.png"},{en:"Pomegranate",cn:"\u77F3\u69B4",pinyin:"sh\xED liu",phonetic:"/\u02C8p\u0251\u02D0m\u026A\u0261r\xE6n\u026At/",image:"images/fruit/pomegranate.png"},{en:"Raspberry",cn:"\u8986\u76C6\u5B50",pinyin:"f\xF9 p\xE9n zi",phonetic:"/\u02C8r\xE6zberi/",image:"images/fruit/raspberry.png"}],ze=[{en:"Lion",cn:"\u72EE\u5B50",pinyin:"sh\u012B zi",phonetic:"/\u02C8la\u026A\u0259n/",image:"images/animal/lion.png"},{en:"Tiger",cn:"\u8001\u864E",pinyin:"l\u01CEo h\u01D4",phonetic:"/\u02C8ta\u026A\u0261\u0259r/",image:"images/animal/tiger.png"},{en:"Elephant",cn:"\u5927\u8C61",pinyin:"d\xE0 xi\xE0ng",phonetic:"/\u02C8el\u026Af\u0259nt/",image:"images/animal/elephant.png"},{en:"Giraffe",cn:"\u957F\u9888\u9E7F",pinyin:"ch\xE1ng j\u01D0ng l\xF9",phonetic:"/d\u0292\u0259\u02C8r\xE6f/",image:"images/animal/giraffe.png"},{en:"Monkey",cn:"\u7334\u5B50",pinyin:"h\xF3u zi",phonetic:"/\u02C8m\u028C\u014Bki/",image:"images/animal/monkey.png"},{en:"Bear",cn:"\u718A",pinyin:"xi\xF3ng",phonetic:"/ber/",image:"images/animal/bear.png"},{en:"Fox",cn:"\u72D0\u72F8",pinyin:"h\xFA li",phonetic:"/f\u0251\u02D0ks/",image:"images/animal/fox.png"},{en:"Panda",cn:"\u718A\u732B",pinyin:"xi\xF3ng m\u0101o",phonetic:"/\u02C8p\xE6nd\u0259/",image:"images/animal/panda.png"},{en:"Zebra",cn:"\u6591\u9A6C",pinyin:"b\u0101n m\u01CE",phonetic:"/\u02C8zi\u02D0br\u0259/",image:"images/animal/zebra.png"},{en:"Dog",cn:"\u72D7",pinyin:"g\u01D2u",phonetic:"/d\u0254\u02D0\u0261/",image:"images/animal/dog.png"},{en:"Cat",cn:"\u732B",pinyin:"m\u0101o",phonetic:"/k\xE6t/",image:"images/animal/cat.png"},{en:"Rabbit",cn:"\u5154\u5B50",pinyin:"t\xF9 zi",phonetic:"/\u02C8r\xE6b\u026At/",image:"images/animal/rabbit.png"},{en:"Cow",cn:"\u5976\u725B",pinyin:"n\u01CEi ni\xFA",phonetic:"/ka\u028A/",image:"images/animal/cow.png"},{en:"Pig",cn:"\u732A",pinyin:"zh\u016B",phonetic:"/p\u026A\u0261/",image:"images/animal/pig.png"},{en:"Sheep",cn:"\u7EF5\u7F8A",pinyin:"mi\xE1n y\xE1ng",phonetic:"/\u0283i\u02D0p/",image:"images/animal/sheep.png"},{en:"Rooster",cn:"\u516C\u9E21",pinyin:"g\u014Dng j\u012B",phonetic:"/\u02C8ru\u02D0st\u0259r/",image:"images/animal/rooster.png"},{en:"Duck",cn:"\u9E2D\u5B50",pinyin:"y\u0101 zi",phonetic:"/d\u028Ck/",image:"images/animal/duck.png"},{en:"Horse",cn:"\u9A6C",pinyin:"m\u01CE",phonetic:"/h\u0254\u02D0rs/",image:"images/animal/horse.png"}],We=[{en:"Tractor",cn:"\u62D6\u62C9\u673A",pinyin:"tu\u014D l\u0101 j\u012B",phonetic:"/\u02C8tr\xE6kt\u0259r/",image:"images/vehicle/tractor.png"},{en:"Excavator",cn:"\u6316\u6398\u673A",pinyin:"w\u0101 ju\xE9 j\u012B",phonetic:"/\u02C8eksk\u0259ve\u026At\u0259r/",image:"images/vehicle/excavator.png"},{en:"Dump Truck",cn:"\u81EA\u5378\u8F66",pinyin:"z\xEC xi\xE8 ch\u0113",phonetic:"/d\u028Cmp tr\u028Ck/",image:"images/vehicle/dump_truck.png"},{en:"Cement Mixer",cn:"\u6405\u62CC\u8F66",pinyin:"ji\u01CEo b\xE0n ch\u0113",phonetic:"/s\u026A\u02C8ment \u02C8m\u026Aks\u0259r/",image:"images/vehicle/cement_mixer.png"},{en:"Garbage Truck",cn:"\u5783\u573E\u8F66",pinyin:"l\u0101 j\u012B ch\u0113",phonetic:"/\u02C8\u0261\u0251\u02D0rb\u026Ad\u0292 tr\u028Ck/",image:"images/vehicle/garbage_truck.png"},{en:"Tow Truck",cn:"\u62D6\u8F66",pinyin:"tu\u014D ch\u0113",phonetic:"/to\u028A tr\u028Ck/",image:"images/vehicle/tow_truck.png"},{en:"Ice Cream Truck",cn:"\u51B0\u6DC7\u6DCB\u8F66",pinyin:"b\u012Bng q\xED l\xEDn ch\u0113",phonetic:"/a\u026As kri\u02D0m tr\u028Ck/",image:"images/vehicle/ice_cream_truck.png"},{en:"Van",cn:"\u8D27\u8F66",pinyin:"hu\xF2 ch\u0113",phonetic:"/v\xE6n/",image:"images/vehicle/van.png"},{en:"Jeep",cn:"\u5409\u666E\u8F66",pinyin:"j\xED p\u01D4 ch\u0113",phonetic:"/d\u0292i\u02D0p/",image:"images/vehicle/jeep.png"},{en:"Police Car",cn:"\u8B66\u8F66",pinyin:"j\u01D0ng ch\u0113",phonetic:"/p\u0259\u02C8li\u02D0s k\u0251\u02D0r/",image:"images/vehicle/police_car.png"},{en:"Fire Truck",cn:"\u6D88\u9632\u8F66",pinyin:"xi\u0101o f\xE1ng ch\u0113",phonetic:"/fa\u026A\u0259r tr\u028Ck/",image:"images/vehicle/fire_truck.png"},{en:"Ambulance",cn:"\u6551\u62A4\u8F66",pinyin:"ji\xF9 h\xF9 ch\u0113",phonetic:"/\u02C8\xE6mbj\u0259l\u0259ns/",image:"images/vehicle/ambulance.png"},{en:"Taxi",cn:"\u51FA\u79DF\u8F66",pinyin:"ch\u016B z\u016B ch\u0113",phonetic:"/\u02C8t\xE6ksi/",image:"images/vehicle/taxi.png"},{en:"School Bus",cn:"\u6821\u8F66",pinyin:"xi\xE0o ch\u0113",phonetic:"/sku\u02D0l b\u028Cs/",image:"images/vehicle/school_bus.png"},{en:"Car",cn:"\u8F7F\u8F66",pinyin:"ji\xE0o ch\u0113",phonetic:"/k\u0251\u02D0r/",image:"images/vehicle/car.png"},{en:"Race Car",cn:"\u8D5B\u8F66",pinyin:"s\xE0i ch\u0113",phonetic:"/re\u026As k\u0251\u02D0r/",image:"images/vehicle/race_car.png"},{en:"Sports Car",cn:"\u8DD1\u8F66",pinyin:"p\u01CEo ch\u0113",phonetic:"/sp\u0254\u02D0rts k\u0251\u02D0r/",image:"images/vehicle/sports_car.png"},{en:"Pickup Truck",cn:"\u76AE\u5361",pinyin:"p\xED k\u01CE",phonetic:"/\u02C8p\u026Ak\u028Cp tr\u028Ck/",image:"images/vehicle/pickup_truck.png"}],$e=[{en:"Excavator",cn:"\u6316\u6398\u673A",pinyin:"w\u0101 ju\xE9 j\u012B",phonetic:"/\u02C8eksk\u0259ve\u026At\u0259r/",image:"images/construction/excavator2.png"},{en:"Bulldozer",cn:"\u63A8\u571F\u673A",pinyin:"tu\u012B t\u01D4 j\u012B",phonetic:"/\u02C8b\u028Aldo\u028Az\u0259r/",image:"images/construction/bulldozer.png"},{en:"Wheel Loader",cn:"\u88C5\u8F7D\u673A",pinyin:"zhu\u0101ng z\xE0i j\u012B",phonetic:"/wi\u02D0l \u02C8lo\u028Ad\u0259r/",image:"images/construction/wheel_loader.png"},{en:"Dump Truck",cn:"\u81EA\u5378\u8F66",pinyin:"z\xEC xi\xE8 ch\u0113",phonetic:"/d\u028Cmp tr\u028Ck/",image:"images/construction/dump_truck2.png"},{en:"Concrete Mixer",cn:"\u6DF7\u51DD\u571F\u6405\u62CC\u8F66",pinyin:"h\xF9n n\xEDng t\u01D4 ji\u01CEo b\xE0n ch\u0113",phonetic:"/\u02C8k\u0251\u02D0nkri\u02D0t \u02C8m\u026Aks\u0259r/",image:"images/construction/concrete_mixer.png"},{en:"Crane",cn:"\u540A\u8F66",pinyin:"di\xE0o ch\u0113",phonetic:"/kre\u026An/",image:"images/construction/crane.png"},{en:"Road Roller",cn:"\u538B\u8DEF\u673A",pinyin:"y\u0101 l\xF9 j\u012B",phonetic:"/ro\u028Ad \u02C8ro\u028Al\u0259r/",image:"images/construction/road_roller.png"},{en:"Forklift",cn:"\u53C9\u8F66",pinyin:"ch\u0101 ch\u0113",phonetic:"/\u02C8f\u0254\u02D0rkl\u026Aft/",image:"images/construction/forklift.png"},{en:"Grader",cn:"\u5E73\u5730\u673A",pinyin:"p\xEDng d\xEC j\u012B",phonetic:"/\u02C8\u0261re\u026Ad\u0259r/",image:"images/construction/grader.png"},{en:"Tower Crane",cn:"\u5854\u540A",pinyin:"t\u01CE di\xE0o",phonetic:"/\u02C8ta\u028A\u0259r kre\u026An/",image:"images/construction/tower_crane.png"},{en:"Mining Truck",cn:"\u77FF\u8F66",pinyin:"ku\xE0ng ch\u0113",phonetic:"/\u02C8ma\u026An\u026A\u014B tr\u028Ck/",image:"images/construction/mining_truck.png"},{en:"Paver",cn:"\u644A\u94FA\u673A",pinyin:"t\u0101n p\xF9 j\u012B",phonetic:"/\u02C8pe\u026Av\u0259r/",image:"images/construction/paver.png"},{en:"Concrete Pump",cn:"\u6DF7\u51DD\u571F\u6CF5\u8F66",pinyin:"h\xF9n n\xEDng t\u01D4 b\xE8ng ch\u0113",phonetic:"/\u02C8k\u0251\u02D0nkri\u02D0t p\u028Cmp/",image:"images/construction/concrete_pump.png"},{en:"Backhoe",cn:"\u6316\u6398\u88C5\u8F7D\u673A",pinyin:"w\u0101 ju\xE9 zhu\u0101ng z\xE0i j\u012B",phonetic:"/\u02C8b\xE6kho\u028A/",image:"images/construction/backhoe.png"},{en:"Track Loader",cn:"\u5C65\u5E26\u88C5\u8F7D\u673A",pinyin:"l\u01DA d\xE0i zhu\u0101ng z\xE0i j\u012B",phonetic:"/tr\xE6k \u02C8lo\u028Ad\u0259r/",image:"images/construction/track_loader.png"}],A={color:{name:{en:"Colors",cn:"\u989C\u8272"},icon:"\u{1F3A8}",db:qe,type:"image"},fruit:{name:{en:"Fruits",cn:"\u6C34\u679C"},icon:"\u{1F34E}",db:Ge,type:"image"},animal:{name:{en:"Animals",cn:"\u52A8\u7269"},icon:"\u{1F981}",db:ze,type:"image"},vehicle:{name:{en:"Vehicles",cn:"\u8F66\u8F86"},icon:"\u{1F697}",db:We,type:"image"},construction:{name:{en:"Construction",cn:"\u5DE5\u7A0B\u673A\u68B0"},icon:"\u{1F69C}",db:$e,type:"image"}},j="color",B="en";function we(r){A[r]&&(j=r)}function be(r){(r==="en"||r==="cn")&&(B=r)}function N(){return B}function V(){return A[j]}function Ue(){return A[j].db}function Ce(){let r=Ue(),e=V(),t=[...r].sort(()=>Math.random()-.5),s=t[0],i=t.slice(0,4).sort(()=>Math.random()-.5),n=i.findIndex(l=>l.en===s.en),a=B==="en"?s.cn:s.en,o=i.map(l=>B==="en"?l.en:l.cn);return{correct:s,options:i,correctIndex:n,questionText:a,optionTexts:o,courseType:e.type,target:B,get name(){return s.en}}}var X=class{constructor(){this.synth=window.speechSynthesis,this.enabled="speechSynthesis"in window,this.unlocked=!1,this.preferredVoice=null,this.chineseVoice=null,this.voicesLoaded=!1,this._keepAliveTimer=null,this.muted=!1,this.warmedUp=!1,this.enabled&&(this.loadVoices(),this.synth.onvoiceschanged!==void 0&&(this.synth.onvoiceschanged=()=>this.loadVoices()),this._startKeepAlive())}_startKeepAlive(){this._keepAliveTimer=setInterval(()=>{this.synth.speaking&&(this.synth.pause(),this.synth.resume())},1e4)}loadVoices(){let e=this.synth.getVoices();if(e.length===0)return;this.voicesLoaded=!0;let t=["Samantha","Karen","Moira","Tessa","Fiona","Microsoft Zira","Microsoft Hazel","Google UK English Female","Google US English","Female","female"],s=["\u5A77\u5A77","Ting-Ting","\u7F8E\u5609","Mei-Jia","Microsoft Huihui","Microsoft Yaoyao","Google \u666E\u901A\u8BDD","Google \u666E\u901A\u8BDD\uFF08\u4E2D\u56FD\u5927\u9646\uFF09","Sin-ji"];for(let n of t){let a=e.find(o=>o.name.includes(n)&&o.lang.startsWith("en"));if(a){this.preferredVoice=a;break}}if(!this.preferredVoice){let n=e.find(a=>a.lang.startsWith("en")&&(a.name.toLowerCase().includes("female")||a.name.includes("Samantha")||!a.name.toLowerCase().includes("male")));n&&(this.preferredVoice=n)}for(let n of s){let a=e.find(o=>o.name.includes(n)&&(o.lang.startsWith("zh")||o.lang.includes("CN")));if(a){this.chineseVoice=a;break}}if(!this.chineseVoice){let n=e.find(a=>a.lang.startsWith("zh")||a.lang.includes("CN")||a.lang.includes("TW"));n&&(this.chineseVoice=n)}e.filter(n=>n.lang.startsWith("zh")||n.lang.includes("CN")).length>0}unlock(){if(!(!this.enabled||this.unlocked))try{let e=new SpeechSynthesisUtterance(" ");e.volume=.01,e.rate=10,this.synth.cancel(),this.synth.speak(e),this.unlocked=!0,setTimeout(()=>this.loadVoices(),500)}catch{}}async warmUp(){return!this.enabled||this.warmedUp?!0:new Promise(e=>{let t=new SpeechSynthesisUtterance("test");t.volume=.01,t.rate=2,this.preferredVoice&&(t.voice=this.preferredVoice);let s=!1,i=n=>{s||(s=!0,this.warmedUp=n,e(n))};t.onend=()=>i(!0),t.onerror=n=>{i(!1)},setTimeout(()=>i(!1),2e3),this.synth.cancel(),this.synth.speak(t)})}isReady(){return this.enabled&&this.unlocked&&this.voicesLoaded}isUnlocked(){return this.unlocked}speak(e,t={}){if(!this.enabled||this.muted)return Promise.resolve();let{rate:s=.85,pitch:i=1.15,lang:n="en-US",volume:a=1,timeout:o=5e3}=t;return this.synth.cancel(),new Promise(l=>{setTimeout(()=>{let c=new SpeechSynthesisUtterance(e);c.rate=s,c.pitch=i,c.lang=n,c.volume=a,this.preferredVoice&&(c.voice=this.preferredVoice);let h=!1,m=()=>{h||(h=!0,clearTimeout(u),l())};c.onend=m,c.onerror=p=>{p.error!=="interrupted"&&p.error,m()};let u=setTimeout(()=>{h||m()},o);this.synth.speak(c),setTimeout(()=>{!h&&!this.synth.speaking&&(this.synth.cancel(),this.synth.speak(c))},100)},50)})}speakChinese(e,t={}){if(!this.enabled||this.muted)return Promise.resolve();let{rate:s=.9,pitch:i=1.1,volume:n=1,timeout:a=5e3}=t;return this.synth.cancel(),new Promise(o=>{setTimeout(()=>{let d=new SpeechSynthesisUtterance(e);d.rate=s,d.pitch=i,d.volume=n,d.lang="zh-CN",this.chineseVoice&&(d.voice=this.chineseVoice);let c=!1,h=()=>{c||(c=!0,clearTimeout(m),o())};d.onend=h,d.onerror=u=>{u.error!=="interrupted"&&u.error,h()};let m=setTimeout(()=>{c||h()},a);this.synth.speak(d),setTimeout(()=>{!c&&!this.synth.speaking&&(this.synth.cancel(),this.synth.speak(d))},100)},50)})}hasChineseVoice(){return this.chineseVoice!==null}speakWord(e){return this.speak(e,{rate:.8,pitch:1.1,timeout:3e3})}speakFeedback(e){if(e){let t=["Great!","Excellent!","Perfect!","Good job!","Wonderful!"],s=t[Math.floor(Math.random()*t.length)];return this.speak(s,{rate:.95,pitch:1.2,timeout:2e3})}else return this.speak("Try again!",{rate:.85,pitch:1,timeout:2e3})}speakWelcome(e="Colors",t="en"){if(t==="cn"){let s=this.getCourseNameCn(e);return this.speakChinese(`\u6211\u4EEC\u6765\u5B66\u4E60${s}\uFF01`,{rate:.9,timeout:3e3})}else return this.speak(`Let's learn ${e}!`,{rate:.9,pitch:1.15,timeout:3e3})}getCourseNameCn(e){return{Colors:"\u989C\u8272",Fruits:"\u6C34\u679C",Animals:"\u52A8\u7269",Vehicles:"\u8F66\u8F86",Construction:"\u5DE5\u7A0B\u673A\u68B0"}[e]||e}stop(){this.enabled&&this.synth.cancel()}setMuted(e){this.muted=e,e&&this.stop()}isMuted(){return this.muted}destroy(){this.stop(),this._keepAliveTimer&&(clearInterval(this._keepAliveTimer),this._keepAliveTimer=null)}},x=new X;var K=class{constructor(){this.clouds=[],this.particles=[],this.initialized=!1}init(){if(this.initialized)return;let e=window.innerWidth,t=window.innerHeight;for(let s=0;s<4;s++)this.clouds.push({x:Math.random()*e,y:Math.random()*t,r:60+Math.random()*80,speed:.2,opacity:.2});for(let s=0;s<5;s++)this.clouds.push({x:Math.random()*e,y:Math.random()*t,r:30+Math.random()*40,speed:.7,opacity:.5});for(let s=0;s<15;s++)this.particles.push({x:Math.random()*e,y:Math.random()*t,size:Math.random()*3,speedY:(Math.random()-.5)*.5,opacity:Math.random()*.6});this.initialized=!0}updateAndDraw(e,t,s){e.fillStyle="white",this.particles.forEach(i=>{i.y-=i.speedY,i.x-=.1,i.x<0&&(i.x=t),i.y<0&&(i.y=s),i.y>s&&(i.y=0),e.globalAlpha=i.opacity,e.beginPath(),e.arc(i.x,i.y,i.size,0,Math.PI*2),e.fill()}),this.clouds.forEach(i=>{i.x-=i.speed,i.x<-i.r*2&&(i.x=t+i.r*2),e.globalAlpha=i.opacity,e.fillStyle="#FFFFFF",e.beginPath(),e.arc(i.x,i.y,i.r,0,Math.PI*2),e.arc(i.x+i.r*.7,i.y+i.r*.5,i.r*.8,0,Math.PI*2),e.arc(i.x-i.r*.7,i.y+i.r*.5,i.r*.8,0,Math.PI*2),e.fill()}),e.globalAlpha=1}},W=new K;var Ye={left:{x:0,y:0},right:{x:0,y:0}};function Q(r,e,t){let s=Ye[r];return s.x===0&&s.y===0?(s.x=e,s.y=t):(s.x=s.x+(e-s.x)*.3,s.y=s.y+(t-s.y)*.3),{x:s.x,y:s.y}}function je(){let r=document.getElementById("game-stage");if(r){let e=r.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}}function xe(r,e,t,s,i){let n=je(),a=n.width,o=n.height,l=Math.max(0,Math.min(1,r.x)),d=Math.max(0,Math.min(1,r.y)),c=(1-l)*a,h=d*o;return{x:c,y:h}}var $=40;function U(r,e,t){return r>=t.x-$&&r<=t.x+t.w+$&&e>=t.y-$&&e<=t.y+t.h+$}var Xe=50;function Ee(r,e){let t=e.getContext("2d"),s=e.width,i=e.height;t.drawImage(r,0,0,s,i);let a=t.getImageData(0,0,s,i).data,o=0,l=s*i;for(let c=0;c<a.length;c+=4)o+=.299*a[c]+.587*a[c+1]+.114*a[c+2];return o/l<Xe}var Se=null;function Te(){if(!("IntersectionObserver"in window))return;Se=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting?t.target.classList.remove("animation-paused"):t.target.classList.add("animation-paused")})},{threshold:.1}),document.querySelectorAll(".firefly, .sparkle, .floating-decoration").forEach(e=>Se.observe(e))}function Ke(){let r=navigator.hardwareConcurrency||2,e=navigator.deviceMemory||2,t=window.matchMedia("(prefers-reduced-motion: reduce)").matches;return r<=2||e<=2||t}function Ie(){Ke()&&(document.body.classList.add("low-performance-mode"),document.querySelectorAll(".firefly").forEach((e,t)=>{t>=2&&(e.style.display="none")}))}var ke=640,Le=480,Z=class{constructor(){this.detector=null,this.camera=null,this.videoElement=null,this.previewCanvas=null,this.previewCtx=null,this.onUpdate=null,this.initialized=!1,this.preloaded=!1,this.hands={left:{x:0,y:0,visible:!1},right:{x:0,y:0,visible:!1}},this.landmarks={left:null,right:null},this.noHandsFrameCount=0}async preload(){if(!this.preloaded)try{this.detector=new window.Hands({locateFile:e=>`https://cdn.jsdmirror.com/npm/@mediapipe/hands/${e}`}),this.detector.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.6,minTrackingConfidence:.5}),await this.detector.initialize(),this.preloaded=!0}catch{}}isPreloaded(){return this.preloaded}async init(e,t){if(this.previewCanvas=e,this.previewCtx=e.getContext("2d"),this.onUpdate=t,!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.showCameraError("camera-api");return}try{this.preloaded||await this.preload(),this.detector.onResults(s=>this.processResults(s)),this.videoElement=document.createElement("video"),this.videoElement.setAttribute("playsinline",""),this.camera=new window.Camera(this.videoElement,{onFrame:async()=>{this.detector&&this.initialized&&await this.detector.send({image:this.videoElement})},width:ke,height:Le,facingMode:"user"}),await this.camera.start(),this.initialized=!0,this.hideCameraError()}catch(s){s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?this.showCameraError("permission"):s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?this.showCameraError("not-found"):s.name==="NotReadableError"||s.name==="TrackStartError"?this.showCameraError("in-use"):this.showCameraError("unknown")}}showCameraError(e){this.hideCameraError();let t={"camera-api":{title:"\u{1F4F7} \u6444\u50CF\u5934\u4E0D\u53EF\u7528",desc:"\u8BF7\u4F7F\u7528 HTTPS \u8BBF\u95EE\u7F51\u7AD9",hint:"\u5B89\u5353\u6D4F\u89C8\u5668\u9700\u8981 HTTPS \u624D\u80FD\u4F7F\u7528\u6444\u50CF\u5934"},permission:{title:"\u{1F6AB} \u6444\u50CF\u5934\u6743\u9650\u88AB\u62D2\u7EDD",desc:"\u8BF7\u5728\u6D4F\u89C8\u5668\u4E2D\u5141\u8BB8\u6444\u50CF\u5934\u8BBF\u95EE",hint:"\u5B89\u5353\uFF1A\u8BBE\u7F6E \u2192 \u5E94\u7528 \u2192 \u6D4F\u89C8\u5668 \u2192 \u6743\u9650 \u2192 \u6444\u50CF\u5934"},"not-found":{title:"\u{1F50D} \u672A\u627E\u5230\u6444\u50CF\u5934",desc:"\u8BF7\u786E\u4FDD\u8BBE\u5907\u6709\u524D\u7F6E\u6444\u50CF\u5934",hint:"\u68C0\u67E5\u662F\u5426\u6709\u5176\u4ED6\u5E94\u7528\u5360\u7528\u6444\u50CF\u5934"},"in-use":{title:"\u26A0\uFE0F \u6444\u50CF\u5934\u88AB\u5360\u7528",desc:"\u8BF7\u5173\u95ED\u5176\u4ED6\u4F7F\u7528\u6444\u50CF\u5934\u7684\u5E94\u7528",hint:"\u5173\u95ED\u89C6\u9891\u901A\u8BDD\u3001\u5F55\u5236\u7B49\u5E94\u7528\u540E\u91CD\u8BD5"},unknown:{title:"\u274C \u6444\u50CF\u5934\u521D\u59CB\u5316\u5931\u8D25",desc:"\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5",hint:"\u5B89\u5353\u5EFA\u8BAE\u4F7F\u7528 Chrome \u6D4F\u89C8\u5668"}},s=t[e]||t.unknown,i=document.createElement("div");i.id="camera-error",i.innerHTML=`
      <div class="camera-error-card">
        <div class="camera-error-title">${s.title}</div>
        <div class="camera-error-desc">${s.desc}</div>
        <div class="camera-error-hint">${s.hint}</div>
        <button class="camera-error-btn" onclick="location.reload()">\u5237\u65B0\u9875\u9762</button>
      </div>
    `,document.body.appendChild(i)}hideCameraError(){let e=document.getElementById("camera-error");e&&e.remove()}processResults(e){let t=window.innerWidth,s=window.innerHeight;this.previewCtx&&e.image&&(this.previewCtx.clearRect(0,0,320,240),this.previewCtx.drawImage(e.image,0,0,320,240)),this.hands.left.visible=!1,this.hands.right.visible=!1,this.landmarks.left=null,this.landmarks.right=null,e.multiHandLandmarks&&e.multiHandedness?(this.noHandsFrameCount=0,e.multiHandLandmarks.forEach((i,n)=>{let a=e.multiHandedness[n].label,o=i[9],l=location.hostname==="localhost"||location.hostname==="127.0.0.1";this.previewCtx&&l&&(this.previewCtx.fillStyle=a==="Left"?"#2196F3":"#FF6F00",this.previewCtx.beginPath(),this.previewCtx.arc(o.x*320,o.y*240,10,0,Math.PI*2),this.previewCtx.fill(),this.previewCtx.fillStyle="rgba(255, 255, 255, 0.7)",i.forEach(p=>{this.previewCtx.beginPath(),this.previewCtx.arc(p.x*320,p.y*240,3,0,Math.PI*2),this.previewCtx.fill()}));let d=xe(o,ke,Le,t,s),c=document.getElementById("game-stage"),h=c?c.getBoundingClientRect():null,m=h?h.width:t,u=h?h.height:s;if(a==="Left"){let p=Q("right",d.x,d.y);this.hands.right.x=Math.max(0,Math.min(p.x,m)),this.hands.right.y=Math.max(0,Math.min(p.y,u)),this.hands.right.visible=!0,this.landmarks.right=i}else{let p=Q("left",d.x,d.y);this.hands.left.x=Math.max(0,Math.min(p.x,m)),this.hands.left.y=Math.max(0,Math.min(p.y,u)),this.hands.left.visible=!0,this.landmarks.left=i}})):this.noHandsFrameCount++,this.onUpdate&&this.onUpdate(this.hands)}getHands(){return this.hands}hasHands(){return this.hands.left.visible||this.hands.right.visible}getNoHandsFrameCount(){return this.noHandsFrameCount}resetNoHandsCount(){this.noHandsFrameCount=0}getVideoElement(){return this.videoElement}stop(){this.camera&&this.camera.stop(),this.initialized=!1}isPeaceSign(){for(let e of["left","right"]){let t=this.landmarks[e];if(t&&this._checkPeaceGesture(t))return!0}return!1}_checkPeaceGesture(e){let c=e[8],h=e[6],m=e[12],u=e[10],p=e[16],g=e[14],E=e[20],_=e[18],Fe=c.y<h.y-.03,Be=m.y<u.y-.03,Ne=p.y>g.y-.02,Ve=E.y>_.y-.02;return Fe&&Be&&Ne&&Ve}getLandmarks(){return this.landmarks}},O=new Z;var f={NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_HIP:23,RIGHT_HIP:24},S={MIN_CONFIDENCE:.5,VISIBILITY_THRESHOLD:.65,ACTIVATION_Y_OFFSET:.05,OPACITY_FADE_IN_SPEED:.15,OPACITY_FADE_OUT_SPEED:.1,OPACITY_COLLISION_THRESHOLD:.7,SENSITIVITY_X:2.5,SENSITIVITY_Y_UP:2,SENSITIVITY_Y_DOWN:2,Y_OFFSET:0,SMOOTH_FACTOR_BASE:.15,SMOOTH_FACTOR_FAST:.4,VELOCITY_THRESHOLD:.02,DEAD_ZONE:.03,RAISE_HAND_HOLD_TIME:1e3},J=class{constructor(){this.detector=null,this.camera=null,this.videoElement=null,this.previewCanvas=null,this.previewCtx=null,this.onUpdate=null,this.initialized=!1,this.preloaded=!1,this.hands={left:{x:0,y:0,visible:!1,opacity:0,active:!1},right:{x:0,y:0,visible:!1,opacity:0,active:!1}},this.cursorOpacity={left:0,right:0},this.smoothedPositions={left:{x:.5,y:.5},right:{x:.5,y:.5}},this.lastPositions={left:{x:.5,y:.5},right:{x:.5,y:.5}},this.bodyAnchor={x:.5,y:.5},this.bodyScale=1,this.noHandsFrameCount=0,this.raiseHandState={startTime:null,isRaised:!1,confirmed:!1,progress:0},this.noseY=.5}async preload(){if(!this.preloaded)try{this.detector=new window.Pose({locateFile:e=>`https://cdn.jsdmirror.com/npm/@mediapipe/pose/${e}`}),this.detector.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,minDetectionConfidence:S.MIN_CONFIDENCE,minTrackingConfidence:S.MIN_CONFIDENCE}),await this.detector.initialize(),this.preloaded=!0}catch{}}isPreloaded(){return this.preloaded}async init(e,t){if(this.previewCanvas=e,this.previewCtx=e.getContext("2d"),this.onUpdate=t,!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.showCameraError("camera-api");return}try{this.preloaded||await this.preload(),this.detector.onResults(n=>this.processResults(n)),this.videoElement=document.createElement("video"),this.videoElement.setAttribute("playsinline",""),this.camera=new window.Camera(this.videoElement,{onFrame:async()=>{this.detector&&this.initialized&&await this.detector.send({image:this.videoElement})},width:640,height:480,facingMode:"user"});let s=3,i=null;for(;s>0;)try{await this.camera.start();break}catch(n){i=n,s--,s>0&&await new Promise(a=>setTimeout(a,200))}if(s===0&&i)throw i;this.initialized=!0,this.hideCameraError()}catch(s){s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?this.showCameraError("permission"):s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?this.showCameraError("not-found"):s.name==="NotReadableError"||s.name==="TrackStartError"?this.showCameraError("in-use"):this.showCameraError("unknown")}}showCameraError(e){this.hideCameraError();let t={"camera-api":{title:"\u{1F4F7} \u6444\u50CF\u5934\u4E0D\u53EF\u7528",desc:"\u8BF7\u4F7F\u7528 HTTPS \u8BBF\u95EE\u7F51\u7AD9",hint:"\u5B89\u5353\u6D4F\u89C8\u5668\u9700\u8981 HTTPS \u624D\u80FD\u4F7F\u7528\u6444\u50CF\u5934"},permission:{title:"\u{1F6AB} \u6444\u50CF\u5934\u6743\u9650\u88AB\u62D2\u7EDD",desc:"\u8BF7\u5728\u6D4F\u89C8\u5668\u4E2D\u5141\u8BB8\u6444\u50CF\u5934\u8BBF\u95EE",hint:"\u5B89\u5353\uFF1A\u8BBE\u7F6E \u2192 \u5E94\u7528 \u2192 \u6D4F\u89C8\u5668 \u2192 \u6743\u9650 \u2192 \u6444\u50CF\u5934"},"not-found":{title:"\u{1F50D} \u672A\u627E\u5230\u6444\u50CF\u5934",desc:"\u8BF7\u786E\u4FDD\u8BBE\u5907\u6709\u524D\u7F6E\u6444\u50CF\u5934",hint:"\u68C0\u67E5\u662F\u5426\u6709\u5176\u4ED6\u5E94\u7528\u5360\u7528\u6444\u50CF\u5934"},"in-use":{title:"\u26A0\uFE0F \u6444\u50CF\u5934\u88AB\u5360\u7528",desc:"\u8BF7\u5173\u95ED\u5176\u4ED6\u4F7F\u7528\u6444\u50CF\u5934\u7684\u5E94\u7528",hint:"\u5173\u95ED\u89C6\u9891\u901A\u8BDD\u3001\u5F55\u5236\u7B49\u5E94\u7528\u540E\u91CD\u8BD5"},unknown:{title:"\u274C \u6444\u50CF\u5934\u521D\u59CB\u5316\u5931\u8D25",desc:"\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5",hint:"\u5B89\u5353\u5EFA\u8BAE\u4F7F\u7528 Chrome \u6D4F\u89C8\u5668"}},s=t[e]||t.unknown,i=document.createElement("div");i.id="camera-error",i.innerHTML=`
      <div class="camera-error-card">
        <div class="camera-error-title">${s.title}</div>
        <div class="camera-error-desc">${s.desc}</div>
        <div class="camera-error-hint">${s.hint}</div>
        <button class="camera-error-btn" onclick="location.reload()">\u5237\u65B0\u9875\u9762</button>
      </div>
    `,document.body.appendChild(i)}hideCameraError(){let e=document.getElementById("camera-error");e&&e.remove()}calculateBodyReference(e){let t=e[f.LEFT_SHOULDER],s=e[f.RIGHT_SHOULDER],i=e[f.NOSE];this.noseY=i.y,this.bodyAnchor={x:(t.x+s.x)/2,y:(t.y+s.y)/2};let n=Math.abs(t.x-s.x);return this.bodyScale=n/.3,{anchor:this.bodyAnchor,scale:this.bodyScale}}checkRaiseHandGesture(e){let t=e[f.LEFT_WRIST],s=e[f.RIGHT_WRIST],i=e[f.NOSE],n=t.visibility>S.MIN_CONFIDENCE&&t.y<i.y,a=s.visibility>S.MIN_CONFIDENCE&&s.y<i.y,o=n||a,l=Date.now();if(o){this.raiseHandState.isRaised||(this.raiseHandState.startTime=l,this.raiseHandState.isRaised=!0,this.raiseHandState.confirmed=!1);let d=l-this.raiseHandState.startTime;this.raiseHandState.progress=Math.min(1,d/S.RAISE_HAND_HOLD_TIME),d>=S.RAISE_HAND_HOLD_TIME&&!this.raiseHandState.confirmed&&(this.raiseHandState.confirmed=!0)}else this.raiseHandState.isRaised=!1,this.raiseHandState.startTime=null,this.raiseHandState.progress=0;return o}isRaiseHandConfirmed(){return this.raiseHandState.confirmed}getRaiseHandProgress(){return this.raiseHandState.progress}resetRaiseHandGesture(){this.raiseHandState.confirmed=!1,this.raiseHandState.progress=0}isHandActive(e,t){let s=t==="LEFT"?f.RIGHT_WRIST:f.LEFT_WRIST,i=t==="LEFT"?f.RIGHT_HIP:f.LEFT_HIP,n=e[s],a=e[i];return!(n.visibility<S.VISIBILITY_THRESHOLD||n.y>a.y+S.ACTIVATION_Y_OFFSET)}updateCursorOpacity(e,t){t?this.cursorOpacity[e]+=S.OPACITY_FADE_IN_SPEED:this.cursorOpacity[e]-=S.OPACITY_FADE_OUT_SPEED,this.cursorOpacity[e]=Math.max(0,Math.min(1,this.cursorOpacity[e]))}mapRelativeToScreen(e,t){let s=-(e.x-t.x),i=e.y-t.y;Math.abs(s)<S.DEAD_ZONE&&(s=0),Math.abs(i)<S.DEAD_ZONE&&(i=0);let n;i>0?n=.5+i*S.SENSITIVITY_Y_DOWN:n=.5+i*S.SENSITIVITY_Y_UP;let a=.5+s*S.SENSITIVITY_X;return a=Math.max(0,Math.min(1,a)),n=Math.max(0,Math.min(1,n)),{x:a,y:n}}smoothWithVelocity(e,t,s){let i=this.lastPositions[e],n=this.smoothedPositions[e],o=Math.sqrt(Math.pow(t-i.x,2)+Math.pow(s-i.y,2))>S.VELOCITY_THRESHOLD?S.SMOOTH_FACTOR_FAST:S.SMOOTH_FACTOR_BASE;return n.x=n.x+(t-n.x)*o,n.y=n.y+(s-n.y)*o,i.x=t,i.y=s,{x:n.x,y:n.y}}processResults(e){let t=window.innerWidth,s=window.innerHeight;if(this.previewCtx&&e.image&&(this.previewCtx.clearRect(0,0,320,240),this.previewCtx.drawImage(e.image,0,0,320,240)),this.hands.left.active=!1,this.hands.right.active=!1,e.poseLandmarks){this.noHandsFrameCount=0;let i=e.poseLandmarks,{anchor:n}=this.calculateBodyReference(i),a=i[f.LEFT_WRIST],o=i[f.RIGHT_WRIST],l=this.isHandActive(i,"RIGHT"),d=this.isHandActive(i,"LEFT");this.checkRaiseHandGesture(i);let c=location.hostname==="localhost"||location.hostname==="127.0.0.1";if(this.previewCtx&&c&&this.drawDebugInfo(i,n,l,d),this.updateCursorOpacity("right",l),this.updateCursorOpacity("left",d),l){let h=this.mapRelativeToScreen(a,n),m=this.smoothWithVelocity("right",h.x,h.y);this.hands.right.x=m.x*t,this.hands.right.y=m.y*s}if(this.hands.right.active=l,this.hands.right.opacity=this.cursorOpacity.right,this.hands.right.visible=this.cursorOpacity.right>.01,d){let h=this.mapRelativeToScreen(o,n),m=this.smoothWithVelocity("left",h.x,h.y);this.hands.left.x=m.x*t,this.hands.left.y=m.y*s}this.hands.left.active=d,this.hands.left.opacity=this.cursorOpacity.left,this.hands.left.visible=this.cursorOpacity.left>.01}else this.noHandsFrameCount++,this.updateCursorOpacity("left",!1),this.updateCursorOpacity("right",!1),this.hands.left.opacity=this.cursorOpacity.left,this.hands.left.visible=this.cursorOpacity.left>.01,this.hands.right.opacity=this.cursorOpacity.right,this.hands.right.visible=this.cursorOpacity.right>.01;this.onUpdate&&this.onUpdate(this.hands)}drawDebugInfo(e,t,s=!1,i=!1){let n=this.previewCtx,a={x:320,y:240};n.strokeStyle="rgba(255, 255, 255, 0.4)",n.lineWidth=2,[[f.LEFT_SHOULDER,f.RIGHT_SHOULDER],[f.LEFT_SHOULDER,f.LEFT_ELBOW],[f.LEFT_ELBOW,f.LEFT_WRIST],[f.RIGHT_SHOULDER,f.RIGHT_ELBOW],[f.RIGHT_ELBOW,f.RIGHT_WRIST],[f.LEFT_SHOULDER,f.LEFT_HIP],[f.RIGHT_SHOULDER,f.RIGHT_HIP],[f.LEFT_HIP,f.RIGHT_HIP]].forEach(([p,g])=>{let E=e[p],_=e[g];n.beginPath(),n.moveTo(E.x*a.x,E.y*a.y),n.lineTo(_.x*a.x,_.y*a.y),n.stroke()});let l=e[f.LEFT_HIP],d=e[f.RIGHT_HIP],c=((l.y+d.y)/2+S.ACTIVATION_Y_OFFSET)*a.y;n.strokeStyle="rgba(255, 100, 100, 0.6)",n.setLineDash([4,4]),n.beginPath(),n.moveTo(0,c),n.lineTo(a.x,c),n.stroke(),n.setLineDash([]),n.fillStyle="#FF4444",n.beginPath(),n.arc(t.x*a.x,t.y*a.y,8,0,Math.PI*2),n.fill();let h=e[f.LEFT_WRIST],m=e[f.RIGHT_WRIST];n.fillStyle=s?"#FF6F00":"rgba(150, 150, 150, 0.5)",n.beginPath(),n.arc(h.x*a.x,h.y*a.y,10,0,Math.PI*2),n.fill(),s&&(n.strokeStyle="#FF6F00",n.lineWidth=2,n.beginPath(),n.arc(h.x*a.x,h.y*a.y,14,0,Math.PI*2),n.stroke()),n.fillStyle=i?"#2196F3":"rgba(150, 150, 150, 0.5)",n.beginPath(),n.arc(m.x*a.x,m.y*a.y,10,0,Math.PI*2),n.fill(),i&&(n.strokeStyle="#2196F3",n.lineWidth=2,n.beginPath(),n.arc(m.x*a.x,m.y*a.y,14,0,Math.PI*2),n.stroke()),n.strokeStyle="rgba(255, 255, 0, 0.6)",n.setLineDash([5,5]),n.beginPath(),n.moveTo(t.x*a.x,t.y*a.y),n.lineTo(h.x*a.x,h.y*a.y),n.stroke(),n.beginPath(),n.moveTo(t.x*a.x,t.y*a.y),n.lineTo(m.x*a.x,m.y*a.y),n.stroke(),n.setLineDash([]);let u=e[f.NOSE];if(n.strokeStyle="rgba(0, 255, 0, 0.5)",n.setLineDash([3,3]),n.beginPath(),n.moveTo(0,u.y*a.y),n.lineTo(a.x,u.y*a.y),n.stroke(),n.setLineDash([]),this.raiseHandState.isRaised){let p=this.raiseHandState.progress;n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(60,200,200,20),n.fillStyle=p>=1?"#4CAF50":"#FFC107",n.fillRect(60,200,200*p,20),n.fillStyle="#fff",n.font="bold 12px sans-serif",n.textAlign="center",this.raiseHandState.confirmed?n.fillText("\u2713 \u4E3E\u624B\u786E\u8BA4!",160,215):n.fillText(`\u4E3E\u624B\u4E2D... ${Math.floor(p*100)}%`,160,215)}n.fillStyle="rgba(255, 255, 255, 0.9)",n.font="bold 10px sans-serif",n.textAlign="center",n.fillText("\u76F8\u5BF9\u5750\u6807\u6A21\u5F0F | \u4E3E\u624B1\u79D2\u89E6\u53D1",160,15),n.fillText(`\u80A9\u5BBD\u6BD4\u4F8B: ${this.bodyScale.toFixed(2)}`,160,230)}getHands(){return this.hands}hasHands(){return this.hands.left.visible||this.hands.right.visible}getNoHandsFrameCount(){return this.noHandsFrameCount}resetNoHandsCount(){this.noHandsFrameCount=0}getVideoElement(){return this.videoElement}stop(){this.camera&&this.camera.stop(),this.initialized=!1,this.smoothedPositions={left:{x:.5,y:.5},right:{x:.5,y:.5}},this.lastPositions={left:{x:.5,y:.5},right:{x:.5,y:.5}}}},H=new J;var C={HANDS:"hands",POSE:"pose"},Pe="colormaster_detector_mode",ee=class{constructor(){this.initialized=!1,this.currentMode=C.POSE,this.activeDetector=H,this._loadSavedMode()}_loadSavedMode(){let e=localStorage.getItem(Pe);e&&Object.values(C).includes(e)&&(this.currentMode=e,this.activeDetector=this._getDetectorByMode(e))}_getDetectorByMode(e){switch(e){case C.POSE:return H;case C.HANDS:default:return O}}getMode(){return this.currentMode}async setMode(e){Object.values(C).includes(e)&&(this.initialized&&this.currentMode!==e&&this.stop(),this.currentMode=e,this.activeDetector=this._getDetectorByMode(e),localStorage.setItem(Pe,e))}async preload(){await this.activeDetector.preload()}async preloadAll(){await Promise.all([O.preload(),H.preload()])}isPreloaded(){return this.activeDetector.isPreloaded()}isAllPreloaded(){return O.isPreloaded()&&H.isPreloaded()}async init(e,t){await this.activeDetector.init(e,t),this.initialized=!0}setOnUpdate(e){this.activeDetector&&this.activeDetector.onUpdate!==void 0&&(this.activeDetector.onUpdate=e)}getHands(){return this.activeDetector.getHands()}hasHands(){return this.activeDetector.hasHands()}getNoHandsFrameCount(){return this.activeDetector.getNoHandsFrameCount()}getVideoElement(){return this.activeDetector.getVideoElement()}stop(){this.activeDetector.stop(),this.initialized=!1}isConfirmGesture(){return this.currentMode===C.HANDS?O.isPeaceSign():this.currentMode===C.POSE?H.isRaiseHandConfirmed():!1}getConfirmGestureProgress(){return this.currentMode===C.POSE?H.getRaiseHandProgress():0}resetConfirmGesture(){this.currentMode===C.POSE&&H.resetRaiseHandGesture()}isPeaceSign(){return this.currentMode===C.HANDS?O.isPeaceSign():!1}getLandmarks(){return this.currentMode===C.HANDS?O.getLandmarks():{left:null,right:null}}getModeName(){return{[C.HANDS]:"\u624B\u90E8\u8FFD\u8E2A",[C.POSE]:"\u5168\u8EAB\u59FF\u6001"}[this.currentMode]||"\u672A\u77E5"}getModeDescription(){return{[C.HANDS]:"\u8FD1\u8DDD\u79BB\u624B\u90E8\u8FFD\u8E2A\uFF0C\u7CBE\u51C6\u8BC6\u522B\u624B\u638C",[C.POSE]:"\u5168\u8EAB\u59FF\u6001\u8FFD\u8E2A\uFF0C\u9002\u5408\u8FDC\u8DDD\u79BB\u6295\u5C4F"}[this.currentMode]||""}getAvailableModes(){return[{id:C.HANDS,name:"\u624B\u90E8\u6A21\u5F0F",description:"\u8FD1\u8DDD\u79BB\u624B\u90E8\u8FFD\u8E2A\uFF0C\u7CBE\u51C6\u8BC6\u522B\u624B\u638C",icon:"\u{1F590}\uFE0F",recommended:!0,detail:"\u8FFD\u8E2A\u624B\u638C\u4E2D\u5FC3\u70B9 (landmarks[9])"},{id:C.POSE,name:"\u5168\u8EAB\u6A21\u5F0F",description:"\u5168\u8EAB\u59FF\u6001\u8FFD\u8E2A\uFF0C\u9002\u5408\u8FDC\u8DDD\u79BB\u6295\u5C4F",icon:"\u{1F3C3}",recommended:!1,detail:"\u8FFD\u8E2A\u624B\u8155\u4F4D\u7F6E (landmarks[15/16])"}]}},b=new ee;var te=class{constructor(){let e=window.AudioContext||window.webkitAudioContext;this.ctx=new e,this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=.5,this.masterGain.connect(this.ctx.destination),this.enabled=!0,this.muted=!1}setMuted(e){this.muted=e,this.masterGain.gain.value=e?0:.5}isMuted(){return this.muted}async unlock(){this.ctx.state==="suspended"&&await this.ctx.resume(),this.play("silent")}play(e){if(!this.enabled)return;let t=this.ctx.currentTime,s=this.ctx.createOscillator(),i=this.ctx.createGain();switch(s.connect(i),i.connect(this.masterGain),e){case"correct":s.type="sine",s.frequency.setValueAtTime(880,t),s.frequency.exponentialRampToValueAtTime(1760,t+.1),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.6,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+.6),s.start(t),s.stop(t+.6);break;case"wrong":s.type="sawtooth",s.frequency.setValueAtTime(150,t),s.frequency.linearRampToValueAtTime(100,t+.3),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.05),i.gain.linearRampToValueAtTime(.01,t+.3),s.start(t),s.stop(t+.3);break;case"hover":s.type="sine",s.frequency.setValueAtTime(1200,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.1,t+.02),i.gain.linearRampToValueAtTime(.01,t+.05),s.start(t),s.stop(t+.05);break;case"tick":s.type="triangle",s.frequency.setValueAtTime(600,t),s.frequency.exponentialRampToValueAtTime(100,t+.1),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.5,t+.01),i.gain.exponentialRampToValueAtTime(.01,t+.1),s.start(t),s.stop(t+.1);break;case"swipe":s.type="sawtooth",s.frequency.setValueAtTime(2e3,t),s.frequency.exponentialRampToValueAtTime(400,t+.15),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.02),i.gain.exponentialRampToValueAtTime(.01,t+.15),s.start(t),s.stop(t+.15);break;case"combo":s.type="sine",s.frequency.setValueAtTime(523,t),s.frequency.setValueAtTime(659,t+.08),s.frequency.setValueAtTime(784,t+.16),s.frequency.setValueAtTime(1047,t+.24),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.5,t+.02),i.gain.setValueAtTime(.5,t+.3),i.gain.exponentialRampToValueAtTime(.01,t+.5),s.start(t),s.stop(t+.5);break;case"mega":s.type="square",s.frequency.setValueAtTime(261,t),s.frequency.setValueAtTime(329,t+.1),s.frequency.setValueAtTime(392,t+.2),s.frequency.setValueAtTime(523,t+.3),s.frequency.setValueAtTime(659,t+.4),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.05),i.gain.setValueAtTime(.4,t+.5),i.gain.exponentialRampToValueAtTime(.01,t+.8),s.start(t),s.stop(t+.8);break;case"silent":s.type="sine",i.gain.value=0,s.start(t),s.stop(t+.01);break}}},w=new te;var se=class{constructor(){this.canvas=null,this.ctx=null,this.points={left:[],right:[]},this.maxPoints=20,this.isRunning=!1,this._paused=!1,this.colors={right:{core:"#FFFFFF",glow:"#FF6F00",outer:"rgba(255, 111, 0, 0.3)"},left:{core:"#FFFFFF",glow:"#2196F3",outer:"rgba(33, 150, 243, 0.3)"}}}init(e){this.canvas=document.createElement("canvas"),this.canvas.id="trail-canvas",this.canvas.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 95;
    `,e.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()),this.isRunning=!0}pause(){this._paused=!0}resume(){this._paused=!1}resize(){if(!this.canvas)return;let e=document.getElementById("game-stage");if(e){let t=e.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}else this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}addPoint(e,t,s,i=0,n=1){let a=this.points[e];a.unshift({x:t,y:s,velocity:Math.min(i,50),alpha:1,handOpacity:n,timestamp:Date.now()}),a.length>this.maxPoints&&a.pop()}clearHand(e){this.points[e]=[]}draw(){this.ctx&&(this.checkResize(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawTrail("right"),this.drawTrail("left"))}checkResize(){let e=document.getElementById("game-stage");if(e){let t=e.getBoundingClientRect();(this.canvas.width!==t.width||this.canvas.height!==t.height)&&(this.canvas.width=t.width,this.canvas.height=t.height)}}drawTrail(e){let t=this.points[e];if(t.length<2)return;let s=this.colors[e],i=this.ctx,n=Date.now();for(t.forEach((l,d)=>{let c=n-l.timestamp;l.alpha=Math.max(0,1-c/300)});t.length>0&&t[t.length-1].alpha<=0;)t.pop();if(t.length<2)return;i.save(),i.lineCap="round",i.lineJoin="round",i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++){let d=t[l],c=t[l-1],h=(c.x+d.x)/2,m=(c.y+d.y)/2;i.quadraticCurveTo(c.x,c.y,h,m)}let a=6+(t[0].velocity||0)*.3;i.lineWidth=a+8,i.strokeStyle=this.createGradient(t,s.glow,.6),i.shadowColor=s.glow,i.shadowBlur=20,i.stroke(),i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++){let d=t[l],c=t[l-1],h=(c.x+d.x)/2,m=(c.y+d.y)/2;i.quadraticCurveTo(c.x,c.y,h,m)}let o=3+(t[0].velocity||0)*.15;i.lineWidth=o,i.strokeStyle=this.createGradient(t,s.core,1),i.shadowColor=s.core,i.shadowBlur=8,i.stroke(),i.restore(),t[0]&&t[0].velocity>15&&this.drawSparks(t[0],s)}createGradient(e,t,s){if(e.length<2)return t;let n=this.ctx.createLinearGradient(e[0].x,e[0].y,e[e.length-1].x,e[e.length-1].y);return e.forEach((a,o)=>{let l=o/(e.length-1),d=a.handOpacity!==void 0?a.handOpacity:1,c=a.alpha*s*d;if(t.startsWith("rgba")){let h=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);h&&n.addColorStop(l,`rgba(${h[1]}, ${h[2]}, ${h[3]}, ${c})`)}else if(t.startsWith("#")){let h=parseInt(t.slice(1,3),16),m=parseInt(t.slice(3,5),16),u=parseInt(t.slice(5,7),16);n.addColorStop(l,`rgba(${h}, ${m}, ${u}, ${c})`)}else n.addColorStop(l,t)}),n}drawSparks(e,t){let s=this.ctx,i=Math.min(3,Math.floor(e.velocity/15));for(let n=0;n<i;n++){let a=Math.random()*Math.PI*2,o=Math.random()*15+8,l=e.x+Math.cos(a)*o,d=e.y+Math.sin(a)*o,c=Math.random()*2+1;s.beginPath(),s.arc(l,d,c,0,Math.PI*2),s.fillStyle=t.core,s.shadowColor=t.glow,s.shadowBlur=6,s.fill()}}animate(){}destroy(){this.isRunning=!1,this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}},L=new se;var ie=class{constructor(){this.canvas=null,this.ctx=null,this.particles=[],this.isRunning=!1,this._paused=!1,this.config={star:{count:8,colors:["#FFD700","#FFA500","#FF6B6B","#4ECDC4"],minSize:10,maxSize:18,minSpeed:5,maxSpeed:15,gravity:.25,friction:.96,sparkle:!0},confetti:{count:12,colors:["#FF6B6B","#4ECDC4","#FFE66D","#F38181"],minSize:8,maxSize:12,minSpeed:4,maxSpeed:10,gravity:.15,friction:.97,tumble:!0},sparkle:{count:10,colors:["#FFFFFF","#FFFACD"],minSize:3,maxSize:6,minSpeed:2,maxSpeed:6,lifetime:20,fade:!0}},this.maxParticles=100}init(e){this.canvas=document.createElement("canvas"),this.canvas.id="particles-canvas",this.canvas.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 200;
    `,e.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()),this.isRunning=!0}pause(){this._paused=!0}resume(){this._paused=!1}updateAndDraw(){!this.isRunning||this._paused||(this.checkResize(),this.update(),this.draw())}checkResize(){let e=document.getElementById("game-stage");if(e){let t=e.getBoundingClientRect();(this.canvas.width!==t.width||this.canvas.height!==t.height)&&(this.canvas.width=t.width,this.canvas.height=t.height)}}resize(){if(!this.canvas)return;let e=document.getElementById("game-stage");if(e){let t=e.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}else this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}celebrate(e,t,s=1){let i=Math.min(s,3);this.emitStars(e,t,Math.floor(this.config.star.count*i)),this.emitConfetti(e,t,Math.floor(this.config.confetti.count*i)),this.emitSparkles(e,t,Math.floor(this.config.sparkle.count*i))}bigCelebrate(){let e=this.canvas.width/2,t=this.canvas.height/2;this.celebrate(e,t,1.5);for(let s=0;s<5;s++)setTimeout(()=>{if(this.particles.length<this.maxParticles){let i=Math.random()*this.canvas.width;this.emitConfetti(i,-20,2)}},s*100)}emitStars(e,t,s){if(this.particles.length>=this.maxParticles)return;let i=this.config.star,n=Math.min(s,this.maxParticles-this.particles.length);for(let a=0;a<n;a++){let o=Math.PI*2*a/n+Math.random()*.5,l=i.minSpeed+Math.random()*(i.maxSpeed-i.minSpeed);this.particles.push({type:"star",x:e,y:t,vx:Math.cos(o)*l,vy:Math.sin(o)*l-5,size:i.minSize+Math.random()*(i.maxSize-i.minSize),color:i.colors[Math.floor(Math.random()*i.colors.length)],rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,alpha:1,lifetime:35+Math.random()*20,age:0,gravity:i.gravity,friction:i.friction,sparklePhase:Math.random()*Math.PI*2})}}emitConfetti(e,t,s){if(this.particles.length>=this.maxParticles)return;let i=this.config.confetti,n=Math.min(s,this.maxParticles-this.particles.length);for(let a=0;a<n;a++){let o=-Math.PI/2+(Math.random()-.5)*Math.PI,l=i.minSpeed+Math.random()*(i.maxSpeed-i.minSpeed);this.particles.push({type:"confetti",x:e,y:t,vx:Math.cos(o)*l+(Math.random()-.5)*4,vy:Math.sin(o)*l,width:i.minSize+Math.random()*(i.maxSize-i.minSize),height:(i.minSize+Math.random()*(i.maxSize-i.minSize))*.6,color:i.colors[Math.floor(Math.random()*i.colors.length)],rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.4,tumbleX:Math.random()*Math.PI*2,tumbleY:Math.random()*Math.PI*2,alpha:1,lifetime:50+Math.random()*30,age:0,gravity:i.gravity,friction:i.friction})}}emitSparkles(e,t,s){if(this.particles.length>=this.maxParticles)return;let i=this.config.sparkle,n=Math.min(s,this.maxParticles-this.particles.length);for(let a=0;a<n;a++){let o=Math.random()*Math.PI*2,l=i.minSpeed+Math.random()*(i.maxSpeed-i.minSpeed);this.particles.push({type:"sparkle",x:e+(Math.random()-.5)*40,y:t+(Math.random()-.5)*40,vx:Math.cos(o)*l,vy:Math.sin(o)*l,size:i.minSize+Math.random()*(i.maxSize-i.minSize),color:i.colors[Math.floor(Math.random()*i.colors.length)],alpha:1,lifetime:i.lifetime+Math.random()*10,age:0})}}update(){for(let e=this.particles.length-1;e>=0;e--){let t=this.particles[e];if(t.age++,t.age>=t.lifetime){this.particles.splice(e,1);continue}if(t.y>this.canvas.height+50||t.x<-50||t.x>this.canvas.width+50){this.particles.splice(e,1);continue}t.x+=t.vx,t.y+=t.vy,t.gravity&&(t.vy+=t.gravity),t.friction&&(t.vx*=t.friction,t.vy*=t.friction),t.rotationSpeed&&(t.rotation+=t.rotationSpeed),t.type==="confetti"&&(t.tumbleX+=.15,t.tumbleY+=.2);let s=t.age/t.lifetime;s>.5&&(t.alpha=1-(s-.5)/.5)}}draw(){if(this.ctx){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e of this.particles){switch(this.ctx.save(),this.ctx.globalAlpha=e.alpha,this.ctx.translate(e.x,e.y),e.type){case"star":this.drawStar(e);break;case"confetti":this.drawConfetti(e);break;case"sparkle":this.drawSparkle(e);break}this.ctx.restore()}}}drawStar(e){let t=this.ctx;t.rotate(e.rotation);let s=e.size;t.fillStyle=e.color,t.beginPath();for(let i=0;i<5;i++){let n=i*Math.PI*2/5-Math.PI/2,a=Math.cos(n)*s,o=Math.sin(n)*s,l=n+Math.PI/5,d=Math.cos(l)*s*.4,c=Math.sin(l)*s*.4;i===0?t.moveTo(a,o):t.lineTo(a,o),t.lineTo(d,c)}t.closePath(),t.fill()}drawConfetti(e){let t=this.ctx,s=Math.cos(e.tumbleX),i=Math.cos(e.tumbleY);t.rotate(e.rotation),t.scale(s,i),t.fillStyle=e.color,t.fillRect(-e.width/2,-e.height/2,e.width,e.height)}drawSparkle(e){let t=this.ctx,s=e.size;t.fillStyle=e.color,t.beginPath(),t.arc(0,0,s,0,Math.PI*2),t.fill()}animate(){}destroy(){this.isRunning=!1,this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.particles=[]}},R=new ie;var ne=class{constructor(){this.audio=null,this.unlocked=!1,this.isPlaying=!1,this.normalVolume=.25,this.gameVolume=.08,this.volume=this.normalVolume,this.fadeInterval=null,this.muted=!1,this.playlist=["audio/bgm.mp3","audio/children-music-loop-creative-fun-262427.mp3","audio/children-game-114760.mp3"],this.currentIndex=-1}getNextTrack(){let e;do e=Math.floor(Math.random()*this.playlist.length);while(e===this.currentIndex&&this.playlist.length>1);return this.currentIndex=e,this.playlist[e]}init(){this.audio=new Audio,this.audio.volume=0,this.audio.preload="auto",this.audio.addEventListener("ended",()=>{this.isPlaying&&this.playNextTrack()})}playNextTrack(){let e=this.getNextTrack();this.audio.src=e,this.audio.volume=0;let t=this.audio.play();t!==void 0&&t.then(()=>{this.fadeIn(800)}).catch(s=>{})}unlock(){if(!this.unlocked){if(this.audio){this.audio.volume=0;let e=this.audio.play();e!==void 0&&e.then(()=>{this.audio.pause(),this.audio.currentTime=0,this.unlocked=!0}).catch(()=>{})}this.unlocked=!0}}play(e=1e3){if(!this.audio||this.isPlaying)return;this.isPlaying=!0;let t=this.getNextTrack();this.audio.src=t,this.audio.volume=0;let s=this.audio.play();s!==void 0&&s.then(()=>{this.fadeIn(e)}).catch(i=>{this.isPlaying=!1})}fadeIn(e=1e3){if(this.clearFade(),this.muted)return;let t=20,s=e/t,i=this.volume/t,n=0;this.fadeInterval=setInterval(()=>{if(n++,this.muted){this.clearFade(),this.audio.volume=0;return}this.audio.volume=Math.min(i*n,this.volume),n>=t&&(this.clearFade(),this.audio.volume=this.volume)},s)}stop(e=500){!this.audio||!this.isPlaying||this.fadeOut(e,()=>{this.audio.pause(),this.audio.currentTime=0,this.isPlaying=!1})}pause(e=300){!this.audio||!this.isPlaying||this.fadeOut(e,()=>{this.audio.pause()})}resume(e=300){if(!this.audio||!this.isPlaying)return;let t=this.audio.play();t!==void 0&&t.then(()=>{this.fadeIn(e)}).catch(()=>{})}fadeOut(e=500,t=null){this.clearFade();let s=20,i=e/s,n=this.audio.volume,a=n/s,o=0;this.fadeInterval=setInterval(()=>{o++,this.audio.volume=Math.max(n-a*o,0),o>=s&&(this.clearFade(),this.audio.volume=0,t&&t())},i)}clearFade(){this.fadeInterval&&(clearInterval(this.fadeInterval),this.fadeInterval=null)}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.audio&&this.isPlaying&&(this.audio.volume=this.volume)}enterGameMode(e=500){if(!this.audio||!this.isPlaying||(this.volume=this.gameVolume,this.muted))return;this.clearFade();let t=this.audio.volume,s=this.gameVolume,i=20,n=e/i,a=(t-s)/i,o=0;this.fadeInterval=setInterval(()=>{if(o++,this.muted){this.clearFade();return}this.audio.volume=Math.max(t-a*o,s),o>=i&&(this.clearFade(),this.audio.volume=s)},n)}exitGameMode(e=500){if(!this.audio||!this.isPlaying||(this.volume=this.normalVolume,this.muted))return;this.clearFade();let t=this.audio.volume,s=this.normalVolume,i=20,n=e/i,a=(s-t)/i,o=0;this.fadeInterval=setInterval(()=>{if(o++,this.muted){this.clearFade();return}this.audio.volume=Math.min(t+a*o,s),o>=i&&(this.clearFade(),this.audio.volume=s)},n)}getIsPlaying(){return this.isPlaying}setMuted(e){this.muted=e,this.audio&&(e?this.audio.volume=0:this.isPlaying&&(this.audio.volume=this.volume))}isMuted(){return this.muted}destroy(){this.clearFade(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null),this.isPlaying=!1}},T=new ne;var ae=class{constructor(){this.enabled=typeof gtag=="function",this.sessionStartTime=Date.now(),this.eventSequence=0,this.visitorId=this.getOrCreateVisitorId()}getOrCreateVisitorId(){let e=localStorage.getItem("flyabc_visitor_id");return e||(e="v_"+Date.now().toString(36)+Math.random().toString(36).substr(2,9),localStorage.setItem("flyabc_visitor_id",e)),e}getSessionDuration(){return Math.round((Date.now()-this.sessionStartTime)/1e3)}track(e,t={}){if(!this.enabled)return;this.eventSequence++;let s={...t,event_sequence:this.eventSequence,session_time:this.getSessionDuration(),visitor_id:this.visitorId,screen_name:this.getCurrentScreen()};try{gtag("event",e,s)}catch{}}getCurrentScreen(){let e=document.getElementById("lobby"),t=document.getElementById("result-screen"),s=document.getElementById("share-card-container");return document.getElementById("camera-modal")?.classList.contains("show")?"camera":s?.style.display==="flex"?"share_card":t?.classList.contains("show")?"result":e?.style.display!=="none"&&e?.style.opacity!=="0"?"lobby":"game"}trackScreenView(e){this.track("screen_view",{screen_name:e,screen_class:"WebView"})}gameStart(e,t){this.trackScreenView("game"),this.track("game_start",{event_category:"game",game_mode:e,game_value:t,mode_label:e==="questions"?`${t}\u9898`:`${t}\u79D2`})}gameEnd(e){this.trackScreenView("result"),this.track("game_end",{event_category:"game",score:e.score,correct:e.correct,total:e.total,accuracy:e.accuracy,max_combo:e.maxCombo,grade:e.grade,duration_seconds:e.duration})}answerQuestion(e,t,s){this.track("answer_question",{event_category:"game",is_correct:e,word:t,combo:s})}selectMode(e,t){this.track("select_mode",{event_category:"ui",game_mode:e,game_value:t})}selectCourse(e){this.track("select_course",{event_category:"ui",course:e})}selectTarget(e){this.track("select_target",{event_category:"ui",learning_target:e,target_label:e==="en"?"\u5B66\u82F1\u6587":"\u5B66\u4E2D\u6587"})}clickReplay(){this.track("click_replay",{event_category:"ui"})}clickHome(){this.trackScreenView("lobby"),this.track("click_home",{event_category:"ui"})}clickShare(){this.trackScreenView("camera"),this.track("click_share",{event_category:"ui"})}saveShareCard(){this.track("save_share_card",{event_category:"share"})}photoTaken(){this.track("photo_taken",{event_category:"camera"})}toggleBgm(e){this.track("toggle_bgm",{event_category:"audio",is_muted:e})}cameraPermission(e){this.track("camera_permission",{event_category:"tech",is_granted:e})}mediapipeLoaded(e){this.track("mediapipe_loaded",{event_category:"tech",load_time_ms:e})}enterFullscreen(e){this.track("enter_fullscreen",{event_category:"tech",is_success:e})}showInstallPrompt(){this.track("show_install_prompt",{event_category:"pwa"})}dismissInstallPrompt(){this.track("dismiss_install_prompt",{event_category:"pwa"})}gamePause(e){this.track("game_pause",{event_category:"game",pause_reason:e})}gameResume(){this.track("game_resume",{event_category:"game"})}comboMilestone(e,t){this.track("combo_milestone",{event_category:"game",combo:e,streak_name:t})}pageLoad(){this.trackScreenView("lobby"),this.track("session_start",{event_category:"lifecycle",referrer:document.referrer||"direct",is_pwa:this.isPWA(),device_type:this.getDeviceType()})}isPWA(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches}getDeviceType(){let e=navigator.userAgent;return/iPad|Tablet/i.test(e)?"tablet":/Mobile|iPhone|Android/i.test(e)?"mobile":"desktop"}showShareCardScreen(){this.trackScreenView("share_card")}},y=new ae;var oe=class{constructor(){this.modal=null,this.selfieCanvas=null,this.selfieCtx=null,this.closeBtn=null,this.shutterBtn=null,this.flashOverlay=null,this.cameraHint=null,this.cameraFlash=null,this.countdownEl=null,this.isOpen=!1,this.capturedImage=null,this.countdownActive=!1,this.countdownValue=3,this.countdownTimer=null,this.onCapture=null,this.onClose=null,this.animationId=null}init(){this.modal=document.getElementById("camera-modal"),this.selfieCanvas=document.getElementById("selfie-canvas"),this.selfieCtx=this.selfieCanvas?.getContext("2d"),this.closeBtn=document.getElementById("camera-close"),this.shutterBtn=document.getElementById("camera-shutter"),this.flashOverlay=document.getElementById("flash-overlay"),this.cameraHint=document.getElementById("camera-hint"),this.cameraFlash=document.querySelector(".camera-flash"),this.countdownEl=document.getElementById("camera-countdown"),this.closeBtn?.addEventListener("click",()=>this.close()),this.shutterBtn?.addEventListener("click",()=>this.manualCapture())}manualCapture(){!this.countdownActive&&!this.capturedImage&&this.startCountdown()}async open(e,t){this.onCapture=e,this.onClose=t,this.capturedImage=null,this.countdownActive=!1,this.countdownValue=3,this.selfieCanvas&&(this.selfieCanvas.width=320,this.selfieCanvas.height=240),this.modal?.classList.add("show"),this.isOpen=!0,this.countdownEl?.classList.remove("show"),this.cameraHint&&(this.cameraHint.innerHTML='<span class="hint-icon">\u{1F4F8}</span><span class="hint-text">Smile!</span>'),this.startRenderLoop(),x.speak("Let's take a photo!",{rate:.9,pitch:1.1,timeout:3e3}).then(()=>{setTimeout(()=>{this.isOpen&&!this.capturedImage&&this.startCountdown()},300)})}startRenderLoop(){let e=()=>{if(!this.isOpen)return;let t=document.getElementById("preview-canvas");t&&this.selfieCtx&&this.selfieCtx.drawImage(t,0,0,320,240),this.animationId=requestAnimationFrame(e)};e()}startCountdown(){if(this.countdownActive)return;this.countdownActive=!0,this.countdownValue=3;let e=["Three","Two","One"],t=0,s=()=>{if(!(!this.isOpen||this.capturedImage))if(t<e.length){let i=3-t;this.showCountdownNumber(i,e[t]),t++,setTimeout(s,1e3)}else this.capturePhoto()};s()}showCountdownNumber(e,t){this.countdownEl&&(x.speak(t,{rate:1,pitch:1,timeout:1500}),this.playCountdownSound(),this.countdownEl.textContent=e,this.countdownEl.classList.remove("show"),this.countdownEl.offsetWidth,this.countdownEl.classList.add("show"))}playCountdownSound(){let e=w.ctx;if(!e)return;let t=e.currentTime,s=e.createOscillator();s.type="sine",s.frequency.setValueAtTime(880,t),s.frequency.exponentialRampToValueAtTime(440,t+.1);let i=e.createGain();i.gain.setValueAtTime(.3,t),i.gain.exponentialRampToValueAtTime(.01,t+.15),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.15)}capturePhoto(){!this.selfieCanvas||this.capturedImage||(this.playShutterSound(),this.triggerFlash(),this.capturedImage=this.selfieCanvas.toDataURL("image/jpeg",.9),y.photoTaken(),this.shutterBtn?.classList.add("capturing"),this.countdownEl?.classList.remove("show"),setTimeout(()=>{this.shutterBtn?.classList.remove("capturing"),this.onCapture&&this.capturedImage&&this.onCapture(this.capturedImage),this.close()},600))}playShutterSound(){let e=w.ctx;if(!e)return;let t=e.currentTime,s=e.createOscillator();s.type="square",s.frequency.setValueAtTime(800,t),s.frequency.exponentialRampToValueAtTime(200,t+.03);let i=e.createGain();i.gain.setValueAtTime(.3,t),i.gain.exponentialRampToValueAtTime(.01,t+.03),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.03);let n=e.createOscillator();n.type="square",n.frequency.setValueAtTime(600,t+.05),n.frequency.exponentialRampToValueAtTime(100,t+.08);let a=e.createGain();a.gain.setValueAtTime(.25,t+.05),a.gain.exponentialRampToValueAtTime(.01,t+.08),n.connect(a),a.connect(e.destination),n.start(t+.05),n.stop(t+.08);let o=e.sampleRate*.06,l=e.createBuffer(1,o,e.sampleRate),d=l.getChannelData(0);for(let u=0;u<o;u++)d[u]=Math.random()*2-1;let c=e.createBufferSource();c.buffer=l;let h=e.createBiquadFilter();h.type="bandpass",h.frequency.value=1e3,h.Q.value=1;let m=e.createGain();m.gain.setValueAtTime(.15,t),m.gain.exponentialRampToValueAtTime(.01,t+.06),c.connect(h),h.connect(m),m.connect(e.destination),c.start(t),c.stop(t+.06)}triggerFlash(){this.flashOverlay?.classList.add("flash"),setTimeout(()=>{this.flashOverlay?.classList.remove("flash")},500),this.cameraFlash?.classList.add("active"),setTimeout(()=>{this.cameraFlash?.classList.remove("active")},200)}close(){this.isOpen=!1,this.modal?.classList.remove("show"),this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.countdownActive=!1,this.countdownEl?.classList.remove("show"),this.onClose&&this.onClose()}getCapturedImage(){return this.capturedImage}},q=new oe;function D(r,e,t){r&&(Array.isArray(e)?r.classList.remove(...e):e&&r.classList.remove(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Array.isArray(t)?r.classList.add(...t):t&&r.classList.add(t)})}))}var P={SWIPE_VELOCITY_THRESHOLD:8,SWIPE_COOLDOWN:300,SWIPE_STABLE_FRAMES:3,NEW_QUESTION_PROTECTION_TIME:300,CORRECT_DELAY:1500,WRONG_DELAY:2500,COOLDOWN_TIME:1e3,NO_HANDS_PAUSE_FRAMES:60,BRIGHTNESS_CHECK_INTERVAL:2e3,DARK_FRAMES_THRESHOLD:3,TIMER_WARNING_THRESHOLD:10},re=class{constructor(){this.canvas=null,this.ctx=null,this.previewCanvas=null,this.elements={},this._pageVisible=!0,this.state={active:!1,score:0,combo:0,maxCombo:0,currentQuestion:null,waiting:!1,cooldownUntil:0,cooldownOption:null,mustLeaveOptions:new Set,paused:!1,pauseReason:null,darkFrameCount:0,lastBrightnessCheck:0,lastSwipeTime:0,mode:"questions",modeValue:10,questionsAnswered:0,correctAnswers:0,timeRemaining:0,gameStartTime:0,showingResult:!1,waveCount:0,totalDistance:0,isSavingCard:!1};let e=window.innerWidth/2,t=window.innerHeight/2;this.handHistory={left:{x:e,y:t,lastX:e,lastY:t,initialized:!1},right:{x:e,y:t,lastX:e,lastY:t,initialized:!1}},this.brightnessCanvas=null,this.selfieImage=null,this.optionRects=[],this.handCursors={left:null,right:null},this.lastCursorPos={left:{x:0,y:0},right:{x:0,y:0}},this.cachedStageWidth=window.innerWidth,this.cachedStageHeight=window.innerHeight,this._loopRunning=!1}init(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.previewCanvas=document.getElementById("preview-canvas"),this.elements={lobby:document.getElementById("lobby"),questionCard:document.getElementById("question-card"),qWord:document.getElementById("q-word"),qPhonetic:document.getElementById("q-phonetic"),qHint:document.getElementById("q-hint"),scoreDisp:document.getElementById("score-disp"),comboDisplay:document.getElementById("combo-display"),comboNum:document.getElementById("combo-num"),feedbackOverlay:document.getElementById("feedback-overlay"),pauseOverlay:document.getElementById("pause-overlay"),pauseHands:document.getElementById("pause-hands"),pauseDark:document.getElementById("pause-dark"),hudCard:document.getElementById("hud-card"),killStreak:document.getElementById("kill-streak"),gameContainer:document.getElementById("game-container"),progressPill:document.getElementById("progress-pill"),progressBarFill:document.getElementById("progress-bar-fill"),progressDisp:document.getElementById("progress-disp"),resultScreen:document.getElementById("result-screen"),resultEmoji:document.getElementById("result-emoji"),resultTitle:document.getElementById("result-title"),resultGrade:document.getElementById("result-grade"),statScore:document.getElementById("stat-score"),statCorrect:document.getElementById("stat-correct"),statAccuracy:document.getElementById("stat-accuracy"),statCombo:document.getElementById("stat-combo"),btnReplay:document.getElementById("btn-replay"),btnHome:document.getElementById("btn-home"),btnShare:document.getElementById("btn-share"),shareCardContainer:document.getElementById("share-card-container"),shareCard:document.getElementById("share-card"),shareEmoji:document.getElementById("share-emoji"),shareTitle:document.getElementById("share-title"),shareGrade:document.getElementById("share-grade"),shareScore:document.getElementById("share-score"),shareCorrect:document.getElementById("share-correct"),shareAccuracy:document.getElementById("share-accuracy"),shareCombo:document.getElementById("share-combo"),shareDate:document.getElementById("share-date"),btnSaveCard:document.getElementById("btn-save-card"),btnCloseCard:document.getElementById("btn-close-card"),options:[document.getElementById("opt-0"),document.getElementById("opt-1"),document.getElementById("opt-2"),document.getElementById("opt-3")],countdownOverlay:document.getElementById("countdown-overlay"),countdownNumber:document.getElementById("countdown-number")},this.brightnessCanvas=document.createElement("canvas"),this.brightnessCanvas.width=64,this.brightnessCanvas.height=48,this.handCursors={left:document.getElementById("hand-cursor-left"),right:document.getElementById("hand-cursor-right")},window.addEventListener("resize",()=>this.resize()),this.resize(),this._setupVisibilityHandler(),this.elements.gameContainer.classList.add("in-lobby"),W.init(),L.init(this.elements.gameContainer),R.init(this.elements.gameContainer),this.setupResultButtonClicks(),this.setupOptionCardClicks(),this.loopIdle()}_setupVisibilityHandler(){document.addEventListener("visibilitychange",()=>{this._pageVisible=!document.hidden,this._pageVisible?(this.state.active||this.state.showingResult?(this._loopRunning=!1,this.loop()):this.loopIdle(),L.resume(),R.resume()):(L.pause(),R.pause())})}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.previewCanvas.width=320,this.previewCanvas.height=240,this.updateOptionRects()}updateOptionRects(){let e=document.getElementById("game-stage");if(e){let t=e.getBoundingClientRect();this.cachedStageWidth=t.width,this.cachedStageHeight=t.height}this.optionRects=[],this.elements.options.forEach((t,s)=>{let i=t.getBoundingClientRect();this.optionRects.push({x:i.left,y:i.top,w:i.width,h:i.height,el:t,index:s})})}async start(e="questions",t=10){this.state.mode=e,this.state.modeValue=t,this.state.score=0,this.state.combo=0,this.state.maxCombo=0,this.state.questionsAnswered=0,this.state.correctAnswers=0,this.state.showingResult=!1,this.state.waveCount=0,this.state.totalDistance=0,this.state.waiting=!1,this.state.paused=!1,this.state.pauseReason=null,this.state.cooldownUntil=0,this.state.cooldownOption=null,this.state.currentQuestion=null,this.state.countdown=!0;let s=window.innerWidth/2,i=window.innerHeight/2;this.handHistory={left:{x:s,y:i,lastX:s,lastY:i,initialized:!1},right:{x:s,y:i,lastX:s,lastY:i,initialized:!1}},this.state.lastSwipeTime=0,e==="time"?(this.state.timeRemaining=t,this.updateTimerDisplay()):this.updateProgressDisplay(),this.elements.scoreDisp.textContent="0",this.elements.lobby.style.opacity="0",this.elements.gameContainer.classList.remove("in-lobby"),setTimeout(()=>{this.elements.lobby.style.display="none"},600),this.elements.resultScreen&&this.elements.resultScreen.classList.remove("show"),this.elements.pauseOverlay&&this.elements.pauseOverlay.classList.remove("show"),b.initialized?b.setOnUpdate(n=>{this.updateHandCursors(n)}):await b.init(this.previewCanvas,n=>{this.updateHandCursors(n)}),this.state.active=!0,this.updateOptionRects(),this.loop(),await this.showCountdown(),this.state.countdown=!1,this.state.gameStartTime=Date.now(),this.elements.questionCard.classList.add("entering"),this.showQuestion(),setTimeout(()=>{this.elements.questionCard.classList.remove("entering")},700)}showCountdown(){return new Promise(e=>{let t=this.elements.countdownOverlay,s=this.elements.countdownNumber;if(!t||!s){e();return}t.classList.add("show"),x.speak("Get Ready!",{rate:.9,pitch:1.1,timeout:2e3}).then(()=>{setTimeout(()=>this.startCountdownSequence(s,t,e),300)})})}startCountdownSequence(e,t,s){let i=[{num:3,word:"Three"},{num:2,word:"Two"},{num:1,word:"One"},{num:"GO!",word:"Go!"}],n=0,a=()=>{if(n>=i.length){t.classList.remove("show"),s();return}let{num:o,word:l}=i[n];e.textContent=o,e.classList.remove("animate","go"),e.offsetWidth,o==="GO!"&&e.classList.add("go"),e.classList.add("animate"),x.speak(l,{rate:1,pitch:1,timeout:1500}),w.play("swipe"),n++,setTimeout(a,o==="GO!"?600:900)};a()}updateProgressDisplay(){let e=this.state.questionsAnswered,t=this.state.modeValue;if(this.elements.progressDisp&&(this.elements.progressDisp.textContent=`${e}/${t}`),this.elements.progressBarFill){let s=t>0?e/t*100:0;this.elements.progressBarFill.style.width=`${s}%`}}updateTimerDisplay(){if(this.elements.progressDisp){let e=Math.floor(this.state.timeRemaining/60),t=this.state.timeRemaining%60;if(this.elements.progressDisp.textContent=e>0?`${e}:${t.toString().padStart(2,"0")}`:`${t}s`,this.elements.progressBarFill){let s=this.state.modeValue>0?this.state.timeRemaining/this.state.modeValue*100:0;this.elements.progressBarFill.style.width=`${s}%`}this.state.timeRemaining<=P.TIMER_WARNING_THRESHOLD?this.elements.progressPill?.classList.add("warning"):this.elements.progressPill?.classList.remove("warning")}}showQuestion(){if(this.state.waiting)return;this.state.currentQuestion=Ce();let e=this.state.currentQuestion,t=V(),s=N();if(s==="cn"){let n=e.correct.pinyin||"";this.elements.qWord.innerHTML=`
        <div class="chinese-word-container">
          <span class="pinyin-text">${n}</span>
          <span class="hanzi-text">${e.correct.cn}</span>
        </div>
      `,this.elements.qWord.style.color="#c62828",this.elements.qWord.style.textShadow="none"}else{let n=e.correct.phonetic||"";this.elements.qWord.innerHTML=`
        <div class="english-word-container">
          <span class="english-text">${e.correct.en}</span>
          <span class="phonetic-text">${n}</span>
        </div>
      `,t.type==="color"&&e.correct.hex?e.correct.en==="White"?(this.elements.qWord.style.color="#37474f",this.elements.qWord.style.textShadow="3px 3px 0 #fff, 0 0 20px rgba(255,255,255,0.5)"):(this.elements.qWord.style.color=e.correct.hex,this.elements.qWord.style.textShadow=`3px 3px 0 #fff, 0 0 20px ${e.correct.hex}40`):(this.elements.qWord.style.color="#1565c0",this.elements.qWord.style.textShadow="3px 3px 0 #fff, 0 0 20px rgba(21,101,192,0.3)")}let i=typeof t.name=="object"?s==="cn"?t.name.cn:t.name.en:t.name;this.elements.qHint.textContent=s==="cn"?`\u5B66\u4E60 ${i}!`:`Learn ${i}!`,e.options.forEach((n,a)=>{let o=this.elements.options[a];o.className=`option-card pos-${a}`,o.style.transform="",o.style.boxShadow="";let l=o.querySelector("circle");if(l&&(l.style.strokeDashoffset="440"),t.type==="color")o.style.background=n.hex,o.innerHTML=`<svg class="progress-ring" viewBox="0 0 160 160">
          <circle cx="80" cy="80" r="70" stroke-dasharray="440" stroke-dashoffset="440"/>
        </svg>`,n.en==="White"&&o.classList.add("white-card");else{let d=e.optionTexts[a];o.style.background="#fff",o.innerHTML=`
          <svg class="progress-ring" viewBox="0 0 160 160">
            <circle cx="80" cy="80" r="70" stroke-dasharray="440" stroke-dashoffset="440"/>
          </svg>
          <img src="${n.image}" alt="${n.en}" class="option-image" />
          <span class="option-text">${d}</span>
        `}}),setTimeout(()=>{s==="cn"?x.speakChinese(e.correct.cn):x.speakWord(e.correct.en)},300),this.state.hoverTarget=null,this.state.hoverProgress=0,this.state.cooldownUntil=0,this.state.cooldownOption=null,this.state.questionProtectionUntil=Date.now()+P.NEW_QUESTION_PROTECTION_TIME,this.state.requireLeaveAllOptions=!0,this.state.mustLeaveOptions.clear()}checkAnswer(e){if(this.state.waiting||!this.state.currentQuestion||Date.now()<this.state.cooldownUntil)return;this.state.waiting=!0;let t=this.state.currentQuestion,s=e===t.correctIndex,i=this.elements.options[e],n=this.elements.options[t.correctIndex];if(this.state.questionsAnswered++,s&&this.state.correctAnswers++,y.answerQuestion(s,t.correct.en,this.state.combo),s){this.state.score++,this.state.combo++,this.state.combo>this.state.maxCombo&&(this.state.maxCombo=this.state.combo),this.elements.scoreDisp.textContent=this.state.score,this.triggerScoreAnimation(),i.classList.add("correct"),this.elements.feedbackOverlay.classList.add("correct");let o=i.getBoundingClientRect(),l=o.left+o.width/2,d=o.top+o.height/2,c=Math.min(1+this.state.combo*.3,3);if(R.celebrate(l,d,c),w.play("correct"),x.speakFeedback(!0),this.state.combo>=2){this.elements.comboNum.textContent=this.state.combo;let h=["show"];this.state.combo>=7?h.push("mega"):this.state.combo>=5&&h.push("hot"),D(this.elements.comboDisplay,["show","hot","mega"],h),setTimeout(()=>{this.elements.comboDisplay.classList.remove("show","hot","mega")},2e3),this.triggerKillStreak(this.state.combo),this.state.combo>=5&&R.bigCelebrate()}}else this.state.combo=0,this.state.cooldownUntil=Date.now()+P.COOLDOWN_TIME,this.state.cooldownOption=e,this.state.mustLeaveOptions.add(e),i.classList.add("wrong"),i.classList.add("cooldown"),n.classList.add("reveal-correct"),this.elements.feedbackOverlay.classList.add("wrong"),w.play("wrong"),setTimeout(()=>{N()==="cn"?x.speakChinese(t.correct.cn):x.speakWord(t.correct.en)},500),setTimeout(()=>{i.classList.remove("cooldown")},P.COOLDOWN_TIME);this.state.mode==="questions"&&this.updateProgressDisplay();let a=s?P.CORRECT_DELAY:P.WRONG_DELAY;if(this.state.mode==="questions"&&this.state.questionsAnswered>=this.state.modeValue){setTimeout(()=>{this.elements.feedbackOverlay.className="",this.endGame()},a);return}setTimeout(()=>{this.elements.feedbackOverlay.className="",this.state.waiting=!1,this.showQuestion()},a)}updateSwipe(){if(this.state.countdown||this.state.waiting||!this.state.active||this.state.paused)return;let e=Date.now();if(e-this.state.lastSwipeTime<P.SWIPE_COOLDOWN)return;let t=e<(this.state.questionProtectionUntil||0),s=b.getHands(),i=.7,n=!1;for(let a of["left","right"]){let o=s[a],l=this.handHistory[a];if(l.stableFrames===void 0&&(l.stableFrames=0),!o.visible){l.stableFrames=0;continue}if((o.opacity!==void 0?o.opacity:1)<i){l.stableFrames=0;continue}if(l.stableFrames++,l.stableFrames<P.SWIPE_STABLE_FRAMES){l.lastX=l.x,l.lastY=l.y,l.x=o.x,l.y=o.y;continue}let c=o.x-l.lastX,h=o.y-l.lastY,m=Math.sqrt(c*c+h*h);l.lastX=l.x,l.lastY=l.y,l.x=o.x,l.y=o.y;for(let u of this.optionRects)if(U(o.x,o.y,u)){n=!0;break}if(!t&&!this.state.requireLeaveAllOptions&&!(m<P.SWIPE_VELOCITY_THRESHOLD)){for(let u of this.optionRects)if(U(o.x,o.y,u)){if(u.index===this.state.cooldownOption&&e<this.state.cooldownUntil||this.state.mustLeaveOptions.has(u.index))continue;this.state.lastSwipeTime=e,this.triggerSwipeEffect(u.el),this.checkAnswer(u.index);return}}}this.state.requireLeaveAllOptions&&!n&&!t&&(this.state.requireLeaveAllOptions=!1);for(let a of["left","right"]){let o=s[a];if(o.visible){let l=this.handHistory[a];l.lastX=l.x,l.lastY=l.y,l.x=o.x,l.y=o.y}}this.updateNearbyHighlight(s)}updateNearbyHighlight(e){let s=[],i=e.left.opacity!==void 0?e.left.opacity:e.left.visible?1:0,n=e.right.opacity!==void 0?e.right.opacity:e.right.visible?1:0;i>=.7&&s.push(e.left),n>=.7&&s.push(e.right);for(let a of this.optionRects){let o=!1;for(let d of s)if(U(d.x,d.y,a)){o=!0;break}let l=a._wasNear||!1;o!==l&&(a._wasNear=o,o?(a.el.style.transform="scale(1.05)",a.el.classList.add("hand-near")):(a.el.style.transform="",a.el.classList.remove("hand-near"),this.state.mustLeaveOptions.has(a.index)&&this.state.mustLeaveOptions.delete(a.index)))}}triggerSwipeEffect(e){e.classList.add("swiped"),w.play("swipe"),setTimeout(()=>{e.classList.remove("swiped")},300)}triggerScoreAnimation(){D(this.elements.hudCard,"bounce","bounce"),D(this.elements.scoreDisp,"pop","pop"),setTimeout(()=>{this.elements.hudCard&&this.elements.hudCard.classList.remove("bounce"),this.elements.scoreDisp&&this.elements.scoreDisp.classList.remove("pop")},400)}triggerKillStreak(e){let t=[{min:2,text:"DOUBLE!",class:"double",sound:"combo",shake:!1,shakeHeavy:!1},{min:3,text:"TRIPLE!",class:"triple",sound:"combo",shake:!0,shakeHeavy:!1},{min:4,text:"ULTRA!",class:"ultra",sound:"combo",shake:!0,shakeHeavy:!1},{min:5,text:"MEGA!",class:"mega",sound:"mega",shake:!0,shakeHeavy:!1},{min:7,text:"UNSTOPPABLE!",class:"godlike",sound:"mega",shake:!1,shakeHeavy:!0},{min:10,text:"GODLIKE!",class:"godlike",sound:"mega",shake:!1,shakeHeavy:!0}],s=null;for(let a=t.length-1;a>=0;a--)if(e>=t[a].min){s=t[a];break}if(!s||!this.elements.killStreak)return;e===s.min&&y.comboMilestone(e,s.text);let i=this.elements.killStreak;i.textContent=s.text,D(i,["show","double","triple","ultra","mega","godlike"],[s.class,"show"]),w.play(s.sound),this.elements.gameContainer&&(s.shakeHeavy?(D(this.elements.gameContainer,["shake","shake-heavy"],"shake-heavy"),setTimeout(()=>{this.elements.gameContainer.classList.remove("shake-heavy")},800)):s.shake&&(D(this.elements.gameContainer,["shake","shake-heavy"],"shake"),setTimeout(()=>{this.elements.gameContainer.classList.remove("shake")},600))),setTimeout(()=>{i.classList.remove("show")},1800)}setupResultButtonClicks(){this.elements.btnReplay&&this.elements.btnReplay.addEventListener("click",()=>{this.state.showingResult&&(w.play("correct"),this.restart())}),this.elements.btnShare&&this.elements.btnShare.addEventListener("click",()=>{this.state.showingResult&&(w.play("correct"),this.showShareCard())}),this.elements.btnHome&&this.elements.btnHome.addEventListener("click",()=>{this.state.showingResult&&(w.play("correct"),this.goHome())})}setupOptionCardClicks(){this.elements.options.forEach((e,t)=>{e&&e.addEventListener("click",()=>{this.state.active&&!this.state.waiting&&!this.state.paused&&!this.state.countdown&&(this.triggerSwipeEffect(e),this.checkAnswer(t))})})}endGame(){this.state.active=!1,this.state.showingResult=!0,this.showResult()}showResult(){T.exitGameMode(500);let e=this.state.questionsAnswered>0?Math.round(this.state.correctAnswers/this.state.questionsAnswered*100):0,t=Math.round((Date.now()-this.state.startTime)/1e3),s,i,n,a;e>=95?(s="S",i="s",n="\u{1F3C6}",a="\u5B8C\u7F8E!"):e>=80?(s="A",i="a",n="\u{1F389}",a="\u592A\u68D2\u4E86!"):e>=60?(s="B",i="b",n="\u{1F60A}",a="\u4E0D\u9519\u54E6!"):e>=40?(s="C",i="c",n="\u{1F4AA}",a="\u7EE7\u7EED\u52A0\u6CB9!"):(s="D",i="d",n="\u{1F31F}",a="\u518D\u8BD5\u8BD5!"),this.elements.resultEmoji&&(this.elements.resultEmoji.textContent=n),this.elements.resultTitle&&(this.elements.resultTitle.textContent=a),this.elements.resultGrade&&(this.elements.resultGrade.textContent=s,this.elements.resultGrade.className=`result-grade ${i}`),this.elements.statScore&&(this.elements.statScore.textContent=this.state.score),this.elements.statCorrect&&(this.elements.statCorrect.textContent=this.state.correctAnswers),this.elements.statAccuracy&&(this.elements.statAccuracy.textContent=`${e}%`),this.elements.statCombo&&(this.elements.statCombo.textContent=this.state.maxCombo),this.elements.btnShare&&(s==="S"||s==="A"?this.elements.btnShare.style.display="":this.elements.btnShare.style.display="none"),this.elements.resultScreen&&this.elements.resultScreen.classList.add("show"),e>=80?w.play("mega"):w.play("combo"),y.gameEnd({score:this.state.score,correct:this.state.correctAnswers,total:this.state.questionsAnswered,accuracy:e,maxCombo:this.state.maxCombo,grade:s,duration:t})}restart(){y.clickReplay(),T.enterGameMode(300),this.start(this.state.mode,this.state.modeValue)}goHome(){y.clickHome(),this.state.active=!1,this.state.showingResult=!1,T.exitGameMode(300),this.elements.resultScreen&&this.elements.resultScreen.classList.remove("show"),this.elements.lobby&&(this.elements.lobby.style.display="",this.elements.lobby.style.opacity="1",this.elements.gameContainer.classList.add("in-lobby")),document.body.classList.remove("game-started"),this.elements.progressPill?.classList.remove("warning"),this._lobbyModeCards=null,this._lobbyStartBtn=null,this.resetLobbyHoverStates(),this.loopIdle()}checkChildPresence(){if(!this.state.active)return;let e=b.getNoHandsFrameCount();e>P.NO_HANDS_PAUSE_FRAMES?(!this.state.paused||this.state.pauseReason!=="hands")&&this.pauseGame("hands"):e===0&&this.state.paused&&this.state.pauseReason==="hands"&&this.resumeGame()}checkBrightnessLevel(){if(!this.state.active)return;let e=Date.now();if(e-this.state.lastBrightnessCheck<P.BRIGHTNESS_CHECK_INTERVAL)return;this.state.lastBrightnessCheck=e;let t=b.getVideoElement();if(!t||t.readyState<2)return;Ee(t,this.brightnessCanvas)?(this.state.darkFrameCount++,this.state.darkFrameCount>=P.DARK_FRAMES_THRESHOLD&&(!this.state.paused||this.state.pauseReason!=="dark")&&this.pauseGame("dark")):(this.state.darkFrameCount=0,this.state.paused&&this.state.pauseReason==="dark"&&this.resumeGame())}pauseGame(e){this.state.paused=!0,this.state.pauseReason=e,this.elements.pauseHands&&(this.elements.pauseHands.style.display=e==="hands"?"block":"none"),this.elements.pauseDark&&(this.elements.pauseDark.style.display=e==="dark"?"block":"none"),this.elements.pauseOverlay&&this.elements.pauseOverlay.classList.add("show"),y.gamePause(e)}resumeGame(){this.state.paused=!1,this.state.pauseReason=null,this.elements.pauseOverlay&&this.elements.pauseOverlay.classList.remove("show"),y.gameResume()}updateHandCursors(e){let t=this.cachedStageWidth||window.innerWidth,s=this.cachedStageHeight||window.innerHeight,i=.7,n=e.right.opacity!==void 0?e.right.opacity:e.right.visible?1:0;if(n>.01){this.handCursors.right.style.display="block",this.handCursors.right.style.opacity=n;let o=this.lastCursorPos.right.x,l=this.lastCursorPos.right.y,d=Math.max(0,Math.min(e.right.x,t)),c=Math.max(0,Math.min(e.right.y,s));this.handCursors.right.style.transform=`translate3d(${d}px, ${c}px, 0)`,this.lastCursorPos.right.x=d,this.lastCursorPos.right.y=c;let h=d-o,m=c-l,u=Math.sqrt(h*h+m*m);this.state.active&&u>1&&n>=i&&(this.state.totalDistance+=u,u>15&&this.state.waveCount++),n>=i?L.addPoint("right",d,c,u,n):L.clearHand("right")}else this.handCursors.right.style.display="none",this.handCursors.right.style.opacity="0",L.clearHand("right");let a=e.left.opacity!==void 0?e.left.opacity:e.left.visible?1:0;if(a>.01){this.handCursors.left.style.display="block",this.handCursors.left.style.opacity=a;let o=this.lastCursorPos.left.x,l=this.lastCursorPos.left.y,d=Math.max(0,Math.min(e.left.x,t)),c=Math.max(0,Math.min(e.left.y,s));this.handCursors.left.style.transform=`translate3d(${d}px, ${c}px, 0)`,this.lastCursorPos.left.x=d,this.lastCursorPos.left.y=c;let h=d-o,m=c-l,u=Math.sqrt(h*h+m*m);this.state.active&&u>1&&a>=i&&(this.state.totalDistance+=u,u>15&&this.state.waveCount++),a>=i?L.addPoint("left",d,c,u,a):L.clearHand("left")}else this.handCursors.left.style.display="none",this.handCursors.left.style.opacity="0",L.clearHand("left")}updateTimer(){if(this.state.mode!=="time"||!this.state.active||this.state.countdown||this.state.gameStartTime===0)return;let e=Math.floor((Date.now()-this.state.gameStartTime)/1e3);this.state.timeRemaining=Math.max(0,this.state.modeValue-e),this.updateTimerDisplay(),this.state.timeRemaining<=0&&this.endGame()}updateResultGestures(){if(!this.state.showingResult||q.isOpen||this.elements.shareCardContainer?.style.display==="flex")return;let e=b.getHands(),t=Date.now(),s=500,i=100,n=this.elements.btnReplay?.getBoundingClientRect(),a=this.elements.btnShare?.getBoundingClientRect(),o=this.elements.btnHome?.getBoundingClientRect(),l=.7,d=[],c=e.left.opacity!==void 0?e.left.opacity:e.left.visible?1:0,h=e.right.opacity!==void 0?e.right.opacity:e.right.visible?1:0;c>=l&&d.push({x:e.left.x,y:e.left.y}),h>=l&&d.push({x:e.right.x,y:e.right.y});let m=!1;if(n){for(let g of d)if(g.x>=n.left&&g.x<=n.right&&g.y>=n.top&&g.y<=n.bottom){m=!0;break}}let u=!1;if(a){for(let g of d)if(g.x>=a.left&&g.x<=a.right&&g.y>=a.top&&g.y<=a.bottom){u=!0;break}}let p=!1;if(o){for(let g of d)if(g.x>=o.left&&g.x<=o.right&&g.y>=o.top&&g.y<=o.bottom){p=!0;break}}if(m){this.state.resultHoverReplayStart||(this.state.resultHoverReplayStart=t);let g=t-this.state.resultHoverReplayStart;if(g>=i){this.elements.btnReplay?.classList.add("hover");let E=g-i;this.updateResultButtonProgress(this.elements.btnReplay,E/(s-i))}if(g>=s){this.state.resultHoverReplayStart=null,this.elements.btnReplay?.classList.remove("hover"),w.play("correct"),this.restart();return}}else this.state.resultHoverReplayStart=null,this.elements.btnReplay?.classList.remove("hover"),this.updateResultButtonProgress(this.elements.btnReplay,0);if(u){this.state.resultHoverShareStart||(this.state.resultHoverShareStart=t);let g=t-this.state.resultHoverShareStart;if(g>=i){this.elements.btnShare?.classList.add("hover");let E=g-i;this.updateResultButtonProgress(this.elements.btnShare,E/(s-i))}if(g>=s){this.state.resultHoverShareStart=null,this.elements.btnShare?.classList.remove("hover"),w.play("correct"),this.showShareCard();return}}else this.state.resultHoverShareStart=null,this.elements.btnShare?.classList.remove("hover"),this.updateResultButtonProgress(this.elements.btnShare,0);if(p){this.state.resultHoverHomeStart||(this.state.resultHoverHomeStart=t);let g=t-this.state.resultHoverHomeStart;if(g>=i){this.elements.btnHome?.classList.add("hover");let E=g-i;this.updateResultButtonProgress(this.elements.btnHome,E/(s-i))}if(g>=s){this.state.resultHoverHomeStart=null,this.elements.btnHome?.classList.remove("hover"),w.play("correct"),this.goHome();return}}else this.state.resultHoverHomeStart=null,this.elements.btnHome?.classList.remove("hover"),this.updateResultButtonProgress(this.elements.btnHome,0)}updateResultButtonProgress(e,t){e&&e.style.setProperty("--hover-progress",Math.min(t,1))}loop(){this._loopRunning||(this._loopRunning=!0,this._loopFrame())}_loopFrame(){if(!this._pageVisible){this._loopRunning=!1;return}this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),W.updateAndDraw(this.ctx,this.canvas.width,this.canvas.height),L.draw(),R.updateAndDraw(),this.state.active&&(this.updateSwipe(),this.checkChildPresence(),this.checkBrightnessLevel(),this.updateTimer()),this.state.showingResult&&this.updateResultGestures(),this.elements.shareCardContainer?.style.display==="flex"&&this.updateShareCardGestures(),requestAnimationFrame(()=>this._loopFrame())}loopIdle(){this._pageVisible&&(this.state.active||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),W.updateAndDraw(this.ctx,this.canvas.width,this.canvas.height),L.draw(),R.updateAndDraw(),this.elements.lobby&&this.elements.lobby.style.display!=="none"&&this.updateLobbyGestures(),requestAnimationFrame(()=>this.loopIdle())))}updateLobbyGestures(){let e=b.getHands(),t=Date.now(),s=400,i=600,n=.7,a=[],o=e.left.opacity!==void 0?e.left.opacity:e.left.visible?1:0,l=e.right.opacity!==void 0?e.right.opacity:e.right.visible?1:0;if(o>=n&&a.push({x:e.left.x,y:e.left.y}),l>=n&&a.push({x:e.right.x,y:e.right.y}),a.length===0){this.resetLobbyHoverStates();return}this._lobbyModeCards||(this._lobbyModeCards=document.querySelectorAll(".mode-card")),this._lobbyStartBtn||(this._lobbyStartBtn=document.getElementById("btn-start"));let d=this._lobbyModeCards,c=this._lobbyStartBtn,h=null;if(d.forEach(u=>{let p=u.getBoundingClientRect(),g=!1;for(let E of a)if(E.x>=p.left&&E.x<=p.right&&E.y>=p.top&&E.y<=p.bottom){g=!0,h=u;break}g?u.classList.add("hover"):(u.classList.remove("hover"),u.style.setProperty("--hover-progress",0))}),h){this.state.lobbyHoverModeCard!==h&&(this.state.lobbyHoverModeCard=h,this.state.lobbyHoverModeStart=t);let u=t-this.state.lobbyHoverModeStart;if(h.style.setProperty("--hover-progress",Math.min(u/s,1)),u>=s){w.play("correct");let p=h.hasAttribute("data-target"),g=h.hasAttribute("data-course"),E=h.hasAttribute("data-mode");d.forEach(_=>{(p&&_.hasAttribute("data-target")||g&&_.hasAttribute("data-course")||E&&_.hasAttribute("data-mode"))&&_.classList.remove("selected")}),h.classList.add("selected"),h.style.setProperty("--hover-progress",0),this.state.lobbyHoverModeStart=t+500}}else this.state.lobbyHoverModeCard=null,this.state.lobbyHoverModeStart=null;let m=!1;if(c){let u=c.getBoundingClientRect();for(let p of a)if(p.x>=u.left&&p.x<=u.right&&p.y>=u.top&&p.y<=u.bottom){m=!0;break}}if(m){this.state.lobbyHoverStartTime||(this.state.lobbyHoverStartTime=t,c?.classList.add("hover"));let u=t-this.state.lobbyHoverStartTime;c?.style.setProperty("--hover-progress",Math.min(u/i,1)),u>=i&&(this.state.lobbyHoverStartTime=null,c?.style.setProperty("--hover-progress",0),c?.classList.remove("hover"),w.play("correct"),window.startGame())}else this.state.lobbyHoverStartTime=null,c?.classList.remove("hover"),c?.style.setProperty("--hover-progress",0)}resetLobbyHoverStates(){let e=this._lobbyModeCards||document.querySelectorAll(".mode-card"),t=this._lobbyStartBtn||document.getElementById("btn-start");e.forEach(s=>{s.classList.remove("hover"),s.style.setProperty("--hover-progress",0)}),t?.classList.remove("hover"),t?.style.setProperty("--hover-progress",0),this.state.lobbyHoverModeCard=null,this.state.lobbyHoverModeStart=null,this.state.lobbyHoverStartTime=null}getScore(){return this.state.score}showShareCard(){y.clickShare(),q.open(e=>{this.selfieImage=e,this.displayShareCard()},()=>{this.selfieImage||this.displayShareCard()})}displayShareCard(){let e=this.state.questionsAnswered>0?Math.round(this.state.correctAnswers/this.state.questionsAnswered*100):0,t,s,i,n;if(e>=95?(t="S",s="s",i="\u{1F3C6}",n="\u5B8C\u7F8E!"):e>=80?(t="A",s="a",i="\u{1F389}",n="\u592A\u68D2\u4E86!"):e>=60?(t="B",s="b",i="\u{1F60A}",n="\u4E0D\u9519\u54E6!"):e>=40?(t="C",s="c",i="\u{1F4AA}",n="\u7EE7\u7EED\u52A0\u6CB9!"):(t="D",s="d",i="\u{1F31F}",n="\u518D\u8BD5\u8BD5!"),this.elements.shareEmoji&&(this.elements.shareEmoji.textContent=i),this.elements.shareTitle&&(this.elements.shareTitle.textContent=n),this.elements.shareGrade&&(this.elements.shareGrade.textContent=t,this.elements.shareGrade.className=`share-card-grade ${s}`),this.elements.shareScore&&(this.elements.shareScore.textContent=this.state.score),this.elements.shareCorrect&&(this.elements.shareCorrect.textContent=this.state.correctAnswers),this.elements.shareAccuracy&&(this.elements.shareAccuracy.textContent=`${e}%`),this.elements.shareCombo&&(this.elements.shareCombo.textContent=this.state.maxCombo),this.elements.shareDate){let p=new Date,g=`${p.getFullYear()}.${String(p.getMonth()+1).padStart(2,"0")}.${String(p.getDate()).padStart(2,"0")}`;this.elements.shareDate.textContent=g}let a=this.state.gameStartTime>0?Math.floor((Date.now()-this.state.gameStartTime)/1e3):0,o=Math.round(this.state.waveCount*.1+this.state.totalDistance*5e-5),l=Math.round(this.state.waveCount/3),d=document.getElementById("share-calories"),c=document.getElementById("share-waves"),h=document.getElementById("share-time");d&&(d.textContent=Math.max(1,o)),c&&(c.textContent=Math.max(1,l)),h&&(h.textContent=Math.max(1,a));let m=document.getElementById("share-photo"),u=document.getElementById("share-photo-img");m&&u&&(this.selfieImage?(u.src=this.selfieImage,m.classList.add("has-photo")):m.classList.remove("has-photo")),this.elements.shareCardContainer&&(this.elements.shareCardContainer.style.display="flex"),y.showShareCardScreen(),this.setupShareCardButtons()}setupShareCardButtons(){this.elements.btnSaveCard&&(this.elements.btnSaveCard.onclick=()=>this.saveShareCard()),this.elements.btnCloseCard&&(this.elements.btnCloseCard.onclick=()=>this.hideShareCard())}hideShareCard(){this.elements.shareCardContainer&&(this.elements.shareCardContainer.style.display="none"),this.selfieImage=null,this.state.shareCardHoverSaveStart=null,this.state.shareCardHoverCloseStart=null}updateShareCardGestures(){let e=b.getHands(),t=Date.now(),s=500,i=this.elements.btnSaveCard?.getBoundingClientRect(),n=this.elements.btnCloseCard?.getBoundingClientRect(),a=.7,o=[],l=e.left.opacity!==void 0?e.left.opacity:e.left.visible?1:0,d=e.right.opacity!==void 0?e.right.opacity:e.right.visible?1:0;l>=a&&o.push({x:e.left.x,y:e.left.y}),d>=a&&o.push({x:e.right.x,y:e.right.y});let c=!1;if(i){for(let m of o)if(m.x>=i.left&&m.x<=i.right&&m.y>=i.top&&m.y<=i.bottom){c=!0;break}}let h=!1;if(n){for(let m of o)if(m.x>=n.left&&m.x<=n.right&&m.y>=n.top&&m.y<=n.bottom){h=!0;break}}if(c){this.state.shareCardHoverSaveStart||(this.state.shareCardHoverSaveStart=t,this.elements.btnSaveCard?.classList.add("hover"));let m=t-this.state.shareCardHoverSaveStart;if(this.updateShareCardButtonProgress(this.elements.btnSaveCard,m/s),m>=s){this.state.shareCardHoverSaveStart=null,w.play("correct"),this.saveShareCard();return}}else this.state.shareCardHoverSaveStart=null,this.elements.btnSaveCard?.classList.remove("hover"),this.updateShareCardButtonProgress(this.elements.btnSaveCard,0);if(h){this.state.shareCardHoverCloseStart||(this.state.shareCardHoverCloseStart=t,this.elements.btnCloseCard?.classList.add("hover"));let m=t-this.state.shareCardHoverCloseStart;if(this.updateShareCardButtonProgress(this.elements.btnCloseCard,m/s),m>=s){this.state.shareCardHoverCloseStart=null,w.play("correct"),this.hideShareCard();return}}else this.state.shareCardHoverCloseStart=null,this.elements.btnCloseCard?.classList.remove("hover"),this.updateShareCardButtonProgress(this.elements.btnCloseCard,0)}updateShareCardButtonProgress(e,t){e&&e.style.setProperty("--hover-progress",Math.min(t,1))}async saveShareCard(){let e=this.elements.shareCard;if(!e||this.state.isSavingCard)return;this.state.isSavingCard=!0;let t=this.elements.btnSaveCard,s=t?.textContent;t&&(t.textContent="\u23F3 \u751F\u6210\u4E2D...",t.disabled=!0);try{window.html2canvas||await this.loadHtml2Canvas();let i=e.querySelector(".share-card-bg");i&&(i.style.animation="none");let n=e.querySelector(".share-card-grade"),a=n?.getAttribute("style")||"";if(n){let c=n.className,h="#fff";c.includes(" s")?h="#ffd700":c.includes(" a")?h="#4caf50":c.includes(" b")?h="#2196f3":c.includes(" c")?h="#ff9800":c.includes(" d")&&(h="#9e9e9e"),n.style.cssText=`
          background: none !important;
          -webkit-background-clip: unset !important;
          background-clip: unset !important;
          -webkit-text-fill-color: ${h} !important;
          color: ${h} !important;
        `}let o=e.querySelector(".share-card-photo img"),l=o?.getAttribute("style")||"";o&&(o.style.transform="none");let d=await window.html2canvas(e,{scale:2,backgroundColor:null,useCORS:!0,logging:!1});i&&(i.style.animation=""),n&&n.setAttribute("style",a),o&&o.setAttribute("style",l),d.toBlob(c=>{if(!c){alert("\u751F\u6210\u56FE\u7247\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),this.state.isSavingCard=!1,t&&(t.disabled=!1,t.textContent=s);return}let h=URL.createObjectURL(c),m=document.createElement("a");m.download=`flyabc-\u6218\u7EE9-${Date.now()}.png`,m.href=h,m.click(),y.saveShareCard(),URL.revokeObjectURL(h),t?(t.textContent="\u2705 \u5DF2\u4FDD\u5B58!",setTimeout(()=>{t.textContent=s,t.disabled=!1,this.state.isSavingCard=!1},2e3)):this.state.isSavingCard=!1},"image/png")}catch{alert("\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u6216\u622A\u56FE\u4FDD\u5B58"),t&&(t.textContent=s,t.disabled=!1),this.state.isSavingCard=!1}}loadHtml2Canvas(){return new Promise((e,t)=>{let s=document.createElement("script");s.src="https://cdn.jsdmirror.com/npm/html2canvas@1.4.1/dist/html2canvas.min.js",s.onload=e,s.onerror=()=>t(new Error("Failed to load html2canvas")),document.head.appendChild(s)})}},le=new re;var ce=class{constructor(){this.isFullscreen=!1,this.installPromptShown=!1}isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}isAndroid(){return/Android/.test(navigator.userAgent)}isStandalone(){return!!(window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))}isIOSSafari(){let e=navigator.userAgent,t=this.isIOS(),s=/Safari/.test(e)&&!/CriOS|FxiOS|OPiOS|EdgiOS/.test(e);return t&&s&&!this.isStandalone()}async enterFullscreen(){if(this.isIOS())return!1;let e=document.documentElement;try{if(e.requestFullscreen)return await e.requestFullscreen(),this.isFullscreen=!0,y.enterFullscreen(!0),!0;if(e.webkitRequestFullscreen)return await e.webkitRequestFullscreen(),this.isFullscreen=!0,y.enterFullscreen(!0),!0;if(e.mozRequestFullScreen)return await e.mozRequestFullScreen(),this.isFullscreen=!0,y.enterFullscreen(!0),!0;if(e.msRequestFullscreen)return await e.msRequestFullscreen(),this.isFullscreen=!0,y.enterFullscreen(!0),!0}catch{return y.enterFullscreen(!1),!1}return!1}async exitFullscreen(){try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen(),this.isFullscreen=!1}catch{}}checkFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}showInstallPrompt(){if(this.isStandalone()||this.installPromptShown||!this.isIOSSafari())return;let e=localStorage.getItem("flyabc_install_dismissed");if(e){let t=parseInt(e,10);if(Date.now()-t<10080*60*1e3)return}this.installPromptShown=!0,this.createInstallPromptUI(),y.showInstallPrompt()}createInstallPromptUI(){let e=document.createElement("div");e.id="ios-install-prompt",e.innerHTML=`
      <div class="install-prompt-content">
        <div class="install-prompt-icon">\u{1F4F2}</div>
        <div class="install-prompt-text">
          <div class="install-prompt-title">\u6DFB\u52A0\u5230\u4E3B\u5C4F\u5E55</div>
          <div class="install-prompt-desc">\u83B7\u5F97\u5168\u5C4F\u6C89\u6D78\u5F0F\u4F53\u9A8C\uFF0C\u50CF App \u4E00\u6837\u4F7F\u7528</div>
        </div>
        <button class="install-prompt-close" aria-label="\u5173\u95ED">\u2715</button>
      </div>
      <div class="install-prompt-steps">
        <div class="install-step">
          <span class="step-num">1</span>
          <span class="step-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-2h2V7h-2z"/>
              <path d="M9 9h6v2H9V9zm0 4h6v2H9v-2z"/>
              <rect x="4" y="16" width="16" height="2" rx="1"/>
              <path d="M12 4v6m0 0l-3-3m3 3l3-3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="step-text">\u70B9\u51FB\u5E95\u90E8<strong>\u5206\u4EAB</strong>\u6309\u94AE</span>
        </div>
        <div class="install-step">
          <span class="step-num">2</span>
          <span class="step-icon">\u2795</span>
          <span class="step-text">\u9009\u62E9<strong>\u6DFB\u52A0\u5230\u4E3B\u5C4F\u5E55</strong></span>
        </div>
      </div>
      <div class="install-prompt-arrow"></div>
    `,document.body.appendChild(e),e.querySelector(".install-prompt-close").addEventListener("click",()=>{this.hideInstallPrompt(),localStorage.setItem("flyabc_install_dismissed",Date.now().toString()),y.dismissInstallPrompt()}),setTimeout(()=>{e.classList.add("show")},100),setTimeout(()=>{this.hideInstallPrompt()},15e3)}hideInstallPrompt(){let e=document.getElementById("ios-install-prompt");e&&(e.classList.remove("show"),setTimeout(()=>{e.remove()},300))}onFullscreenChange(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)}},he=new ce;var _e={DETECTION_FRAMES:5},de="colormaster_calibration_done",me=class{constructor(){this.isActive=!1,this.onComplete=null,this.elements={},this.detectedFrames=0,this.isPersonDetected=!1,this._animationFrame=null}shouldShow(){return localStorage.getItem(de)!=="true"}markDone(){localStorage.setItem(de,"true")}reset(){localStorage.removeItem(de)}createDOM(){if(document.getElementById("calibration-overlay"))return;let e=document.createElement("div");e.id="calibration-overlay",e.className="calibration-overlay",e.innerHTML=`
      <!-- \u5168\u5C4F\u6444\u50CF\u5934\u80CC\u666F -->
      <canvas class="calibration-camera-bg" id="calibration-camera-bg"></canvas>

      <!-- \u53D6\u666F\u6846 -->
      <div class="viewfinder" id="viewfinder">
        <div class="viewfinder-corner top-left"></div>
        <div class="viewfinder-corner top-right"></div>
        <div class="viewfinder-corner bottom-left"></div>
        <div class="viewfinder-corner bottom-right"></div>
      </div>

      <!-- \u72B6\u6001\u63D0\u793A -->
      <div class="calibration-status" id="calibration-status">
        <div class="status-icon" id="status-icon">\u{1F440}</div>
        <div class="status-text" id="status-text">\u628A\u624B\u673A\u653E\u5728\u7535\u89C6\u524D\uFF0C\u7AD9\u5230\u753B\u9762\u4E2D</div>
      </div>

      <!-- \u5C0F\u63D0\u793A\u56FE\uFF08\u53EF\u9009\uFF09 -->
      <div class="setup-hint-card" id="setup-hint-card">
        <span class="hint-icon">\u{1F4F1}</span>
        <span class="hint-text">\u6A2A\u653E\u624B\u673A\uFF0C\u9000\u540E 2 \u7C73</span>
      </div>

      <!-- \u8DF3\u8FC7\u6309\u94AE -->
      <button class="calibration-skip-btn" id="btn-skip">
        \u8DF3\u8FC7 \u2192
      </button>
    `,document.body.appendChild(e),this.cacheElements(),this.bindEvents()}cacheElements(){this.elements={overlay:document.getElementById("calibration-overlay"),cameraBg:document.getElementById("calibration-camera-bg"),viewfinder:document.getElementById("viewfinder"),statusIcon:document.getElementById("status-icon"),statusText:document.getElementById("status-text"),hintCard:document.getElementById("setup-hint-card"),btnSkip:document.getElementById("btn-skip")}}bindEvents(){this.elements.btnSkip?.addEventListener("click",()=>{this.skip()})}async start(e){this.onComplete=e,this.isActive=!0,this.detectedFrames=0,this.isPersonDetected=!1,this.countdown=_e.COUNTDOWN_SECONDS,this.isCountingDown=!1,this.createDOM();let t=this.elements.cameraBg;t&&(t.width=window.innerWidth,t.height=window.innerHeight,this.cameraCtx=t.getContext("2d")),this.elements.overlay.classList.add("show");let s=document.getElementById("preview-canvas");b.initialized||await b.init(s,()=>{this.checkPersonDetected()}),this.renderLoop(),x.speakChinese("\u628A\u624B\u673A\u653E\u5728\u7535\u89C6\u524D\u9762\uFF0C\u8BA9\u6211\u770B\u5230\u4F60",{rate:1,timeout:3e3})}renderLoop(){this.isActive&&(this.drawCameraFeed(),this.checkPersonDetected(),this._animationFrame=requestAnimationFrame(()=>this.renderLoop()))}drawCameraFeed(){let e=b.getVideoElement(),t=this.cameraCtx,s=this.elements.cameraBg;if(!e||!t||!s||e.readyState<2)return;t.clearRect(0,0,s.width,s.height),t.save(),t.translate(s.width,0),t.scale(-1,1);let i=e.videoWidth/e.videoHeight||4/3,n=s.width/s.height,a,o,l,d;i>n?(o=s.height,a=o*i,l=(s.width-a)/2,d=0):(a=s.width,o=a/i,l=0,d=(s.height-o)/2),t.drawImage(e,l,d,a,o),t.restore()}checkPersonDetected(){if(this.isPersonDetected)return;b.hasHands()?(this.detectedFrames++,this.detectedFrames>=_e.DETECTION_FRAMES&&!this.isPersonDetected&&this.onPersonDetected()):(this.detectedFrames>0&&(this.detectedFrames=Math.max(0,this.detectedFrames-2)),this.isPersonDetected&&this.detectedFrames===0&&this.onPersonLost())}onPersonDetected(){this.isPersonDetected=!0,this.elements.viewfinder?.classList.add("detected"),this.elements.statusIcon&&(this.elements.statusIcon.textContent="\u2705"),this.elements.statusText&&(this.elements.statusText.textContent="\u8BC6\u522B\u6210\u529F\uFF01\u5373\u5C06\u5F00\u59CB..."),this.elements.hintCard?.classList.add("hidden"),w.play("correct"),setTimeout(()=>{this.complete()},1e3)}onPersonLost(){this.isPersonDetected=!1,this.elements.viewfinder?.classList.remove("detected"),this.elements.statusIcon&&(this.elements.statusIcon.textContent="\u{1F440}"),this.elements.statusText&&(this.elements.statusText.textContent="\u7AD9\u5230\u753B\u9762\u4E2D\u8BA9\u6211\u770B\u5230\u4F60"),this.elements.hintCard?.classList.remove("hidden")}complete(){this.isActive=!1,this.markDone(),this._animationFrame&&cancelAnimationFrame(this._animationFrame),w.play("mega"),x.speak("Go!",{rate:1,pitch:1.2,timeout:1e3}),this.elements.overlay.classList.remove("show"),this.elements.overlay.classList.add("fade-out"),setTimeout(()=>{this.elements.overlay&&this.elements.overlay.remove(),this.elements={},this.onComplete&&this.onComplete()},400)}skip(){this.isActive=!1,this._animationFrame&&cancelAnimationFrame(this._animationFrame),this.elements.overlay&&(this.elements.overlay.classList.remove("show"),this.elements.overlay.classList.add("fade-out")),setTimeout(()=>{this.elements.overlay&&this.elements.overlay.remove(),this.elements={},this.onComplete&&this.onComplete()},300)}destroy(){this.isActive=!1,this._animationFrame&&cancelAnimationFrame(this._animationFrame),this.elements.overlay&&this.elements.overlay.remove(),this.elements={}}},ue=new me;var pe="colormaster_language",I={ZH:"zh",EN:"en"},Qe={zh:{"loading.ai":"\u6B63\u5728\u52A0\u8F7D AI...","loading.ready":"\u2713 \u51C6\u5907\u5C31\u7EEA","loading.toast":"\u{1F916} AI \u6A21\u5757\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...","loading.error":"\u52A0\u8F7D\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0","tutorial.title":"\u2728 \u7B80\u5355 4 \u6B65\u5F00\u542F\u9B54\u6CD5 \u2728","tutorial.step1.label":"\u542C\u5355\u8BCD","tutorial.step1.desc":"Listen to the word","tutorial.step2.label":"\u6325\u6325\u624B","tutorial.step2.desc":"Wave your hands","tutorial.step3.label":"\u6293\u7B54\u6848","tutorial.step3.desc":"Catch the answer","tutorial.step4.label":"\u653E\u70DF\u82B1","tutorial.step4.desc":"Celebrate!","lobby.slogan":'\u628A\u5BA2\u5385\u53D8\u6210<span class="highlight">\u9B54\u6CD5\u6E38\u4E50\u573A</span>',"lobby.subslogan":"\u65E0\u9700\u4E0B\u8F7D App \xB7 \u624B\u673A\u6295\u5C4F\u5373\u73A9 \xB7 \u52A8\u611F\u82F1\u8BED\u542F\u8499","lobby.targetTitle":"\u5B66\u4E60\u76EE\u6807","lobby.target.en":"\u5B66\u82F1\u6587","lobby.target.cn":"\u5B66\u4E2D\u6587","lobby.courseTitle":"\u5B66\u4E60\u8BFE\u7A0B","lobby.course.color":"\u989C\u8272","lobby.course.fruit":"\u6C34\u679C","lobby.modeTitle":"\u6E38\u620F\u6A21\u5F0F","lobby.mode.debug":"1\u9898\u8C03\u8BD5","lobby.mode.10":"10\u9898\u6311\u6218","lobby.mode.20":"20\u9898\u5927\u5E08","lobby.mode.1min":"1\u5206\u949F","lobby.mode.2min":"2\u5206\u949F","lobby.recommend":"\u65B0\u624B\u63A8\u8350","lobby.startBtn":"\u5F00\u59CB\u9B54\u6CD5\u4E4B\u65C5","lobby.privacy":"\u70B9\u51FB\u540E\u8BF7\u5141\u8BB8\u4F7F\u7528\u6444\u50CF\u5934 \xB7 \u89C6\u9891\u4EC5\u5728\u672C\u5730\u5904\u7406\uFF0C\u9690\u79C1\u5B89\u5168\u4FDD\u62A4\u4E2D","game.hint":"Move your hand to select the color!","game.ready":"Ready?","pause.hands.title":"\u6211\u770B\u4E0D\u5230\u4F60\u4E86\u54E6","pause.hands.hint":"\u56DE\u6765\u7EE7\u7EED\u73A9\u5427\uFF01","pause.dark.title":"\u592A\u6697\u5566","pause.dark.hint":"\u8BF7\u5F00\u706F\u54E6\uFF01","countdown.text":"Get Ready!","rotate.text":"\u8BF7\u6A2A\u5C4F\u4F7F\u7528","rotate.hint":"Please rotate your device","result.title.great":"\u592A\u68D2\u4E86!","result.title.good":"\u4E0D\u9519\u54E6!","result.title.try":"\u7EE7\u7EED\u52A0\u6CB9!","result.stat.score":"\u5F97\u5206","result.stat.correct":"\u7B54\u5BF9","result.stat.accuracy":"\u6B63\u786E\u7387","result.stat.combo":"\u6700\u9AD8\u8FDE\u51FB","result.btn.replay":"\u518D\u6765\u4E00\u5C40","result.btn.share":"\u751F\u6210\u6218\u7EE9","result.btn.home":"\u8FD4\u56DE\u9996\u9875","camera.hint":"Smile!","share.subtitle":"\u624B\u52BF\u4E92\u52A8\u82F1\u8BED\u5B66\u4E60","share.calories":"\u5361\u8DEF\u91CC","share.waves":"\u6B21\u6325\u624B","share.seconds":"\u79D2","share.slogan":"\u626B\u7801\u4E00\u8D77\u6765\u73A9\u5427\uFF01","share.btn.save":"\u4FDD\u5B58\u56FE\u7247","share.btn.close":"\u5173\u95ED","detector.label":"\u8BC6\u522B\u6A21\u5F0F:","detector.hands":"\u624B\u90E8","detector.pose":"\u5168\u8EAB","detector.hint.hands":"\u7EDD\u5BF9\u5750\u6807","detector.hint.pose":"\u76F8\u5BF9\u5750\u6807","permission.title":"\u9700\u8981\u6444\u50CF\u5934\u6743\u9650","permission.desc":"\u6E38\u620F\u9700\u8981\u4F7F\u7528\u6444\u50CF\u5934\u6765\u8BC6\u522B\u4F60\u7684\u624B\u52BF\u52A8\u4F5C","permission.step1":"\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE","permission.step2":"\u5728\u5F39\u7A97\u4E2D\u9009\u62E9\u300C\u5141\u8BB8\u300D","permission.hint.android":"\u5982\u679C\u6CA1\u6709\u5F39\u7A97\uFF0C\u8BF7\u5230 \u8BBE\u7F6E \u2192 \u5E94\u7528 \u2192 \u6D4F\u89C8\u5668 \u2192 \u6743\u9650 \u4E2D\u5F00\u542F\u6444\u50CF\u5934","permission.hint.ios":"\u5982\u679C\u6CA1\u6709\u5F39\u7A97\uFF0C\u8BF7\u5230 \u8BBE\u7F6E \u2192 Safari \u2192 \u6444\u50CF\u5934 \u4E2D\u5141\u8BB8\u8BBF\u95EE","permission.hint.desktop":"\u5982\u679C\u6CA1\u6709\u5F39\u7A97\uFF0C\u8BF7\u70B9\u51FB\u5730\u5740\u680F\u5DE6\u4FA7\u56FE\u6807\u5141\u8BB8\u6444\u50CF\u5934","permission.btn":"\u{1F4F7} \u5F00\u542F\u6444\u50CF\u5934","permission.skip":"\u6682\u65F6\u8DF3\u8FC7","wechat.title":"\u8BF7\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00","wechat.desc":"\u5FAE\u4FE1\u5185\u7F6E\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u6444\u50CF\u5934\u529F\u80FD\uFF0C\u8BF7\u4F7F\u7528\u7CFB\u7EDF\u6D4F\u89C8\u5668\u6253\u5F00\u4EE5\u83B7\u5F97\u6700\u4F73\u4F53\u9A8C","wechat.step1":"\u70B9\u51FB\u53F3\u4E0A\u89D2","wechat.step2.ios":"\u9009\u62E9\u300C\u5728 Safari \u4E2D\u6253\u5F00\u300D","wechat.step2.android":"\u9009\u62E9\u300C\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00\u300D","wechat.arrow":"\u70B9\u51FB\u8FD9\u91CC","guide.modal.title":"\u2728 \u9B54\u6CD5\u6307\u5357 \u2728","guide.modal.faq.title":"\u2753 \u5E38\u89C1\u95EE\u9898","guide.modal.faq.q1":"\u6444\u50CF\u5934\u6253\u4E0D\u5F00\uFF1F","guide.modal.faq.a1":"\u70B9\u51FB\u5730\u5740\u680F\u{1F512}\u56FE\u6807\uFF0C\u5141\u8BB8\u6444\u50CF\u5934","guide.modal.faq.q2":"\u8BC6\u522B\u4E0D\u51C6\uFF1F","guide.modal.faq.a2":"\u8BF7\u5F00\u706F\u{1F4A1}\uFF0C\u4FDD\u6301\u5149\u7EBF\u5145\u8DB3","guide.modal.faq.q3":"\u753B\u9762\u5361\u987F\uFF1F","guide.modal.faq.a3":"\u5173\u95ED\u540E\u53F0App\uFF0C\u7528\u6027\u80FD\u66F4\u597D\u7684\u624B\u673A","guide.modal.gotit":"\u660E\u767D\u4E86\uFF01\u5F00\u59CB\u73A9"},en:{"loading.ai":"Loading AI...","loading.ready":"\u2713 Ready","loading.toast":"\u{1F916} AI loading, please wait...","loading.error":"Failed, please refresh","tutorial.title":"\u2728 4 Easy Steps to Magic \u2728","tutorial.step1.label":"Listen","tutorial.step1.desc":"Hear the word","tutorial.step2.label":"Wave","tutorial.step2.desc":"Move your hands","tutorial.step3.label":"Catch","tutorial.step3.desc":"Grab the answer","tutorial.step4.label":"Celebrate","tutorial.step4.desc":"Watch fireworks!","lobby.slogan":'Turn Your Living Room into a <span class="highlight">Magic Playground</span>',"lobby.subslogan":"No App Required \xB7 Cast & Play \xB7 Fun English Learning","lobby.targetTitle":"Learning Goal","lobby.target.en":"Learn English","lobby.target.cn":"Learn Chinese","lobby.courseTitle":"Course","lobby.course.color":"Colors","lobby.course.fruit":"Fruits","lobby.modeTitle":"Choose Game Mode","lobby.mode.debug":"1 Question","lobby.mode.10":"10 Challenge","lobby.mode.20":"20 Master","lobby.mode.1min":"1 Minute","lobby.mode.2min":"2 Minutes","lobby.recommend":"Recommended","lobby.startBtn":"Start Magic Journey","lobby.privacy":"Camera required \xB7 Video processed locally for privacy","game.hint":"Move your hand to select the color!","game.ready":"Ready?","pause.hands.title":"I can't see you","pause.hands.hint":"Come back to play!","pause.dark.title":"Too dark","pause.dark.hint":"Please turn on the light!","countdown.text":"Get Ready!","rotate.text":"Please rotate","rotate.hint":"Use landscape mode","result.title.great":"Amazing!","result.title.good":"Good Job!","result.title.try":"Keep Going!","result.stat.score":"Score","result.stat.correct":"Correct","result.stat.accuracy":"Accuracy","result.stat.combo":"Best Combo","result.btn.replay":"Play Again","result.btn.share":"Share Result","result.btn.home":"Home","camera.hint":"Smile!","share.subtitle":"Gesture-based English Learning","share.calories":"calories","share.waves":"waves","share.seconds":"sec","share.slogan":"Scan to play together!","share.btn.save":"Save Image","share.btn.close":"Close","detector.label":"Detection:","detector.hands":"Hands","detector.pose":"Full Body","detector.hint.hands":"Absolute","detector.hint.pose":"Relative","permission.title":"Camera Access Needed","permission.desc":"This game uses your camera to track hand gestures","permission.step1":"Tap the button below","permission.step2":'Select "Allow" in the popup',"permission.hint.android":"No popup? Go to Settings \u2192 Apps \u2192 Browser \u2192 Permissions \u2192 Camera","permission.hint.ios":"No popup? Go to Settings \u2192 Safari \u2192 Camera \u2192 Allow","permission.hint.desktop":"No popup? Click the icon on the left of the address bar","permission.btn":"\u{1F4F7} Enable Camera","permission.skip":"Skip for now","wechat.title":"Open in Browser","wechat.desc":"WeChat browser does not support camera. Please open in system browser for best experience","wechat.step1":"Tap the top-right corner","wechat.step2.ios":'Select "Open in Safari"',"wechat.step2.android":'Select "Open in Browser"',"wechat.arrow":"Tap here","guide.modal.title":"\u2728 Magic Guide \u2728","guide.modal.faq.title":"\u2753 FAQ","guide.modal.faq.q1":"Camera won't open?","guide.modal.faq.a1":"Click \u{1F512} in address bar, allow camera","guide.modal.faq.q2":"Detection not working?","guide.modal.faq.a2":"Turn on lights\u{1F4A1}, ensure good lighting","guide.modal.faq.q3":"Laggy performance?","guide.modal.faq.a3":"Close other apps, use a faster phone","guide.modal.gotit":"Got it! Let's play"}},ge=class{constructor(){let e=localStorage.getItem(pe);e?this.currentLang=e:(this.currentLang=this.detectBrowserLanguage(),localStorage.setItem(pe,this.currentLang)),this.listeners=[]}detectBrowserLanguage(){return(navigator.language||navigator.languages?.[0]||"en").toLowerCase().startsWith("zh")?I.ZH:I.EN}getLang(){return this.currentLang}isZh(){return this.currentLang===I.ZH}isEn(){return this.currentLang===I.EN}setLang(e){e!==I.ZH&&e!==I.EN||(this.currentLang=e,localStorage.setItem(pe,e),document.documentElement.lang=e===I.ZH?"zh-CN":"en",this.updateAllTranslations(),this.listeners.forEach(t=>t(e)))}toggle(){let e=this.currentLang===I.ZH?I.EN:I.ZH;return this.setLang(e),e}t(e,t=""){return Qe[this.currentLang][e]||t||e}onLangChange(e){this.listeners.push(e)}offLangChange(e){this.listeners=this.listeners.filter(t=>t!==e)}updateAllTranslations(){document.querySelectorAll("[data-i18n]").forEach(s=>{let i=s.getAttribute("data-i18n"),n=this.t(i);n.includes("<")?s.innerHTML=n:s.textContent=n}),document.querySelectorAll("[data-i18n-placeholder]").forEach(s=>{let i=s.getAttribute("data-i18n-placeholder");s.placeholder=this.t(i)})}init(){document.documentElement.lang=this.currentLang===I.ZH?"zh-CN":"en",this.updateAllTranslations()}},v=new ge;var M=null,fe=!1;function Ze(){return navigator.userAgent.toLowerCase().includes("micromessenger")}function Je(){if(document.getElementById("wechat-guide-overlay"))return;let r=document.createElement("div");r.id="wechat-guide-overlay",r.className="wechat-guide-overlay";let e=/iphone|ipad|ipod/i.test(navigator.userAgent);r.innerHTML=`
    <div class="wechat-guide-card">
      <div class="wechat-guide-icon">\u{1F310}</div>
      <div class="wechat-guide-title">${v.t("wechat.title")}</div>
      <div class="wechat-guide-desc">${v.t("wechat.desc")}</div>
      <div class="wechat-guide-steps">
        <div class="wechat-step">
          <span class="wechat-step-num">1</span>
          <span class="wechat-step-text">${v.t("wechat.step1")}</span>
          <span class="wechat-step-icon">\u22EF</span>
        </div>
        <div class="wechat-step">
          <span class="wechat-step-num">2</span>
          <span class="wechat-step-text">${e?v.t("wechat.step2.ios"):v.t("wechat.step2.android")}</span>
        </div>
      </div>
      <div class="wechat-guide-arrow">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M7 14l5-5 5 5H7z"/>
        </svg>
        <span>${v.t("wechat.arrow")}</span>
      </div>
    </div>
  `,document.body.appendChild(r)}async function et(){if(navigator.permissions&&navigator.permissions.query)try{return(await navigator.permissions.query({name:"camera"})).state}catch{}if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{let e=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput");return e.length>0&&e[0].label?"granted":e.length>0?"prompt":"denied"}catch{}return"prompt"}async function tt(){try{return(await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1})).getTracks().forEach(e=>e.stop()),fe=!0,y.cameraPermission(!0),!0}catch{return y.cameraPermission(!1),!1}}function Me(){return new Promise(r=>{let e=/android/i.test(navigator.userAgent),t=/iphone|ipad|ipod/i.test(navigator.userAgent),s=document.createElement("div");s.id="camera-permission-overlay",s.className="permission-overlay";let i=e?v.t("permission.hint.android"):t?v.t("permission.hint.ios"):v.t("permission.hint.desktop");s.innerHTML=`
      <div class="permission-card">
        <div class="permission-icon">\u{1F4F7}</div>
        <div class="permission-title">${v.t("permission.title")}</div>
        <div class="permission-desc">${v.t("permission.desc")}</div>
        <div class="permission-steps">
          <div class="permission-step">
            <span class="step-num">1</span>
            <span class="step-text">${v.t("permission.step1")}</span>
          </div>
          <div class="permission-step">
            <span class="step-num">2</span>
            <span class="step-text">${v.t("permission.step2")}</span>
          </div>
        </div>
        <div class="permission-hint">${i}</div>
        <button class="permission-btn" id="btn-request-camera">
          ${v.t("permission.btn")}
        </button>
        <button class="permission-btn-secondary" id="btn-skip-camera">
          ${v.t("permission.skip")}
        </button>
      </div>
    `,document.body.appendChild(s),document.getElementById("btn-request-camera").addEventListener("click",async()=>{let n=await tt();s.remove(),r(n)}),document.getElementById("btn-skip-camera").addEventListener("click",()=>{s.remove(),r(!1)})})}function F(r,e){M||(M=document.getElementById("loading-status"));let t=document.getElementById("btn-start"),s=b.isPreloaded();M&&(r?(M.textContent=r,M.classList.remove("ready")):s?(M.textContent=v.t("loading.ready"),M.classList.add("ready")):(M.textContent=v.t("loading.ready"),M.classList.add("ready"))),t&&(typeof e=="number"?(t.classList.add("loading"),t.style.setProperty("--load-progress",`${e}%`)):s?(t.classList.remove("disabled","loading"),t.classList.add("ready"),t.style.removeProperty("--load-progress")):(t.classList.remove("disabled","loading"),t.classList.add("ready")))}var He=!1;async function st(){if(He)return;let r=["https://cdn.jsdmirror.com/npm/@mediapipe/pose/pose.js","https://cdn.jsdmirror.com/npm/@mediapipe/camera_utils/camera_utils.js"],e=Date.now();await Promise.all(r.map(s=>new Promise((i,n)=>{let a=document.createElement("script");a.src=s,a.onload=i,a.onerror=()=>n(new Error(`Failed to load: ${s}`)),document.head.appendChild(a)}))),He=!0;let t=Date.now()-e;y.mediapipeLoaded(t)}async function it(){await b.preload(),F()}var G="questions",z=10,ye=!1,De="colormaster_bgm_muted",k=localStorage.getItem(De)==="true";document.addEventListener("DOMContentLoaded",()=>{if(y.pageLoad(),Ze()&&(Je(),y.track("wechat_browser_detected")),Ie(),Te(),le.init(),q.init(),T.init(),k&&T.setMuted(!0),rt(),lt(),ct(),v.init(),F(),setTimeout(()=>{he.showInstallPrompt()},2e3),location.hostname==="localhost"||location.hostname==="127.0.0.1"){let e=document.querySelector(".mode-card.debug-mode");e&&(e.style.display="")}nt(),at(),ve(),v.onLangChange(()=>{ve()}),ot();let r=()=>{ye||(ye=!0,k||T.play(1500),document.removeEventListener("click",r),document.removeEventListener("touchstart",r),document.removeEventListener("keydown",r))};document.addEventListener("click",r),document.addEventListener("touchstart",r),document.addEventListener("keydown",r)});function nt(){let r=document.querySelectorAll(".mode-section:not(.learning-target-section):not(.course-section) .mode-card");r.forEach(e=>{e.addEventListener("click",()=>{r.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),G=e.dataset.mode,z=parseInt(e.dataset.value,10),y.selectMode(G,z)})})}function at(){let r=document.querySelectorAll(".learning-target-section .mode-card");r.forEach(e=>{e.addEventListener("click",()=>{r.forEach(s=>s.classList.remove("selected")),e.classList.add("selected");let t=e.dataset.target;t&&(be(t),y.selectTarget(t),ve())})})}function ve(){let r=document.getElementById("course-options");if(!r)return;let e=Object.keys(A),t="";e.forEach((n,a)=>{let o=A[n],l=a===0?"selected":"",d="";if(o.type==="color"&&o.db[0].hex)d=`<span class="mode-icon course-color-icon" style="background-color: ${o.db[0].hex};"></span>`;else{let m=o.db[0],u=typeof o.name=="object"?o.name.en:o.name;d=`<img class="mode-icon course-img-icon" src="${m.image}" alt="${u}">`}let c=v.isZh()?"cn":"en",h=typeof o.name=="object"?o.name[c]:o.name;t+=`
      <div class="mode-card ${l}" data-course="${n}">
        ${d}
        <span class="mode-label">${h}</span>
      </div>
    `}),r.innerHTML=t;let s=r.querySelectorAll(".mode-card");s.forEach(n=>{n.addEventListener("click",()=>{s.forEach(o=>o.classList.remove("selected")),n.classList.add("selected");let a=n.dataset.course;a&&(we(a),y.selectCourse(a))})});let i=r.closest(".course-section");if(i){let n=()=>{let a=r.scrollLeft+r.clientWidth>=r.scrollWidth-10;i.classList.toggle("scrolled-end",a)};r.addEventListener("scroll",n,{passive:!0}),n()}}function ot(){let r=document.querySelectorAll(".detector-btn"),e=document.getElementById("detector-hint"),t=b.getMode();r.forEach(s=>{s.dataset.detector===t?s.classList.add("active"):s.classList.remove("active")}),Re(t,e),r.forEach(s=>{s.addEventListener("click",async()=>{let i=s.dataset.detector;i!==b.getMode()&&(r.forEach(n=>n.classList.remove("active")),s.classList.add("active"),await b.setMode(i),Re(i,e),b.isPreloaded()||(F(),it()))})})}function Re(r,e){if(!e)return;let t={[C.HANDS]:"detector.hint.hands",[C.POSE]:"detector.hint.pose"};e.textContent=v.t(t[r])||""}function rt(){let r=document.getElementById("music-toggle");r&&(k&&r.classList.add("muted"),r.addEventListener("click",e=>{e.stopPropagation(),ye=!0,k=!k,localStorage.setItem(De,k),r.classList.toggle("muted",k),T.setMuted(k),!k&&!T.getIsPlaying()&&T.play(1500),y.toggleBgm(k)}))}function lt(){let r=document.getElementById("lang-toggle");if(!r)return;let e=r.querySelector(".lang-text"),t=s=>{s===I.EN?(r.classList.add("en"),e&&(e.textContent="\u4E2D")):(r.classList.remove("en"),e&&(e.textContent="EN"))};t(v.getLang()),v.onLangChange(t),r.addEventListener("click",s=>{s.stopPropagation();let i=v.toggle()})}function ct(){let r=document.getElementById("help-btn"),e=document.getElementById("help-modal"),t=document.getElementById("help-close"),s=document.getElementById("help-got-it"),i=e?.querySelector(".help-modal-overlay");!r||!e||(r.addEventListener("click",n=>{n.stopPropagation(),e.classList.add("active"),v.updateAllTranslations()}),t?.addEventListener("click",()=>{e.classList.remove("active")}),s?.addEventListener("click",()=>{e.classList.remove("active")}),i?.addEventListener("click",()=>{e.classList.remove("active")}),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.classList.contains("active")&&e.classList.remove("active")}))}function Oe(){let r=window.innerWidth<=900,e=window.innerHeight>window.innerWidth;return r&&e}var ht="colormaster_calibration_enabled",dt=localStorage.getItem(ht)!=="false",Y=!1;window.startGame=async()=>{if(x.unlock(),w.unlock(),Y)return;if(!b.isPreloaded()){Y=!0;let i=document.getElementById("btn-start")?.querySelector(".btn-text"),n=i?.textContent;i&&(i.textContent=v.t("loading.ai"));let a=0,o=setInterval(()=>{a<80?a+=Math.random()*15:a<95&&(a+=Math.random()*2),a=Math.min(a,95),F(v.t("loading.ai"),a)},200);try{await st(),await b.preload(),clearInterval(o),F(v.t("loading.ready"),100),i&&(i.textContent=n),await new Promise(l=>setTimeout(l,300)),F()}catch{clearInterval(o),i&&(i.textContent=v.t("loading.error")||"\u52A0\u8F7D\u5931\u8D25"),Y=!1;return}Y=!1}if(!fe){let s=await et();if(s==="denied"){Me();return}else if(s==="prompt"){let i=await Me()}else fe=!0}let r=document.querySelector(".mode-card.selected[data-mode]");r&&r.dataset.mode&&r.dataset.value&&(G=r.dataset.mode,z=parseInt(r.dataset.value,10)),he.enterFullscreen(),await x.warmUp(),Oe()&&(document.body.classList.add("game-started"),await new Promise(s=>{let i=()=>{Oe()||(window.removeEventListener("resize",i),window.removeEventListener("orientationchange",i),s())};window.addEventListener("resize",i),window.addEventListener("orientationchange",i)})),k||T.getIsPlaying()||T.play(1500),document.body.classList.add("game-started");let e=b.getMode()===C.POSE;dt&&e&&ue.shouldShow()?ue.start(()=>{Ae()}):Ae()};function Ae(){if(!k){let r=V(),e=N(),t=typeof r.name=="object"?r.name.en:r.name;x.speakWelcome(t,e)}k||T.enterGameMode(500),y.gameStart(G,z),le.start(G,z)}
