<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-site-verification" content="codeva-odZno92jxn" />
    <meta name="360-site-verification" content="b46a7087f21ff6cf8dcee8ee59ee9a61" />
    <meta name="sogou_site_verification" content="F2mmMQ4NdU" />

    <title>ã€Œè¿è½½ä¸ƒã€ä¼˜é›…çš„é‡å¯æœåŠ¡ | çŸ¥è¯†é“ºçš„åšå®¢</title>
    <meta property="og:title" content="ã€Œè¿è½½ä¸ƒã€ä¼˜é›…çš„é‡å¯æœåŠ¡ - çŸ¥è¯†é“ºçš„åšå®¢">
    <meta property="og:type" content="article">
    
    <meta property="article:published_time" content='2018-03-15T12:00:00&#43;08:00'>
    
    
    <meta property="article:modified_time" content='2018-03-15T12:00:00&#43;08:00'>
    
    <meta name="Keywords" content="golang,goè¯­è¨€,goè¯­è¨€ç¬”è®°,çŸ¥è¯†é“º,java,android,åšå®¢,é¡¹ç›®ç®¡ç†,python,è½¯ä»¶æ¶æ„,å…¬ä¼—å·,å°ç¨‹åº">
    <meta name="description" content="ã€Œè¿è½½ä¸ƒã€ä¼˜é›…çš„é‡å¯æœåŠ¡">
    <meta name="author" content="çŸ¥è¯†é“º">
    
    <meta property="og:url" content="https://index.zshipu.com/go/posts/go/gin/2018-03-15-reload-http/">
    <link rel="shortcut icon" href='/go/favicon.ico' type="image/x-icon">

    <link rel="stylesheet" href='/go/css/normalize.css'>
    <link rel="stylesheet" href='/go/css/style.css'>

    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script data-ad-client="ca-pub-2874221941555456" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    

    

    
    
    
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WLWJSST');</script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BY5XJ2PJ93"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-BY5XJ2PJ93');
    </script>
    

</head>

<body>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLWJSST"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://index.zshipu.com/go/">
                        çŸ¥è¯†é“ºçš„åšå®¢
                    </a>
                
                <p class="description">ä¸“æ³¨äºAndroidã€Javaã€Goè¯­è¨€(golang)ã€ç§»åŠ¨äº’è”ç½‘ã€é¡¹ç›®ç®¡ç†ã€è½¯ä»¶æ¶æ„</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://index.zshipu.com/go/">é¦–é¡µ</a>
                    
                    <a  href="https://index.zshipu.com" title="æ€»ç«™">æ€»ç«™</a>
                    
                    <a  href="https://index.zshipu.com/go/archives/" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://index.zshipu.com/go/about/" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#çŸ¥è¯†ç‚¹">çŸ¥è¯†ç‚¹</a></li>
    <li><a href="#æœ¬æ–‡ç›®æ ‡">æœ¬æ–‡ç›®æ ‡</a></li>
    <li><a href="#ctrl--c">ctrl + c</a>
      <ul>
        <li><a href="#ä¿¡å·">ä¿¡å·</a></li>
        <li><a href="#æ‰€æœ‰ä¿¡å·">æ‰€æœ‰ä¿¡å·</a></li>
      </ul>
    </li>
    <li><a href="#æ€æ ·ç®—ä¼˜é›…">æ€æ ·ç®—ä¼˜é›…</a>
      <ul>
        <li><a href="#ç›®çš„">ç›®çš„</a></li>
        <li><a href="#æµç¨‹">æµç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#å®ç°ä¼˜é›…é‡å¯">å®ç°ä¼˜é›…é‡å¯</a>
      <ul>
        <li><a href="#endless">endless</a></li>
        <li><a href="#httpserver---shutdown">http.Server - Shutdown()</a></li>
      </ul>
    </li>
    <li><a href="#å°ç»“">å°ç»“</a>
      <ul>
        <li><a href="#æ‹“å±•é˜…è¯»">æ‹“å±•é˜…è¯»</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">ã€Œè¿è½½ä¸ƒã€ä¼˜é›…çš„é‡å¯æœåŠ¡</h1>
        </header>
        <date class="post-meta meta-date">
            2018å¹´3æœˆ15æ—¥
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    é˜…è¯»</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">æ–‡ç« ç›®å½•</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="çŸ¥è¯†ç‚¹">çŸ¥è¯†ç‚¹</h2>
<ul>
<li>ä¿¡å·é‡çš„äº†è§£ã€‚</li>
<li>åº”ç”¨çƒ­æ›´æ–°ã€‚</li>
</ul>
<h2 id="æœ¬æ–‡ç›®æ ‡">æœ¬æ–‡ç›®æ ‡</h2>
<p>åœ¨å‰é¢ç¼–å†™æ¡ˆä¾‹ä»£ç æ—¶ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¼šæƒ³åˆ°ï¼Œæ¯æ¬¡æ›´æ–°å®Œä»£ç ï¼Œæ›´æ–°å®Œé…ç½®æ–‡ä»¶åï¼Œå°±ç›´æ¥è¿™ä¹ˆ <code>ctrl+c</code> çœŸçš„æ²¡é—®é¢˜å—ï¼Œ<code>ctrl+c</code>åˆ°åº•åšäº†äº›ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ</p>
<p>åœ¨è¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬ç®€å•è®²è¿° <code>ctrl+c</code> èƒŒåçš„<strong>ä¿¡å·</strong>ä»¥åŠå¦‚ä½•åœ¨<code>Gin</code>ä¸­<strong>ä¼˜é›…çš„é‡å¯æœåŠ¡</strong>ï¼Œä¹Ÿå°±æ˜¯å¯¹ <code>HTTP</code> æœåŠ¡è¿›è¡Œçƒ­æ›´æ–°ã€‚</p>
<h2 id="ctrl--c">ctrl + c</h2>
<blockquote>
<p>å†…æ ¸åœ¨æŸäº›æƒ…å†µä¸‹å‘é€ä¿¡å·ï¼Œæ¯”å¦‚åœ¨è¿›ç¨‹å¾€ä¸€ä¸ªå·²ç»å…³é—­çš„ç®¡é“å†™æ•°æ®æ—¶ä¼šäº§ç”Ÿ<code>SIGPIPE</code>ä¿¡å·</p>
</blockquote>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œç‰¹å®šçš„ç»„åˆé”®å¯ä»¥ä½¿ç³»ç»Ÿå‘é€ç‰¹å®šçš„ä¿¡å·ç»™æ­¤è¿›ç¨‹ï¼Œå®Œæˆä¸€ç³»åˆ—çš„åŠ¨ä½œ</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä¿¡å·</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>ctrl + c</td>
<td>SIGINT</td>
<td>å¼ºåˆ¶è¿›ç¨‹ç»“æŸ</td>
</tr>
<tr>
<td>ctrl + z</td>
<td>SIGTSTP</td>
<td>ä»»åŠ¡ä¸­æ–­ï¼Œè¿›ç¨‹æŒ‚èµ·</td>
</tr>
<tr>
<td>ctrl + \</td>
<td>SIGQUIT</td>
<td>è¿›ç¨‹ç»“æŸ å’Œ <code>dump core</code></td>
</tr>
<tr>
<td>ctrl + d</td>
<td></td>
<td>EOF</td>
</tr>
<tr>
<td></td>
<td>SIGHUP</td>
<td>ç»ˆæ­¢æ”¶åˆ°è¯¥ä¿¡å·çš„è¿›ç¨‹ã€‚è‹¥ç¨‹åºä¸­æ²¡æœ‰æ•æ‰è¯¥ä¿¡å·ï¼Œå½“æ”¶åˆ°è¯¥ä¿¡å·æ—¶ï¼Œè¿›ç¨‹å°±ä¼šé€€å‡ºï¼ˆå¸¸ç”¨äº é‡å¯ã€é‡æ–°åŠ è½½è¿›ç¨‹ï¼‰</td>
</tr>
</tbody>
</table>
<p>å› æ­¤åœ¨æˆ‘ä»¬æ‰§è¡Œ<code>ctrl + c</code>å…³é—­<code>gin</code>æœåŠ¡ç«¯æ—¶ï¼Œ<strong>ä¼šå¼ºåˆ¶è¿›ç¨‹ç»“æŸï¼Œå¯¼è‡´æ­£åœ¨è®¿é—®çš„ç”¨æˆ·ç­‰å‡ºç°é—®é¢˜</strong></p>
<p>å¸¸è§çš„ <code>kill -9 pid</code> ä¼šå‘é€ <code>SIGKILL</code> ä¿¡å·ç»™è¿›ç¨‹ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ç»“æœ</p>
<h3 id="ä¿¡å·">ä¿¡å·</h3>
<p>æœ¬æ®µä¸­åå¤å‡ºç°<strong>ä¿¡å·</strong>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¿¡å·æ˜¯ <code>Unix</code> ã€ç±» <code>Unix</code> ä»¥åŠå…¶ä»– <code>POSIX</code> å…¼å®¹çš„æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šè®¯çš„ä¸€ç§æœ‰é™åˆ¶çš„æ–¹å¼</p>
<p>å®ƒæ˜¯ä¸€ç§å¼‚æ­¥çš„é€šçŸ¥æœºåˆ¶ï¼Œç”¨æ¥æé†’è¿›ç¨‹ä¸€ä¸ªäº‹ä»¶ï¼ˆç¡¬ä»¶å¼‚å¸¸ã€ç¨‹åºæ‰§è¡Œå¼‚å¸¸ã€å¤–éƒ¨å‘å‡ºä¿¡å·ï¼‰å·²ç»å‘ç”Ÿã€‚å½“ä¸€ä¸ªä¿¡å·å‘é€ç»™ä¸€ä¸ªè¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¸­æ–­äº†è¿›ç¨‹æ­£å¸¸çš„æ§åˆ¶æµç¨‹ã€‚æ­¤æ—¶ï¼Œä»»ä½•éåŸå­æ“ä½œéƒ½å°†è¢«ä¸­æ–­ã€‚å¦‚æœè¿›ç¨‹å®šä¹‰äº†ä¿¡å·çš„å¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ‰§è¡Œï¼Œå¦åˆ™å°±æ‰§è¡Œé»˜è®¤çš„å¤„ç†å‡½æ•°</p>
<h3 id="æ‰€æœ‰ä¿¡å·">æ‰€æœ‰ä¿¡å·</h3>
<pre tabindex="0"><code>$ kill -l
 1) SIGHUP   2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP
 6) SIGABRT  7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1
11) SIGSEGV 12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP
21) SIGTTIN 22) SIGTTOU 23) SIGURG  24) SIGXCPU 25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF 28) SIGWINCH    29) SIGIO   30) SIGPWR
31) SIGSYS  34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX
</code></pre><h2 id="æ€æ ·ç®—ä¼˜é›…">æ€æ ·ç®—ä¼˜é›…</h2>
<h3 id="ç›®çš„">ç›®çš„</h3>
<ul>
<li>ä¸å…³é—­ç°æœ‰è¿æ¥ï¼ˆæ­£åœ¨è¿è¡Œä¸­çš„ç¨‹åºï¼‰</li>
<li>æ–°çš„è¿›ç¨‹å¯åŠ¨å¹¶æ›¿ä»£æ—§è¿›ç¨‹</li>
<li>æ–°çš„è¿›ç¨‹æ¥ç®¡æ–°çš„è¿æ¥</li>
<li>è¿æ¥è¦éšæ—¶å“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œå½“ç”¨æˆ·ä»åœ¨è¯·æ±‚æ—§è¿›ç¨‹æ—¶è¦ä¿æŒè¿æ¥ï¼Œæ–°ç”¨æˆ·åº”è¯·æ±‚æ–°è¿›ç¨‹ï¼Œä¸å¯ä»¥å‡ºç°æ‹’ç»è¯·æ±‚çš„æƒ…å†µ</li>
</ul>
<h3 id="æµç¨‹">æµç¨‹</h3>
<p>1ã€æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p>2ã€å‘é€ä¿¡å·é‡ <code>SIGHUP</code></p>
<p>3ã€æ‹’ç»æ–°è¿æ¥è¯·æ±‚æ—§è¿›ç¨‹ï¼Œä½†è¦ä¿è¯å·²æœ‰è¿æ¥æ­£å¸¸</p>
<p>4ã€å¯åŠ¨æ–°çš„å­è¿›ç¨‹</p>
<p>5ã€æ–°çš„å­è¿›ç¨‹å¼€å§‹ <code>Accet</code></p>
<p>6ã€ç³»ç»Ÿå°†æ–°çš„è¯·æ±‚è½¬äº¤æ–°çš„å­è¿›ç¨‹</p>
<p>7ã€æ—§è¿›ç¨‹å¤„ç†å®Œæ‰€æœ‰æ—§è¿æ¥åæ­£å¸¸ç»“æŸ</p>
<h2 id="å®ç°ä¼˜é›…é‡å¯">å®ç°ä¼˜é›…é‡å¯</h2>
<h3 id="endless">endless</h3>
<blockquote>
<p>Zero downtime restarts for golang HTTP and HTTPS servers. (for golang 1.3+)</p>
</blockquote>
<p>æˆ‘ä»¬å€ŸåŠ© <a href="https://github.com/fvbock/endless">fvbock/endless</a> æ¥å®ç° <code>Golang HTTP/HTTPS</code> æœåŠ¡é‡æ–°å¯åŠ¨çš„é›¶åœæœº</p>
<p><code>endless server</code> ç›‘å¬ä»¥ä¸‹å‡ ç§ä¿¡å·é‡ï¼š</p>
<ul>
<li>syscall.SIGHUPï¼šè§¦å‘ <code>fork</code> å­è¿›ç¨‹å’Œé‡æ–°å¯åŠ¨</li>
<li>syscall.SIGUSR1/syscall.SIGTSTPï¼šè¢«ç›‘å¬ï¼Œä½†ä¸ä¼šè§¦å‘ä»»ä½•åŠ¨ä½œ</li>
<li>syscall.SIGUSR2ï¼šè§¦å‘ <code>hammerTime</code></li>
<li>syscall.SIGINT/syscall.SIGTERMï¼šè§¦å‘æœåŠ¡å™¨å…³é—­ï¼ˆä¼šå®Œæˆæ­£åœ¨è¿è¡Œçš„è¯·æ±‚ï¼‰</li>
</ul>
<p><code>endless</code> æ­£æ­£æ˜¯ä¾é ç›‘å¬è¿™äº›<strong>ä¿¡å·é‡</strong>ï¼Œå®Œæˆç®¡æ§çš„ä¸€ç³»åˆ—åŠ¨ä½œ</p>
<h4 id="å®‰è£…">å®‰è£…</h4>
<pre tabindex="0"><code>go get -u github.com/fvbock/endless
</code></pre><h4 id="ç¼–å†™">ç¼–å†™</h4>
<p>æ‰“å¼€ <a href="https://github.com/zshipu/go-gin-example">gin-blog</a> çš„ <code>main.go</code>æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;syscall&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;github.com/fvbock/endless&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;gin-blog/routers&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;gin-blog/pkg/setting&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>    endless.DefaultReadTimeOut = setting.ReadTimeout
</span></span><span style="display:flex;"><span>    endless.DefaultWriteTimeOut = setting.WriteTimeout
</span></span><span style="display:flex;"><span>    endless.DefaultMaxHeaderBytes = <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#099">20</span>
</span></span><span style="display:flex;"><span>    endPoint <span style="color:#000;font-weight:bold">:=</span> fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;:%d&#34;</span>, setting.HTTPPort)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#000;font-weight:bold">:=</span> endless.<span style="color:#900;font-weight:bold">NewServer</span>(endPoint, routers.<span style="color:#900;font-weight:bold">InitRouter</span>())
</span></span><span style="display:flex;"><span>    server.BeforeBegin = <span style="color:#000;font-weight:bold">func</span>(add <span style="color:#458;font-weight:bold">string</span>) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Actual pid is %d&#34;</span>, syscall.<span style="color:#900;font-weight:bold">Getpid</span>())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    err <span style="color:#000;font-weight:bold">:=</span> server.<span style="color:#900;font-weight:bold">ListenAndServe</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Server err: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>endless.NewServer</code> è¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„ <code>endlessServer</code> å¯¹è±¡ï¼Œåœ¨ <code>BeforeBegin</code> æ—¶è¾“å‡ºå½“å‰è¿›ç¨‹çš„ <code>pid</code>ï¼Œè°ƒç”¨ <code>ListenAndServe</code> å°†å®é™…â€œå¯åŠ¨â€æœåŠ¡</p>
<h4 id="éªŒè¯">éªŒè¯</h4>
<h5 id="ç¼–è¯‘"><strong>ç¼–è¯‘</strong></h5>
<pre tabindex="0"><code>$ go build main.go
</code></pre><h5 id="æ‰§è¡Œ"><strong>æ‰§è¡Œ</strong></h5>
<pre tabindex="0"><code>$ ./main
[GIN-debug] [WARNING] Running in &#34;debug&#34; mode. Switch to &#34;release&#34; mode in production.
...
Actual pid is 48601
</code></pre><p>å¯åŠ¨æˆåŠŸåï¼Œè¾“å‡ºäº†<code>pid</code>ä¸º 48601ï¼›åœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ <code>kill -1 48601</code> ï¼Œæ£€éªŒå…ˆå‰æœåŠ¡çš„ç»ˆç«¯æ•ˆæœ</p>
<pre tabindex="0"><code>[root@localhost go-gin-example]# ./main
[GIN-debug] [WARNING] Running in &#34;debug&#34; mode. Switch to &#34;release&#34; mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /auth                     --&gt; ...
[GIN-debug] GET    /api/v1/tags              --&gt; ...
...

Actual pid is 48601

...

Actual pid is 48755
48601 Received SIGTERM.
48601 [::]:8000 Listener closed.
48601 Waiting for connections to finish...
48601 Serve() returning...
Server err: accept tcp [::]:8000: use of closed network connection
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥å‘½ä»¤å·²ç»æŒ‚èµ·ï¼Œå¹¶ä¸” <code>fork</code> äº†æ–°çš„å­è¿›ç¨‹ <code>pid</code> ä¸º <code>48755</code></p>
<pre tabindex="0"><code>48601 Received SIGTERM.
48601 [::]:8000 Listener closed.
48601 Waiting for connections to finish...
48601 Serve() returning...
Server err: accept tcp [::]:8000: use of closed network connection
</code></pre><p>å¤§è‡´æ„æ€ä¸ºä¸»è¿›ç¨‹ï¼ˆ<code>pid</code>ä¸º 48601ï¼‰æ¥å—åˆ° <code>SIGTERM</code> ä¿¡å·é‡ï¼Œå…³é—­ä¸»è¿›ç¨‹çš„ç›‘å¬å¹¶ä¸”ç­‰å¾…æ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚å®Œæˆï¼›è¿™ä¸æˆ‘ä»¬å…ˆå‰çš„æè¿°ä¸€è‡´</p>
<h5 id="å”¤é†’"><strong>å”¤é†’</strong></h5>
<p>è¿™æ—¶å€™åœ¨ <code>postman</code> ä¸Šå†æ¬¡è®¿é—®æˆ‘ä»¬çš„æ¥å£ï¼Œä½ å¯ä»¥æƒŠå–œçš„å‘ç°ï¼Œä»–â€œå¤æ´»â€äº†ï¼</p>
<pre tabindex="0"><code>Actual pid is 48755
48601 Received SIGTERM.
48601 [::]:8000 Listener closed.
48601 Waiting for connections to finish...
48601 Serve() returning...
Server err: accept tcp [::]:8000: use of closed network connection


$ [GIN] 2018/03/15 - 13:00:16 | 200 |     188.096Âµs |   192.168.111.1 | GET      /api/v1/tags...
</code></pre><p>è¿™å°±å®Œæˆäº†ä¸€æ¬¡æ­£å‘çš„æµè½¬äº†</p>
<p>ä½ æƒ³æƒ³ï¼Œæ¯æ¬¡æ›´æ–°å‘å¸ƒã€æˆ–è€…ä¿®æ”¹é…ç½®æ–‡ä»¶ç­‰ï¼Œåªéœ€è¦ç»™è¯¥è¿›ç¨‹å‘é€<strong>SIGTERM ä¿¡å·</strong>ï¼Œè€Œä¸éœ€è¦å¼ºåˆ¶ç»“æŸåº”ç”¨ï¼Œæ˜¯å¤šä¹ˆä¾¿æ·åˆå®‰å…¨çš„äº‹ï¼</p>
<h4 id="é—®é¢˜">é—®é¢˜</h4>
<p><code>endless</code> çƒ­æ›´æ–°æ˜¯é‡‡å–åˆ›å»ºå­è¿›ç¨‹åï¼Œå°†åŸè¿›ç¨‹é€€å‡ºçš„æ–¹å¼ï¼Œè¿™ç‚¹ä¸ç¬¦åˆå®ˆæŠ¤è¿›ç¨‹çš„è¦æ±‚</p>
<h3 id="httpserver---shutdown">http.Server - Shutdown()</h3>
<p>å¦‚æœä½ çš„<code>Golang &gt;= 1.8</code>ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>http.Server</code> çš„ <a href="https://golang.org/pkg/net/http/#Server.Shutdown">Shutdown</a> æ–¹æ³•</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;os/signal&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;gin-blog/routers&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;gin-blog/pkg/setting&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>    router <span style="color:#000;font-weight:bold">:=</span> routers.<span style="color:#900;font-weight:bold">InitRouter</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    s <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&amp;</span>http.Server{
</span></span><span style="display:flex;"><span>        Addr:           fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;:%d&#34;</span>, setting.HTTPPort),
</span></span><span style="display:flex;"><span>        Handler:        router,
</span></span><span style="display:flex;"><span>        ReadTimeout:    setting.ReadTimeout,
</span></span><span style="display:flex;"><span>        WriteTimeout:   setting.WriteTimeout,
</span></span><span style="display:flex;"><span>        MaxHeaderBytes: <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#099">20</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">go</span> <span style="color:#000;font-weight:bold">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> s.<span style="color:#900;font-weight:bold">ListenAndServe</span>(); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Listen: %s\n&#34;</span>, err)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    quit <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>(<span style="color:#000;font-weight:bold">chan</span> os.Signal)
</span></span><span style="display:flex;"><span>    signal.<span style="color:#900;font-weight:bold">Notify</span>(quit, os.Interrupt)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;-</span> quit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    log.<span style="color:#900;font-weight:bold">Println</span>(<span style="color:#d14">&#34;Shutdown Server ...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ctx, cancel <span style="color:#000;font-weight:bold">:=</span> context.<span style="color:#900;font-weight:bold">WithTimeout</span>(context.<span style="color:#900;font-weight:bold">Background</span>(), <span style="color:#099">5</span> <span style="color:#000;font-weight:bold">*</span> time.Second)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">defer</span> <span style="color:#900;font-weight:bold">cancel</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> s.<span style="color:#900;font-weight:bold">Shutdown</span>(ctx); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        log.<span style="color:#900;font-weight:bold">Fatal</span>(<span style="color:#d14">&#34;Server Shutdown:&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    log.<span style="color:#900;font-weight:bold">Println</span>(<span style="color:#d14">&#34;Server exiting&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å°ç»“">å°ç»“</h2>
<p>åœ¨æ—¥å¸¸çš„æœåŠ¡ä¸­ï¼Œä¼˜é›…çš„é‡å¯ï¼ˆçƒ­æ›´æ–°ï¼‰æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ã€‚è€Œ <code>Golang</code> åœ¨ <code>HTTP</code> æœåŠ¡æ–¹é¢çš„çƒ­æ›´æ–°ä¹Ÿæœ‰ä¸å°‘æ–¹æ¡ˆäº†ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å®é™…åº”ç”¨åœºæ™¯æŒ‘é€‰æœ€åˆé€‚çš„</p>
<h3 id="æ‹“å±•é˜…è¯»">æ‹“å±•é˜…è¯»</h3>
<ul>
<li><a href="https://github.com/braintree/manners">manners</a></li>
<li><a href="https://github.com/tylerb/graceful">graceful</a></li>
<li><a href="https://github.com/facebookgo/grace">grace</a></li>
<li><a href="https://github.com/golang/go/commit/0cbb12f0bbaeb3893b3d011fdb1a270291747ab0">plugin: new package for loading plugins Â· golang/go@0cbb12f Â· GitHub</a></li>
</ul>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>åŸæ–‡ä½œè€…ï¼š</strong><a rel="author" href="https://index.zshipu.com/go/">çŸ¥è¯†é“º</a></li>
        <li style="word-break:break-all"><strong>åŸæ–‡é“¾æ¥ï¼š</strong><a href="https://index.zshipu.com/go/posts/go/gin/2018-03-15-reload-http/">https://index.zshipu.com/go/posts/go/gin/2018-03-15-reload-http/</a></li>
        <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼ˆä½œè€…ï¼ŒåŸæ–‡é“¾æ¥ï¼‰ï¼Œå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒã€‚</li>
        <li><strong>å…è´£å£°æ˜ï¼š</strong>æœ¬é¡µé¢å†…å®¹å‡æ¥æºäºç«™å†…ç¼–è¾‘å‘å¸ƒï¼Œéƒ¨åˆ†ä¿¡æ¯æ¥æºäº’è”ç½‘ï¼Œå¹¶ä¸æ„å‘³ç€æœ¬ç«™èµåŒå…¶è§‚ç‚¹æˆ–è€…è¯å®å…¶å†…å®¹çš„çœŸå®æ€§ï¼Œå¦‚æ¶‰åŠç‰ˆæƒç­‰é—®é¢˜ï¼Œè¯·ç«‹å³è”ç³»å®¢æœè¿›è¡Œæ›´æ”¹æˆ–åˆ é™¤ï¼Œä¿è¯æ‚¨çš„åˆæ³•æƒç›Šã€‚è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚ä¹Ÿå¯ä»¥é‚®ä»¶è‡³ sblig@126.com</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/go/posts/go/gin/2018-02-15-log/">ã€Œè¿è½½å…­ã€ç¼–å†™ä¸€ä¸ªç®€å•çš„æ–‡ä»¶æ—¥å¿—</a></li>
        
        <li><a href="/go/posts/go/gin/2018-02-14-jwt/">ã€Œè¿è½½äº”ã€ä½¿ç”¨ JWT è¿›è¡Œèº«ä»½æ ¡éªŒ</a></li>
        
        <li><a href="/go/posts/go/gin/2018-02-13-api-03/">ã€Œè¿è½½å››ã€Ginæ­å»ºBlog API&#39;s ï¼ˆä¸‰ï¼‰</a></li>
        
        <li><a href="/go/posts/go/gin/2018-02-12-api-02/">ã€Œè¿è½½ä¸‰ã€Ginæ­å»ºBlog API&#39;s ï¼ˆäºŒï¼‰</a></li>
        
        <li><a href="/go/posts/go/gin/2018-02-11-api-01/">ã€Œè¿è½½äºŒã€Ginæ­å»ºBlog API&#39;s ï¼ˆä¸€ï¼‰</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/go/tags/go'>go</a></li>
                
                <li><a href='/go/tags/gin'>gin</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "zshipu/zshipu-index"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://index.zshipu.com/go/">çŸ¥è¯†é“ºçš„åšå®¢ By çŸ¥è¯†é“º</a>
        
        | <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">æµ™ ICP å¤‡19032823å·-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">é£é›ªæ— æƒ…</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/go/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://index.zshipu.com/go/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://index.zshipu.com/go/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go1.16-3/" title="Go1.16 æ–°ç‰¹æ€§ï¼šè¯¦è§£å†…å­˜ç®¡ç†æœºåˆ¶çš„å˜æ›´ï¼Œä½ éœ€è¦äº†è§£">Go1.16 æ–°ç‰¹æ€§ï¼šè¯¦è§£å†…å­˜ç®¡ç†æœºåˆ¶çš„å˜æ›´ï¼Œä½ éœ€è¦äº†è§£</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go1.16-2/" title="Go1.16 æ–°ç‰¹æ€§ï¼šå¿«é€Ÿä¸Šæ‰‹ Go embed">Go1.16 æ–°ç‰¹æ€§ï¼šå¿«é€Ÿä¸Šæ‰‹ Go embed</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go1.16-1/" title="Go1.16 å³å°†æ­£å¼å‘å¸ƒï¼Œä»¥ä¸‹å˜æ›´ä½ éœ€è¦çŸ¥é“">Go1.16 å³å°†æ­£å¼å‘å¸ƒï¼Œä»¥ä¸‹å˜æ›´ä½ éœ€è¦çŸ¥é“</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/generics-proposal/" title="å¿«æŠ¥ï¼šæ­£å¼ææ¡ˆå°†æ³›å‹ç‰¹æ€§åŠ å…¥ Go è¯­è¨€">å¿«æŠ¥ï¼šæ­£å¼ææ¡ˆå°†æ³›å‹ç‰¹æ€§åŠ å…¥ Go è¯­è¨€</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/news/2021-ecug/" title="æ¨èä¸€ä¸ªç‰›é€¼çš„æŠ€æœ¯ç¤¾åŒºï¼">æ¨èä¸€ä¸ªç‰›é€¼çš„æŠ€æœ¯ç¤¾åŒºï¼</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/news/2020-top100/" title="åè¡€æ•´ç† | å¿«é€Ÿäº†è§£å…¨çƒè½¯ä»¶æ¡ˆä¾‹ï¼ˆTop100ï¼‰">åè¡€æ•´ç† | å¿«é€Ÿäº†è§£å…¨çƒè½¯ä»¶æ¡ˆä¾‹ï¼ˆTop100ï¼‰</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go-error2panic/" title="Go é”™è¯¯å¤„ç†ï¼šç”¨ panic å–ä»£ err != nil çš„æ¨¡å¼">Go é”™è¯¯å¤„ç†ï¼šç”¨ panic å–ä»£ err != nil çš„æ¨¡å¼</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go-concurrent-lock/" title="Go å¹¶å‘ï¼šä¸€äº›æœ‰è¶£çš„ç°è±¡å’Œè¦é¿å¼€çš„ â€œå‘â€">Go å¹¶å‘ï¼šä¸€äº›æœ‰è¶£çš„ç°è±¡å’Œè¦é¿å¼€çš„ â€œå‘â€</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/go2-errors/" title="å…ˆç¹ä¸ºå¿«ï¼ŒGo2 Error çš„æŒ£æ‰ä¹‹è·¯">å…ˆç¹ä¸ºå¿«ï¼ŒGo2 Error çš„æŒ£æ‰ä¹‹è·¯</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/go/posts/go/gophercon2020-errors/" title="é‡ç£…ï¼šGo errors å°†ä¸ä¼šæœ‰ä»»ä½•è¿›ä¸€æ­¥çš„æ”¹è¿›è®¡åˆ’">é‡ç£…ï¼šGo errors å°†ä¸ä¼šæœ‰ä»»ä½•è¿›ä¸€æ­¥çš„æ”¹è¿›è®¡åˆ’</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">ç¦åˆ©æ´¾é€</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="ä¸€èµ·ä¸Š Cometï¼ŒAI å·¥å…·å…è´¹ç”¨è¿˜é€é’±ï½" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250843697.png">
                
            </a>
        </li>
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="é‚€è¯·æœ‰ç¤¼ ğŸ ä¸€èµ·ç”¨ Cometï¼ŒAI åŠ©ä½ æ›´é«˜æ•ˆè¿˜é€é’±ï¼" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250850822.png">
                
            </a>
        </li>
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="AI å·¥å…·çœŸé¦™ï¼æˆ‘ç”¨çš„ Comet å…è´¹é€ä¸€ä¸ªæœˆ Proï½" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250851688.png">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title"><a href='/go/categories/'>åˆ†ç±»</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/go/tags/'>æ ‡ç­¾</a></h3>
<div class="tagcloud">
    
    <a href="https://index.zshipu.com/go/tags/ecug/">Ecug</a>
    
    <a href="https://index.zshipu.com/go/tags/gin/">Gin</a>
    
    <a href="https://index.zshipu.com/go/tags/go/">Go</a>
    
    <a href="https://index.zshipu.com/go/tags/go-modules/">Go-Modules</a>
    
    <a href="https://index.zshipu.com/go/tags/grpc/">Grpc</a>
    
    <a href="https://index.zshipu.com/go/tags/grpc-gateway/">Grpc-Gateway</a>
    
    <a href="https://index.zshipu.com/go/tags/kubernetes/">Kubernetes</a>
    
    <a href="https://index.zshipu.com/go/tags/prometheus/">Prometheus</a>
    
    <a href="https://index.zshipu.com/go/tags/protobuf/">Protobuf</a>
    
    <a href="https://index.zshipu.com/go/tags/top100/">Top100</a>
    
    <a href="https://index.zshipu.com/go/tags/untagged/">Untagged</a>
    
    <a href="https://index.zshipu.com/go/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">å¾®æœåŠ¡</a>
    
    <a href="https://index.zshipu.com/go/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">æ•°æ®åˆ†æ</a>
    
    <a href="https://index.zshipu.com/go/tags/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/">æœåŠ¡æ²»ç†</a>
    
    <a href="https://index.zshipu.com/go/tags/%E6%B3%9B%E5%9E%8B/">æ³›å‹</a>
    
    <a href="https://index.zshipu.com/go/tags/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86/">æ·±åº¦è§£å¯†</a>
    
    <a href="https://index.zshipu.com/go/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">æºç åˆ†æ</a>
    
    <a href="https://index.zshipu.com/go/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/">ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://blog.zshipu.com//" title="çŸ¥è¯†é“ºçš„åšå®¢">çŸ¥è¯†é“ºçš„åšå®¢</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://index.zshipu.com/go/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>