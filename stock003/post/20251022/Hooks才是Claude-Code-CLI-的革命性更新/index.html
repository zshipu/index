<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-site-verification" content="codeva-odZno92jxn" />
    <meta name="360-site-verification" content="b46a7087f21ff6cf8dcee8ee59ee9a61" />
    <meta name="sogou_site_verification" content="F2mmMQ4NdU" />

    <title>Hooks才是Claude Code CLI 的革命性更新 --知识铺 | 股票资讯  --  知识铺</title>
    <meta property="og:title" content="Hooks才是Claude Code CLI 的革命性更新 --知识铺 - 股票资讯  --  知识铺">
    <meta property="og:type" content="article">
    
    <meta property="article:published_time" content='2025-10-24T12:43:31&#43;08:00'>
    
    
    <meta property="article:modified_time" content='2025-10-24T12:43:31&#43;08:00'>
    
    <meta name="Keywords" content="股票 股票资讯 实时、真实、趋势、热点 消息">
    <meta name="description" content="Hooks才是Claude Code CLI 的革命性更新 --知识铺">
    
    <meta name="author" content="知识铺">
    <meta property="og:url" content="https://index.zshipu.com/stock003/post/20251022/Hooks%E6%89%8D%E6%98%AFClaude-Code-CLI-%E7%9A%84%E9%9D%A9%E5%91%BD%E6%80%A7%E6%9B%B4%E6%96%B0/">
    <link rel="shortcut icon" href='/stock003/favicon.ico' type="image/x-icon">

    <link rel="stylesheet" href='/stock003/css/normalize.css'>
    <link rel="stylesheet" href='/stock003/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script data-ad-client="ca-pub-2874221941555456" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    

    

    
    
    
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WLWJSST');</script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BY5XJ2PJ93"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-BY5XJ2PJ93');
    </script>
    
</head>

<body>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLWJSST"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://index.zshipu.com/stock003/">
                        股票资讯  --  知识铺
                    </a>
                
                <p class="description">专注于实时股票资讯博客编写，实时、真实、趋势、热点</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://index.zshipu.com/stock003/">首页</a>
                    
                    <a  href="https://index.zshipu.com" title="总站">总站</a>
                    
                    <a  href="https://index.zshipu.com/stock/" title="股票">股票</a>
                    
                    <a  href="https://index.zshipu.com/stocktactics/" title="股票策略">股票策略</a>
                    
                    <a  href="https://index.zshipu.com/stock002/" title="股票资讯">股票资讯</a>
                    
                    <a  href="https://index.zshipu.com/stock003/archives/" title="归档">归档</a>
                    
                    <a  href="https://index.zshipu.com/stock003/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#当前使用版本">当前使用版本</a></li>
    <li><a href="#配置文件">配置文件</a></li>
    <li><a href="#hook事件及匹配器">Hook事件及匹配器</a>
      <ul>
        <li><a href="#hook事件">Hook事件</a></li>
        <li><a href="#pretooluse和posttooluse匹配器">PreToolUse和PostToolUse匹配器</a></li>
        <li><a href="#precompact匹配器">PreCompact匹配器</a></li>
        <li><a href="#sessionstart匹配器">SessionStart匹配器</a></li>
        <li><a href="#sessionend匹配器">SessionEnd匹配器</a></li>
      </ul>
    </li>
    <li><a href="#基本使用">基本使用</a>
      <ul>
        <li><a href="#读取命令行参数">读取命令行参数</a></li>
        <li><a href="#代码格式化">代码格式化</a></li>
        <li><a href="#执行脚本">执行脚本</a></li>
        <li><a href="#触发通知">触发通知</a></li>
        <li><a href="#文件保护">文件保护</a></li>
        <li><a href="#敏感提示词过滤">敏感提示词过滤</a></li>
        <li><a href="#markdown格式化">Markdown格式化</a></li>
        <li><a href="#自动批准">自动批准</a></li>
        <li><a href="#mcp钩子">MCP钩子</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#友情提示">友情提示</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Hooks才是Claude Code CLI 的革命性更新 --知识铺</h1>
        </header>
        <date class="post-meta meta-date">
            2025年10月24日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h2 id="前言">前言</h2>
<p>前面对Claude Code CLI有了基本了解，今天继续深度探索Claude Code CLI Hooks的使用方式。对往期内容感兴趣的小伙伴也可以看往期内容：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493035&amp;idx=1&amp;sn=9ccc174a34a0ee59e6a609e409b09908&amp;scene=21#wechat_redirect">Claude Code CLI平台与中转站接入汇总及避坑</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493062&amp;idx=1&amp;sn=23bf774d1aef130d687887222bf78483&amp;scene=21#wechat_redirect">使用Claude Code Router轻松切换各种高性价比模型</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493089&amp;idx=1&amp;sn=4e33af0b23b37d0af26f0ca1da004ed6&amp;scene=21#wechat_redirect">Claude Code CLI MCP配置很难？三种方式轻松掌握</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493125&amp;idx=1&amp;sn=853ce6c8f920ef0d86b0b1820f8d0a3f&amp;scene=21#wechat_redirect">深入了解Claude Code CLI自定义命令</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493143&amp;idx=1&amp;sn=e7cbb66cacd921cb934f3aaeda3bf30d&amp;scene=21#wechat_redirect">深入了解Claude Code CLI子代理Subagent</a></li>
</ul>
<h2 id="当前使用版本">当前使用版本</h2>
<p>1.0.128 (Claude Code)</p>
<h2 id="配置文件">配置文件</h2>
<p>Claude Code CLI钩子配置在 settings.json文件，提供了 用户(全局)配置、项目配置、本地项目配置 3种配置方式：</p>
<ul>
<li>用户(全局)配置：作用于当前用户下单所有项目，路径：~/.claude/settings.json</li>
<li>项目配置：作用于特定项目，路径：.claude/settings.json</li>
<li>本地项目配置：作用于特定本地项目(git忽略)，路径：.claude/settings.local.json</li>
</ul>
<p>钩子由匹配器组织，每个匹配器可以有多个钩子， 格式如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;EventName&#34;: [ { &#34;matcher&#34;: &#34;ToolPattern&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;your-command-here&#34;, &#34;timeout&#34;: 100 } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>matcher：匹配工具名称的模式，区分大小写（仅适用于 PreToolUse 和 PostToolUse）</p>
</li>
<li>
<p>支持字符串匹配， 例如：Write匹配写入工具，Bash匹配Shell命令</p>
</li>
<li>
<p>支持正则表达式，例如：Edit|Write 或者 Notebook.*</p>
</li>
<li>
<p>使用 * 匹配所有工具，也可以不配置或者使用 &quot;&quot;</p>
</li>
<li>
<p>hooks：模式匹配时要执行的命令数组</p>
</li>
<li>
<p>type：目前仅支持command</p>
</li>
<li>
<p>command：要执行的Shell命令（可以使用 $CLAUDE_PROJECT_DIR 等环境变量）</p>
</li>
<li>
<p>timeout：（可选）在取消该特定命令之前，命令应运行多长时间（以秒为单位）</p>
</li>
</ul>
<h2 id="hook事件及匹配器">Hook事件及匹配器</h2>
<p>Claude Code提供了几个在工作流程不同时间点运行的Hook事件，其中不同的Hook事件提供了不同的匹配器。</p>
<h3 id="hook事件">Hook事件</h3>
<p>Claude Code Hook事件：</p>
<ul>
<li>PreToolUse：在工具调用之前运行（可以阻止它们）</li>
<li>PostToolUse：在工具调用完成后运行</li>
<li>UserPromptSubmit：在用户提交提示词时运行，在 Claude 处理之前</li>
<li>Notification：在 Claude Code 发送通知时运行</li>
<li>Stop：在 Claude Code 完成响应时运行</li>
<li>SubagentStop：在子代理任务完成时运行</li>
<li>PreCompact：在 Claude Code 即将运行压缩操作之前运行</li>
<li>SessionStart：在 Claude Code 开始新会话或恢复现有会话时运行</li>
<li>SessionEnd：在 Claude Code 会话结束时运行</li>
</ul>
<h3 id="pretooluse和posttooluse匹配器">PreToolUse和PostToolUse匹配器</h3>
<p>PreToolUse、PostToolUse常见匹配器：</p>
<ul>
<li>Task：子代理任务</li>
<li>Bash： Shell 命令</li>
<li>Glob： 文件模式匹配</li>
<li>Grep：内容搜索</li>
<li>Read：文件读取</li>
<li>Edit：编辑</li>
<li>MultiEdit：多重编辑</li>
<li>Write：文件写入</li>
<li>WebFetch：Web拉取</li>
<li>WebSearch：Web搜索</li>
</ul>
<h3 id="precompact匹配器">PreCompact匹配器</h3>
<p>PreCompact常见匹配器：</p>
<ul>
<li>manual：从 /compact 调用</li>
<li>auto：从自动压缩调用（由于完整上下文窗口）</li>
</ul>
<h3 id="sessionstart匹配器">SessionStart匹配器</h3>
<p>SessionStart常见匹配器：</p>
<ul>
<li>startup：从启动调用</li>
<li>resume：从 &ndash;resume、&ndash;continue 或 /resume 调用</li>
<li>clear：从 /clear 调用</li>
<li>compact：从自动或手动压缩调用</li>
</ul>
<h3 id="sessionend匹配器">SessionEnd匹配器</h3>
<p>SessionEnd常见匹配器：</p>
<ul>
<li>clear：使用 /clear 命令清除会话</li>
<li>logout：用户注销</li>
<li>prompt_input_exit：用户在提示输入可见时退出</li>
<li>other：其他退出原因</li>
</ul>
<h2 id="基本使用">基本使用</h2>
<p>Claude Code CLI提供了创建Hooks的交互式命令，对交互式命令创建Hooks流程还不了解的小伙伴可以看往期内容：<a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247492929&amp;idx=1&amp;sn=043e21a18f31f1c4c68bf4ee63e28685&amp;scene=21#wechat_redirect">Claude Code CLI初体验</a></p>
<p>在使用示例中我们主要以使用手动配置为主。</p>
<h3 id="读取命令行参数">读取命令行参数</h3>
<p>钩子输入JSON格式可以查看官网文档：<a href="https://docs.anthropic.com/en/docs/claude-code/hooks#hook-input">https://docs.anthropic.com/en/docs/claude-code/hooks#hook-input</a></p>
<p>从命令行读取输入参数主要用到jq，简单了解一下jq。</p>
<p>jq是一个轻量级且灵活的命令行 JSON 处理器，它可以对 JSON 数据进行解析、提取、转换和格式化等操作，广泛应用于在 Shell 脚本中处理 JSON 数据，或者在命令行下快速查看和处理 JSON 格式的文件或输出。</p>
<p>jq官网：<a href="https://jqlang.org/">https://jqlang.org/</a></p>
<p>以macOS为例，可以使用brew安装jq</p>
<p>在 .claude/settings.local.json添加如下配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PreToolUse&#34;: [ { &#34;matcher&#34;: &#34;Bash&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;jq -r &#39;\&#34;\\(.tool_input.command) - \\(.tool_input.description // \&#34;No description\&#34;)\&#34;&#39; &gt;&gt; ~/.claude/bash-command-log.txt&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，让Claude Code运行一个简单的命令，比如 ls</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/34807202510242038478zD5Hwei.jpg" />   
    </p>
<p>执行完成后，可以看到在项目目录下多了一个 bash-command-log.txt文件，内容为 ls - List files in current directory正是Claude Code执行的ls命令及ls命令描述</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/4578820251024203847M6h4Kmp2.jpg" />   
    </p>
<h3 id="代码格式化">代码格式化</h3>
<p>通过命令行也可以实现代码格式化功能，编辑文件后自动格式化文件，这里以格式化TypeScript文件为例，在 .claude/settings.local.json添加如下配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PostToolUse&#34;: [ { &#34;matcher&#34;: &#34;Edit|MultiEdit|Write&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;jq -r &#39;.tool_input.file_path&#39; | { read file_path; if echo \&#34;$file_path\&#34; | grep -q &#39;\\.ts$&#39;; then npx prettier --write \&#34;$file_path\&#34;; fi; }&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>随便创建一个ts文件，输入示例内容</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/4008220251024203847RZ69Z5ks.jpg" />   
    </p>
<p>重启Claude Code CLI，修改ts文件内容</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/64722202510242038476mm4QXrL.jpg" />   
    </p>
<p>使用 Ctrl+R 快捷键查看详细调用信息，可以看到调了 PostToolUse:Edit钩子并执行了自定义的钩子命令</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/5079620251024203847G6jPsBrl.jpg" />   
    </p>
<h3 id="执行脚本">执行脚本</h3>
<p>从前面例子可以看到Shell命令很强大，通过Hooks事件配合Shell命令可以完成很多事件，但是Shell命令自身也有很多局限性，如需要一定学习成本，对于某些复杂和需要灵活定义的场景表现力不从心，不过我们没必要担心，因为Claude Code CLI也支持调用脚本。其次就是使用Shell命令我们无法查看工具调用的输入参数，导致很多脚本基本上都是在盲写，只有通过验证才看到脚本的错误，这些问题通过脚本将不复存在。</p>
<p><strong>执行Shell脚本</strong></p>
<p>在Hooks中使用脚本也很简单，只需要将 command执行内容改成脚本执行方式即可</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;UserPromptSubmit&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;sh ./hello.sh&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>在项目根目录创建 hello.sh脚本文件，脚本内容如下：</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/7955320251024203847Nc7lO3pK.jpg" />   
    </p>
<p>重启Claude Code CLI，在交互模式随便输入提示词</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/14588202510242038478SLsoHoo.jpg" />   
    </p>
<p>在Claude Code CLI Hooks事件中也可以使用环境变量 CLAUDE_PROJECT_DIR(仅限于Claude Code CLI Hooks命令中使用) 来引用项目脚本</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PostToolUse&#34;: [ { &#34;matcher&#34;: &#34;Write|Edit&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;sh $CLAUDE_PROJECT_DIR/.claude/hooks/hello.sh&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>执行Python脚本</strong></p>
<p>我们也可以使用Python脚本，修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;UserPromptSubmit&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;python $CLAUDE_PROJECT_DIR/.claude/hooks/hooks_input.py&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建 .claude/hooks/hooks_input.py脚本，注意在Hooks命令中工具调用参数是以标准输入输出方式传递的，使用Python读取参数需要从 sys.stdin中读取</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/7469420251024203847CxsfHFqW.jpg" />   
    </p>
<p>重启Claude Code CLI，在交互模式读取或修改任意文件内容，使用 Ctrl+R快捷键查看详细调用信息</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/2009420251024203848gv5xLYry.jpg" />   
    </p>
<p>将钩子改为 PostToolUse输出信息如下</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/1837420251024203848oPuuZtkn.jpg" />   
    </p>
<p><strong>执行Ruby脚本</strong></p>
<p>执行Ruby脚本和其他两种脚本方式类似，修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PostToolUse&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;ruby $CLAUDE_PROJECT_DIR/.claude/hooks/hooks_input.rb&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建.claude/hooks/hooks_input.rb脚本</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/2602320251024203848qvSOQkof.jpg" />   
    </p>
<p>重启Claude Code CLI，在交互模式读取或修改任意文件内容，使用 Ctrl+R快捷键查看详细调用信息</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/8399120251024203848JggxCVrO.jpg" />   
    </p>
<h3 id="触发通知">触发通知</h3>
<p>借助Hooks事件和苹果脚本我们可以在需要的时候手动触发系统通知，首先修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;UserPromptSubmit&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;osascript -e &#39;display notification \&#34;Awaiting your input\&#34; with title \&#34;Claude Code\&#34; sound name \&#34;default\&#34;&#39;&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，输入任意提示词，就会系统右侧看到通知信息</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/9992620251024203848qUqywchJ.jpg" />   
    </p>
<h3 id="文件保护">文件保护</h3>
<p>使用脚本可以阻止对敏感文件的编辑，修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PreToolUse&#34;: [ { &#34;matcher&#34;: &#34;Edit|MultiEdit|Write&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;python -c \&#34;import json, sys; data=json.load(sys.stdin); path=data.get(&#39;tool_input&#39;,{}).get(&#39;file_path&#39;,&#39;&#39;); sys.exit(2 if any(p in path for p in [&#39;.env&#39;, &#39;package-lock.json&#39;, &#39;.git/&#39;]) else 0)\&#34;&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，输入任意提示词</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/5554120251024203848520kyxrn.jpg" />   
    </p>
<p>当编辑或写入安全目录时就会触发安全拦截阻止文件编辑和写入</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/2022420251024203848hzargofK.jpg" />   
    </p>
<h3 id="敏感提示词过滤">敏感提示词过滤</h3>
<p>在 .claude/hooks/创建一个 sensitive_prompt.py脚本文件</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#!/usr/bin/env python3 import json import sys import re import datetime # Load input from stdin try: input_data = json.load(sys.stdin) except json.JSONDecodeError as e: print(f&#34;Error: Invalid JSON input: {e}&#34;, file=sys.stderr) sys.exit(1) prompt = input_data.get(&#34;prompt&#34;, &#34;&#34;) # Check for sensitive patterns sensitive_patterns = [ (r&#34;(?i)\b(password|secret|key|token)\s*[:=]&#34;, &#34;Prompt contains potential secrets&#34;), ] for pattern, message in sensitive_patterns: if re.search(pattern, prompt): # Use JSON output to block with a specific reason output = { &#34;decision&#34;: &#34;block&#34;, &#34;reason&#34;: f&#34;Security policy violation: {message}. Please rephrase your request without sensitive information.&#34; } print(json.dumps(output)) sys.exit(0) # Add current time to context context = f&#34;Current time: {datetime.datetime.now()}&#34; print(context) &#34;&#34;&#34; The following is also equivalent: print(json.dumps({ &#34;hookSpecificOutput&#34;: { &#34;hookEventName&#34;: &#34;UserPromptSubmit&#34;, &#34;additionalContext&#34;: context, }, })) &#34;&#34;&#34; # Allow the prompt to proceed with the additional context sys.exit(0)
</span></span></code></pre></td></tr></table>
</div>
</div><p>代码中输出使用了 &ldquo;decision&rdquo;: &ldquo;block&rdquo;，官方文档列举了permissionDecision的几种状态值，更详细内容查看官方文档：<a href="https://docs.anthropic.com/en/docs/claude-code/hooks#sessionstart-decision-control">https://docs.anthropic.com/en/docs/claude-code/hooks#sessionstart-decision-control</a></p>
<p>PreToolUse决策控制：</p>
<ul>
<li>allow：绕过权限系统，向用户显示，但不向 Claude 显示(approve已弃用，使用allow代替)</li>
<li>deny：会阻止工具调用执行，显示给 Claude(block已弃用，使用deny代替)</li>
<li>ask：要求用户在 UI 中确认工具调用，向用户显示，但不向 Claude 显示</li>
</ul>
<p>PostToolUse决策控制：</p>
<ul>
<li>block：会自动提示 Claude</li>
<li>undefined：不执行任何作</li>
</ul>
<p>UserPromptSubmit决策控制：</p>
<ul>
<li>block：阻止处理提示，向用户显示，但不会添加到上下文中</li>
<li>undefined：允许提示正常进行</li>
</ul>
<p>Stop/SubagentStop决策控制：</p>
<ul>
<li>block： 阻止 Claude 停止，必须填充 reason 让 Claude 知道如何继续</li>
<li>undefined：允许 Claude 停止</li>
</ul>
<p>修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;UserPromptSubmit&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;python $CLAUDE_PROJECT_DIR/.claude/hooks/sensitive_prompt.py&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，输入带有关键词 password 、secret 的提示词就会触发敏感词拦截</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/3987020251024203848ItR8aJmP.jpg" />   
    </p>
<p>不涉及敏感词则打印时间，继续任务</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/5509420251024203849Srd8qNhq.jpg" />   
    </p>
<h3 id="markdown格式化">Markdown格式化</h3>
<p>该示例功能为自动修复Markdown文件中缺少的语言标记和格式问题，在 .claude/hooks/创建一个 markdown_formatter.py脚本文件</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#!/usr/bin/env python3 &#34;&#34;&#34; Markdown formatter for Claude Code output. Fixes missing language tags and spacing issues while preserving code content. &#34;&#34;&#34; import json import sys import re import os def detect_language(code): &#34;&#34;&#34;Best-effort language detection from code content.&#34;&#34;&#34; s = code.strip() # JSON detection if re.search(r&#39;^\s*[{\[]&#39;, s): try: json.loads(s) return &#39;json&#39; except: pass # Python detection if re.search(r&#39;^\s*def\s+\w+\s*\(&#39;, s, re.M) or \ re.search(r&#39;^\s*(import|from)\s+\w+&#39;, s, re.M): return &#39;python&#39; # JavaScript detection if re.search(r&#39;\b(function\s+\w+\s*\(|const\s+\w+\s*=)&#39;, s) or \ re.search(r&#39;=&gt;|console\.(log|error)&#39;, s): return &#39;javascript&#39; # Bash detection if re.search(r&#39;^#!.*\b(bash|sh)\b&#39;, s, re.M) or \ re.search(r&#39;\b(if|then|fi|for|in|do|done)\b&#39;, s): return &#39;bash&#39; # SQL detection if re.search(r&#39;\b(SELECT|INSERT|UPDATE|DELETE|CREATE)\s+&#39;, s, re.I): return &#39;sql&#39; return &#39;text&#39; def format_markdown(content): &#34;&#34;&#34;Format markdown content with language detection.&#34;&#34;&#34; # Fix unlabeled code fences def add_lang_to_fence(match): indent, info, body, closing = match.groups() if not info.strip(): lang = detect_language(body) return f&#34;{indent}```{lang}\n{body}{closing}\n&#34; return match.group(0) fence_pattern = r&#39;(?ms)^([ \t]{0,3})```([^\n]*)\n(.*?)(\n\1```)\s*$&#39; content = re.sub(fence_pattern, add_lang_to_fence, content) # Fix excessive blank lines (only outside code fences) content = re.sub(r&#39;\n{3,}&#39;, &#39;\n\n&#39;, content) return content.rstrip() + &#39;\n&#39; # Main execution try: input_data = json.load(sys.stdin) file_path = input_data.get(&#39;tool_input&#39;, {}).get(&#39;file_path&#39;, &#39;&#39;) if not file_path.endswith((&#39;.md&#39;, &#39;.mdx&#39;)): sys.exit(0) # Not a markdown file if os.path.exists(file_path): with open(file_path, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f: content = f.read() formatted = format_markdown(content) if formatted != content: with open(file_path, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f: f.write(formatted) print(f&#34;✓ Fixed markdown formatting in {file_path}&#34;) except Exception as e: print(f&#34;Error formatting markdown: {e}&#34;, file=sys.stderr) sys.exit(1)
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PostToolUse&#34;: [ { &#34;matcher&#34;: &#34;Edit|MultiEdit|Write&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;python $CLAUDE_PROJECT_DIR/.claude/hooks/markdown_formatter.py&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，让AI帮我们创建一个Markdown任务列表，创建完成会触发 PostToolUse:Write钩子</p>
<p>在任务列表添加一个未格式化的代码块</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/9494620251024203849Z5hhSen3.jpg" />   
    </p>
<p>重新让AI添加一些任务项，此时会触发 PostToolUse:Edit钩子</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/4294720251024203849an2VtFjP.jpg" />   
    </p>
<p>格式化完成后，可以看到代码块也被标记上了指定语言类型</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/2124820251024203849WnEmwgjy.jpg" />   
    </p>
<h3 id="自动批准">自动批准</h3>
<p>在 .claude/hooks/创建一个 auto-approval.py脚本文件，添加脚本内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#!/usr/bin/env python3 import json import sys # Load input from stdin try: input_data = json.load(sys.stdin) except json.JSONDecodeError as e: print(f&#34;Error: Invalid JSON input: {e}&#34;, file=sys.stderr) sys.exit(1) tool_name = input_data.get(&#34;tool_name&#34;, &#34;&#34;) tool_input = input_data.get(&#34;tool_input&#34;, {}) # Example: Auto-approve file reads for documentation files if tool_name == &#34;Read&#34;: file_path = tool_input.get(&#34;file_path&#34;, &#34;&#34;) if file_path.endswith((&#34;.md&#34;, &#34;.mdx&#34;, &#34;.txt&#34;, &#34;.json&#34;)): # Use JSON output to auto-approve the tool call output = { &#34;decision&#34;: &#34;approve&#34;, &#34;reason&#34;: &#34;Documentation file auto-approved&#34;, &#34;suppressOutput&#34;: True # Don&#39;t show in transcript mode } print(json.dumps(output)) sys.exit(0) # For other cases, let the normal permission flow proceed sys.exit(0)
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PreToolUse&#34;: [ { &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;python $CLAUDE_PROJECT_DIR/.claude/hooks/auto-approval.py&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，让AI执行读取文件操作触发 PreToolUse:Read钩子</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/3435320251024203849fFiizuj9.jpg" />   
    </p>
<h3 id="mcp钩子">MCP钩子</h3>
<p>在Claude Code CLI中MCP 工具遵循模式 mcp__<!-- raw HTML omitted -->__<!-- raw HTML omitted -->，例如：</p>
<ul>
<li>mcp__filesystem__read_file：文件系统服务器的读取文件工具</li>
<li>mcp__context7__resolve-library-id：context7获取仓库ID</li>
<li>mcp__github__search_repositories： GitHub 服务器的搜索工具</li>
</ul>
<p>修改 settings.local.json 配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{ &#34;hooks&#34;: { &#34;PreToolUse&#34;: [ { &#34;matcher&#34;: &#34;mcp__context7__.*&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;echo &#39;context7 operation&#39;&#34; } ] }, { &#34;matcher&#34;: &#34;mcp__.*__write.*&#34;, &#34;hooks&#34;: [ { &#34;type&#34;: &#34;command&#34;, &#34;command&#34;: &#34;echo &#39;mcp write&#39;&#34; } ] } ] } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Claude Code CLI，输入提示词</p>
<p>当AI调用context7 MCP工具时就会触发 PreToolUse:mcp__context7__.*钩子</p>
<p>
        <img class="mx-auto" alt="" src="https://api.995120.cn/ecgdata/other/2025-10-24/26053202510242038491v2cpxmX.jpg" />   
    </p>
<h2 id="总结">总结</h2>
<p>Claude Code CLI提供了功能强大的Hooks事件及反馈机制，开发者可以使用自己熟悉的不同类型脚本来完成自定义Hooks操作，除了示例中的代码格式化、系统通知、文件保护以及敏感词拦截等还可以利用Hooks做更多事情，比如任务完成进行语音提示、任务完成自动触发commit等等都是可以的，场景越多越能感受到SubAgent虽然强大，Hooks才是Claude Code CLI的革命性创新。</p>
<h2 id="友情提示">友情提示</h2>
<p>见原文：<a href="https://mp.weixin.qq.com/s/9zHWqeUakAPEdX7RZvfn3w">Hooks才是Claude Code CLI 的革命性更新</a></p>
<blockquote>
<p>本文同步自微信公众号 &ldquo;<a href="https://mp.weixin.qq.com/s/9zHWqeUakAPEdX7RZvfn3w">程序员小溪</a>&rdquo; ，这里只是同步，想看及时消息请移步我的公众号，不定时更新我的学习经验。友情提示友情提示</p>
</blockquote>

        </div>

        <div>免责声明：以上用于市场研究、讨论和交流之目的</div>
<form style="border:1px solid #ccc;padding:3px;text-align:center;" action="https://tinyletter.com/sblig" method="post"
    target="popupwindow"
    onsubmit="window.open('https://tinyletter.com/sblig', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>
        <label for="tlemail" style="color:red;font-weight: 800;">一起学炒股+v: yqw17170<br /><br />备注：炒股</label><br /><br />
        <label for="tlemail">订阅每周最新投资资讯和动向</label>
    </p>
    <p>
        <input type="text" style="width:140px" name="email" id="tlemail" />
    </p>
    <input type="hidden" value="1" name="embed" />
    <input type="submit" value="邮箱订阅" />
</form>

<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://index.zshipu.com/stock003/">知识铺</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://index.zshipu.com/stock003/post/20251022/Hooks%E6%89%8D%E6%98%AFClaude-Code-CLI-%E7%9A%84%E9%9D%A9%E5%91%BD%E6%80%A7%E6%9B%B4%E6%96%B0/">https://index.zshipu.com/stock003/post/20251022/Hooks%E6%89%8D%E6%98%AFClaude-Code-CLI-%E7%9A%84%E9%9D%A9%E5%91%BD%E6%80%A7%E6%9B%B4%E6%96%B0/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license"
                href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
        <li><strong>免责声明：</strong>本页面内容均来源于站内编辑发布，部分信息来源互联网，并不意味着本站赞同其观点或者证实其内容的真实性，如涉及版权等问题，请立即联系客服进行更改或删除，保证您的合法权益。转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。也可以邮件至
            sblig@126.com</li>
    </ul>
</div>
<br />


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/stock003/post/20251022/General-Agent-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%80%9A%E7%94%A8%E5%8F%AF%E5%AE%9A%E5%88%B6%E7%9A%84Agent%E6%A1%86%E6%9E%B6/">General Agent 一个简单、通用、可定制的Agent框架 --知识铺</a></li>
        
        <li><a href="/stock003/post/20251022/DeepSeek-OCR%E5%83%8F%E4%BA%BA%E4%B8%80%E6%A0%B7%E6%84%9F%E7%9F%A5%E4%BA%8C%E7%BB%B4%E4%BF%A1%E6%81%AF/">DeepSeek-OCR：像人一样感知二维信息 --知识铺</a></li>
        
        <li><a href="/stock003/post/20251022/Claude-Code-CLI-MCP%E9%85%8D%E7%BD%AE%E5%BE%88%E9%9A%BE%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F%E8%BD%BB%E6%9D%BE%E6%8E%8C%E6%8F%A1/">Claude Code CLI MCP配置很难？三种方式轻松掌握 --知识铺</a></li>
        
        <li><a href="/stock003/post/20251022/Anthropic%E4%B8%8A%E7%BA%BF%E7%BD%91%E9%A1%B5%E7%89%88Claude-Code/">Anthropic上线网页版Claude Code --知识铺</a></li>
        
        <li><a href="/stock003/post/20251022/17%E4%B8%AA%E4%B8%BB%E6%B5%81-Agent-%E6%A1%86%E6%9E%B6%E5%BF%AB%E9%80%9F%E5%AF%B9%E6%AF%94/">17个主流 Agent 框架快速对比 --知识铺</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "zshipu/zshipu-index"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://index.zshipu.com/stock003/">股票资讯  --  知识铺 By 知识铺</a>
        
        | <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">浙 ICP 备19032823号-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/stock003/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://index.zshipu.com/stock003/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://index.zshipu.com/stock003/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/2025%E5%B9%B410%E6%9C%8828%E6%97%A5-A%E8%82%A1%E5%A4%8D%E7%9B%98/" title="2025年10月28日 A股复盘 --知识铺">2025年10月28日 A股复盘 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/A%E8%82%A1%E6%94%B6%E7%9B%98%E5%BF%AB%E6%8A%A5%E6%B2%AA%E6%8C%874000%E7%82%B9%E5%BE%97%E8%80%8C%E5%A4%8D%E5%A4%B1-%E7%A6%8F%E5%BB%BA%E6%9D%BF%E5%9D%97%E6%8E%80%E8%B5%B7%E6%B6%A8%E5%81%9C%E6%BD%AE%E6%B2%AA%E6%8C%87/" title="【A股收盘快报】沪指4000点得而复失 福建板块掀起涨停潮沪指 --知识铺">【A股收盘快报】沪指4000点得而复失 福建板块掀起涨停潮沪指 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/A%E8%82%A1%E6%94%B6%E8%AF%84%E6%B2%AA%E6%8C%874000%E7%82%B9%E5%BE%97%E8%80%8C%E5%A4%8D%E5%A4%B1%E4%B8%89%E5%A4%A7%E6%8C%87%E6%95%B0%E9%9B%86%E4%BD%93%E4%B8%8B%E8%B7%8C%E7%A6%8F%E5%BB%BA%E8%82%A1%E5%A4%A7%E9%9D%A2%E7%A7%AF%E6%B6%A8%E5%81%9C_%E8%B4%A2%E7%BB%8F%E9%A2%91%E9%81%93_%E8%AF%81%E5%88%B8%E4%B9%8B%E6%98%9F/" title="A股收评：沪指4000点得而复失！三大指数集体下跌，福建股大面积涨停_财经频道_证券之星 --知识铺">A股收评：沪指4000点得而复失！三大指数集体下跌，福建股大面积涨停_财经频道_证券之星 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/%E6%97%B6%E9%9A%94%E5%8D%81%E5%B9%B4%E6%B2%AA%E6%8C%87%E9%87%8D%E4%B8%8A4000%E7%82%B9A%E8%82%A1%E8%BF%99%E8%BD%AE%E7%89%9B%E5%B8%82%E5%B0%86%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C%E6%8C%81%E7%BB%AD%E5%A4%9A%E4%B9%85%E6%B2%AA%E6%8C%87/" title="时隔十年，沪指重上4000点！A股这轮“牛市”将有何不同？持续多久？沪指 --知识铺">时隔十年，沪指重上4000点！A股这轮“牛市”将有何不同？持续多久？沪指 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/%E4%B8%8A%E8%AF%81%E6%8C%87%E6%95%B0%E6%97%B6%E9%9A%94%E5%8D%81%E5%B9%B4%E5%86%8D%E4%B8%8A4000%E7%82%B9%E6%88%90%E4%BA%A4%E9%A2%9D%E4%BB%8D%E5%BE%85%E6%94%BE%E9%87%8F/" title="上证指数时隔十年再上4000点，成交额仍待放量 --知识铺">上证指数时隔十年再上4000点，成交额仍待放量 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/10%E6%9C%8828%E6%97%A5%E6%99%9A%E9%97%B4%E6%B2%AA%E6%B7%B1%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E9%87%8D%E5%A4%A7%E4%BA%8B%E9%A1%B9%E5%85%AC%E5%91%8A%E6%9C%80%E6%96%B0%E5%BF%AB%E9%80%92/" title="10月28日晚间沪深上市公司重大事项公告最新快递 _ --知识铺">10月28日晚间沪深上市公司重大事项公告最新快递 _ --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/%E6%B2%AA%E6%8C%87%E7%A0%B44000%E7%82%B9%E8%82%A1%E5%90%A7%E7%82%B8%E4%BA%86%E8%BF%9C%E7%A6%BB%E8%80%81%E7%99%BB%E8%82%A1%E5%B9%B4%E5%86%85%E7%94%B5%E5%AD%9046%E6%B6%A8%E5%B9%85%E7%A2%BE%E5%8E%8B%E9%A3%9F%E5%93%81%E9%A5%AE%E6%96%996/" title="沪指破4000点股吧炸了！“远离老登股”，年内电子46%涨幅碾压食品饮料6% --知识铺">沪指破4000点股吧炸了！“远离老登股”，年内电子46%涨幅碾压食品饮料6% --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/%E6%B2%AA%E6%B7%B1300%E6%8C%87%E6%95%B0ETF515310%E6%B6%A80.29%E5%8D%8A%E6%97%A5%E6%88%90%E4%BA%A4%E9%A2%9D1587.80%E4%B8%87%E5%85%83%E6%B2%AA%E6%B7%B1300%E6%8C%87%E6%95%B0/" title="沪深300指数ETF（515310）涨0.29%，半日成交额1587.80万元沪深300指数 --知识铺">沪深300指数ETF（515310）涨0.29%，半日成交额1587.80万元沪深300指数 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/A%E8%82%A110%E5%B9%B4%E8%BD%AE%E5%9B%9E%E9%87%8D%E8%BF%944000%E7%82%B9%E5%A4%A7%E5%85%B3%E7%A7%91%E6%8A%80%E5%BC%95%E9%A2%86%E7%BB%93%E6%9E%84%E7%89%9B-21%E7%BB%8F%E6%B5%8E%E7%BD%91/" title="A股10年轮回重返4000点大关，科技引领“结构牛” - 21经济网 --知识铺">A股10年轮回重返4000点大关，科技引领“结构牛” - 21经济网 --知识铺</a>
    </li>
    
    <li>
        <a href="https://index.zshipu.com/stock003/post/20251027/%E6%B2%AA%E6%8C%87%E6%97%B6%E9%9A%94%E5%8D%81%E5%B9%B4%E5%86%8D%E4%B8%8A4000%E7%82%B9%E8%BF%99%E6%AC%A1%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C_%E4%B8%AD%E5%9B%BD%E7%BD%91/" title="沪指时隔十年再上4000点，这次有何不同？_中国网 --知识铺">沪指时隔十年再上4000点，这次有何不同？_中国网 --知识铺</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="一起上 Comet，AI 工具免费用还送钱～" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250843697.png">
                
            </a>
        </li>
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="邀请有礼 🎁 一起用 Comet，AI 助你更高效还送钱！" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250850822.png">
                
            </a>
        </li>
        
        <li>
            <a href="https://pplx.ai/sblig3912" title="AI 工具真香！我用的 Comet 免费送一个月 Pro～" target="_blank" style="color:red">
                
                    <img src="https://cdn.jsdelivr.net/gh/zshipu/images/2025/202510250851688.png">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title"><a href='/stock003/categories/'>分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/stock003/tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://geek.zshipu.com//" title="知识铺的博客">知识铺的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://index.zshipu.com/stock003/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>
<script
  src="https://js.sentry-cdn.com/5c69c7b20860be9ded39ad4778ddc21e.min.js"
  crossorigin="anonymous"
></script>

</html>