# PRD Part 4: 核心功能设计

## 7. 核心功能设计（基于1+8架构重构）

### 7.1 功能架构总览

```
【第一层：数据感知】
├─ 设备管理与数据采集
├─ 数据质量控制
└─ 多源数据同步

【第二层：AI分析】
├─ 实时监测与预警
├─ 多模态数据融合
├─ 风险预测与因果分析
└─ 个性化基线学习

【第三层：智能服务】
├─ 健康档案与趋势分析
├─ 智能提醒与干预
├─ 运动/饮食/用药管理
└─ 医疗服务对接

【第四层：生态协作】
├─ 家庭守护
├─ 医患协同
├─ 社区互助
└─ 保险/药企合作
```

---

### 7.2 功能1：AI健康大脑 - 核心引擎

**定位**：产品的"灵魂"，所有智能功能的底层支撑

#### 7.2.1 实时健康监护

**24/7全天候监测**：
```
监测策略：
├─ 心电：连续监测，异常触发深度分析
├─ 血氧：每5分钟采样（可调）
├─ 血压：每日固定时间（晨起/睡前）+ 症状时测量
├─ 体温：连续监测，异常波动触发
├─ 睡眠：夜间自动监测
├─ 运动：运动开始自动识别
├─ 呼吸：从心电实时推导
└─ 压力：HRV持续计算

异常检测分级响应：
🟢 轻度异常（记录）
├─ 偶发室早、房早（<10次/小时）
├─ 血压轻度波动（±5mmHg）
└─ 血氧短暂下降（>93%）

🟡 中度异常（提醒）
├─ 频发室早（10-30次/小时）
├─ ST段轻微压低（0.05-0.1mV）
├─ 血压持续偏高（140-160/90-100）
├─ 夜间血氧下降（90-93%）
└─ App推送 + 记录到健康档案

🟠 重度异常（警告）
├─ 室性心动过速（3个以上连续室早）
├─ ST段明显压低（>0.1mV）
├─ 血压危象（>180/110）
├─ 血氧危险（<90%）
└─ 手表震动 + 声音警报 + 推送家属

🔴 危急异常（救援）
├─ 室颤、室扑
├─ 极端心动过缓（<40 bpm）
├─ 血氧急降（<85%）
└─ 自动拨打120 + 紧急联系人 + 发送定位
```

#### 7.2.2 AI风险预测大脑

**7天风险预测模型**：
```
输入数据（滑动窗口：过去7天）：
├─ 心电数据：HRV趋势、心律失常频次、ST段变化
├─ 血压数据：平均值、变异性、昼夜节律
├─ 血氧数据：夜间脱饱和指数、运动时血氧
├─ 睡眠数据：睡眠质量评分、觉醒频次
├─ 运动数据：运动量、心率恢复能力
├─ 用药数据：依从性、药物调整
├─ 症状数据：胸闷、心悸、头晕次数
└─ 环境数据：天气、气压、温度

AI模型处理：
├─ 特征工程：260+维度特征提取
├─ 时序建模：LSTM捕捉时间依赖
├─ 多模态融合：注意力机制加权
├─ 风险评分：0-100分

输出：
┌────────────────────────────────┐
│  未来7天心血管事件风险曲线      │
├────────────────────────────────┤
│  100├                          │
│   90├                          │
│   80├                          │
│   70├                          │
│   60├                          │
│   50├                          │
│   40├              ╱╲          │
│   30├            ╱    ╲        │
│   20├  ╱╲      ╱      ╲       │
│   10├╱  ╲    ╱        ╲      │
│    0└─────────────────────────│
│      今 明 后 D4 D5 D6 D7     │
└────────────────────────────────┘

风险分析：
• 今天：18分（低风险）✅
• D3：峰值38分（中风险）⚠️
  └─ 原因：预计工作压力大 + 睡眠不足
  └─ 建议：避免剧烈运动，注意休息

关键影响因素排序：
1. 睡眠质量下降（贡献度35%）
2. HRV持续偏低（贡献度28%）
3. 血压控制欠佳（贡献度22%）
4. 运动不足（贡献度15%）
```

**个性化风险阈值学习**：
```
传统方法：
所有人用同样的阈值（如血压>140/90就是高血压）

AI大脑的做法：
学习用户的"健康基线"，识别"异常偏离"

示例：
用户A：平时血压120/75
├─ 某天血压135/85（虽未达高血压标准）
├─ 但相对基线偏离+15/+10 mmHg（超过20%）
└─ AI判断：异常，需要关注

用户B：长期血压135/88（接近高血压）
├─ 某天血压138/90
├─ 相对基线仅+3/+2 mmHg（波动正常）
└─ AI判断：正常波动，无需担心

价值：减少假阳性，提升预警精准度
```

#### 7.2.3 因果溯源引擎

**智能"为什么"回答系统**：
```
用户提问："为什么我今天血压高？"

AI分析流程：

Step 1：时间回溯
└─ 今天血压：145/92（14:30测量）
   昨天血压：132/80
   偏离：+13/+12 mmHg

Step 2：关联分析（1+8数据）
检查睡眠：
├─ 昨晚睡眠时长：5.5小时（少于基线7小时）
├─ 觉醒次数：7次（基线3次）
└─ 睡眠质量评分：52/100（差）

检查血氧：
├─ 夜间最低血氧：89%（基线95%）
├─ 脱饱和次数：15次
└─ 疑似睡眠呼吸暂停

检查HRV：
├─ 夜间HRV：35ms（基线65ms）
└─ 交感神经过度激活

检查运动：
├─ 昨日步数：2,300步（基线8,000）
└─ 久坐时长：9小时

检查用药：
├─ 降压药：按时服用
└─ 无漏服

检查情绪：
├─ 昨晚睡前心率：88 bpm（基线70）
├─ HRV低
└─ 疑似压力/焦虑

Step 3：因果推理
建立因果链：
  压力/焦虑
      ↓
  睡眠障碍（觉醒多，时长短）
      ↓
  夜间缺氧（血氧↓）
      ↓
  交感神经激活（HRV↓）
      ↓
  血管收缩 + 心率增快
      ↓
  血压升高

Step 4：AI解答
"您今天血压偏高的主要原因：

🎯 核心原因：睡眠不足（5.5小时）
   └─ 夜间觉醒7次，可能与压力/焦虑有关

🔗 连锁反应：
   睡眠差 → 夜间缺氧（血氧最低89%）
          → 交感神经激活（HRV仅35ms）
          → 血压升高

📊 影响占比：
   • 睡眠不足：50%
   • 夜间缺氧：25%
   • 久坐不动：15%
   • 其他因素：10%

💡 建议：
   1. 今晚早睡（争取7-8小时）
   2. 睡前放松（避免刷手机、深呼吸）
   3. 如持续3天睡眠差 → 建议睡眠监测
   4. 明天增加运动（快走30分钟）

🔮 预测：
   如今晚睡眠改善，明天血压预计恢复到135/85"
```

---

### 7.3 功能2：智能运动康复系统

**定位**：从"怕动"到"会动"，安全高效的心脏康复

#### 7.3.1 AI运动处方生成

**个性化运动方案**：
```
输入参数：
├─ 用户画像：年龄、性别、体重、手术类型
├─ 心功能评估：NYHA分级、射血分数（EF）
├─ 历史运动数据：基础运动能力
├─ 当前健康状态：静息心率、血压、HRV
└─ 医生建议：运动限制（如有）

AI生成处方：

【本周运动处方】支架术后3个月，张先生

目标：累计150分钟中等强度运动

┌────────────────────────────────────┐
│ 周一：快走 30分钟                   │
│ ────────────────────────────       │
│ 推荐时间：17:00-17:30（避开中午）   │
│ 推荐路线：公园环湖（平路）          │
│ 目标心率：110-125 bpm              │
│ ├─ 预热：5分钟慢走（HR 90-100）    │
│ ├─ 主运动：20分钟快走（HR 110-125）│
│ └─ 放松：5分钟慢走（HR <100）      │
│                                    │
│ 安全提醒：                         │
│ • 携带硝酸甘油                     │
│ • 如出现胸闷/心悸 → 立即停止        │
│ • 心率>140 → 自动震动提醒慢下来    │
└────────────────────────────────────┘

周三：游泳 25分钟
周五：太极拳 40分钟
周日：骑自行车 30分钟

注意事项：
⚠️ 本周禁止：
• 篮球、足球等对抗性运动
• 举重、俯卧撑等力量训练
• 憋气用力动作

✅ 鼓励：
• 有氧运动为主
• 循序渐进增加强度
• 运动后充分休息
```

#### 7.3.2 运动实时监护

**运动中智能保护**：
```
运动开始（自动识别）：
├─ 检测到步频增加 + GPS移动
├─ 提示："检测到您开始运动，实时保护已启动"
└─ 进入运动监护模式

实时监测界面：
┌────────────────────────────┐
│  🏃 快走进行中  12:35/30:00 │
│  ──────────────────────    │
│  当前心率：118 bpm ✅       │
│  目标区间：110-125 bpm     │
│  ────────────────────────  │
│  【实时心电波形】           │
│  ～～～～～～～～～        │
│  ────────────────────────  │
│  消耗热量：156 kcal        │
│  步数：2,350步             │
│  距离：1.8 km              │
│  ────────────────────────  │
│  [暂停] [结束运动]          │
└────────────────────────────┘

智能干预：

场景1：心率超出目标区间
├─ 心率升至132 bpm（超过125）
├─ 手表震动 + 语音："请放慢速度"
├─ 如5分钟内未降至125以下
└─ 强制提示："建议休息2分钟"

场景2：检测到ST段压低
├─ AI检测：ST段压低0.12mV
├─ 立即震动 + 声音警报
├─ 屏幕显示："检测到心肌缺血征象，立即停止运动"
├─ 自动推送家属："爸爸运动时出现心电异常，已提醒停止"
└─ 建议："请坐下休息，如症状持续 → 拨打120"

场景3：室性早搏突然增多
├─ 运动前：偶发室早（<5次/小时）
├─ 运动中：频发室早（>20次/小时）
├─ AI判断：运动诱发的恶性心律失常风险
└─ 提示："心律异常，建议停止运动并联系医生"
```

#### 7.3.3 运动后恢复评估

```
运动结束报告：

┌────────────────────────────────────┐
│  运动总结 - 快走 30分钟             │
│  ────────────────────────────       │
│  完成度：100% ✅                    │
│  目标达成：30/30分钟                │
│                                    │
│  【心率表现】                       │
│  • 平均心率：118 bpm（目标110-125）│
│  • 最高心率：132 bpm（超标1次）    │
│  • 心率恢复：                      │
│    └─ 1分钟后：102 bpm（↓30 bpm） │
│    └─ 2分钟后：88 bpm（↓44 bpm）  │
│    └─ 评价：恢复能力良好 ✅         │
│                                    │
│  【心电评估】                       │
│  • 运动中ST段：无明显压低 ✅        │
│  • 心律失常：偶发室早3次（正常）   │
│  • HRV：运动前65ms → 运动后48ms    │
│    └─ 5分钟后恢复至60ms ✅         │
│                                    │
│  【综合评分】                       │
│  运动质量：87/100 ✅               │
│  • 强度适中（+30分）               │
│  • 心脏反应良好（+30分）           │
│  • 恢复能力优秀（+27分）           │
│                                    │
│  💡 改进建议：                     │
│  • 有1次心率超标，下次注意控制速度 │
│  • 建议下次延长到35分钟            │
│                                    │
│  🎯 下次运动：周三（游泳）          │
└────────────────────────────────────┘

长期趋势分析（过去4周）：
├─ 运动依从性：95%（目标90%）✅
├─ 平均心率：120 → 115 bpm（↓5，心脏适应↑）
├─ 心率恢复：HRR1min：25 → 30 bpm（改善20%）
├─ 运动时长：120 → 150分钟/周（达标）
└─ 心功能评估：代谢当量 5.0 → 6.2 METs（↑24%）

医学意义：
"您的心脏储备功能正在稳步提升
 持续康复训练可降低再次心梗风险40%以上
 请继续保持！"
```

---

### 7.4 功能3：智能用药管家2.0

**定位**：从"提醒吃药"到"优化用药方案"

#### 7.4.1 药物全生命周期管理

**药物添加（智能识别）**：
```
方式1：扫描药盒
├─ 拍照药盒正面
├─ OCR识别：药品名称、规格、厂商
├─ 自动匹配药品数据库
└─ 确认：阿托伐他汀钙片 20mg × 28片

方式2：扫描处方
├─ 拍照医生处方
├─ AI识别所有药物
└─ 一键批量添加

方式3：语音输入
用户："添加降压药，氨氯地平5毫克"
AI："已识别：苯磺酸氨氯地平片 5mg，请问每天几次？"
用户："每天早上一次"
AI："已添加，设置每天8:00提醒"

自动关联：
├─ 适应症：高血压
├─ 用药目的：降低血压
├─ 注意事项：避免西柚汁
├─ 副作用：可能导致踝部水肿、头痛
└─ 监测指标：血压、心率
```

#### 7.4.2 智能用药提醒

```
常规提醒（定时）：
┌────────────────────────────┐
│  🔔 用药提醒 08:00          │
│  ──────────────────────    │
│  该服用以下药物：           │
│                            │
│  💊 苯磺酸氨氯地平片 5mg    │
│     └─ 降血压              │
│                            │
│  💊 二甲双胍 500mg         │
│     └─ 控制血糖            │
│                            │
│  注意事项：                 │
│  • 早餐后服用              │
│  • 配合足量温水吞服         │
│                            │
│  [现在服用] [稍后提醒]      │
└────────────────────────────┘

智能提醒（场景触发）：

场景1：检测到血压升高
├─ 今晨血压：148/94（偏高）
└─ 提醒："血压偏高，请记得按时服用降压药"

场景2：检测到血糖偏高（如有血糖仪）
├─ 餐后2小时血糖：10.2 mmol/L
└─ 提醒："血糖偏高，已为您记录，请按时服用降糖药"

场景3：运动前提醒
├─ 检测到准备运动
├─ 检查：今日降压药（β受体阻滞剂）已服用
└─ 提醒："您服用的美托洛尔会降低运动心率，
         请适当降低运动强度目标"
```

#### 7.4.3 用药冲突智能检测

```
实时冲突预警：

新增药物："华法林 3mg"（抗凝药）

AI自动扫描现有药物：
┌────────────────────────────────────┐
│  ⚠️ 严重用药冲突警告                │
│  ────────────────────────────       │
│  新药：华法林 3mg（抗凝）           │
│  冲突药物：阿司匹林 100mg（抗凝）   │
│                                    │
│  冲突类型：重复抗凝作用 🔴          │
│  风险等级：严重                    │
│  风险后果：出血风险显著增加（↑3倍）│
│                                    │
│  医学建议：                         │
│  • 通常不建议同时使用华法林+阿司匹林│
│  • 除非有特殊医学指征（如机械瓣膜） │
│  • 如必须联用，需要：              │
│    ├─ 每周监测INR值                │
│    ├─ 密切观察出血征象             │
│    └─ 医生紧密监督                 │
│                                    │
│  🚨 强烈建议：                     │
│  请立即联系开药医生确认！          │
│  在确认前请勿服用华法林            │
│                                    │
│  [呼叫医生] [取消添加] [我已知晓风险]│
└────────────────────────────────────┘

其他冲突类型：

中度冲突（黄色预警）：
├─ 他汀类 + 贝特类 → 肌肉损伤风险
├─ ACEI + 保钾利尿剂 → 高钾血症风险
└─ 提示注意，但不强制阻止

轻度冲突（提示）：
├─ 降压药 + 酒精 → 血压过低风险
├─ 抗生素 + 乳制品 → 吸收减少
└─ 温和提示，用户教育
```

#### 7.4.4 用药效果追踪

```
药物疗效分析报告（服药4周后）：

┌────────────────────────────────────┐
│  降压药疗效分析 - 氨氯地平 5mg      │
│  服药周期：2025-09-10 至 2025-10-09│
│  ────────────────────────────       │
│                                    │
│  【血压控制效果】                   │
│  服药前平均：142/90 mmHg           │
│  服药后平均：132/82 mmHg           │
│  改善程度：↓10/8 mmHg ✅           │
│                                    │
│  达标率：                          │
│  • 服药前：35%（<140/90）          │
│  • 服药后：78%（<140/90）          │
│  • 提升：+43% ✅                   │
│                                    │
│  【心电相关指标】                   │
│  静息心率：72 → 68 bpm（↓4）       │
│  HRV：65 → 72 ms（↑11%）           │
│  └─ 心脏负荷下降，健康状态改善 ✅   │
│                                    │
│  【副作用监测】                     │
│  • 踝部水肿：无 ✅                 │
│  • 头痛：偶有1次（轻微）           │
│  • 心悸：无                        │
│  └─ 药物耐受性良好                │
│                                    │
│  【依从性】                         │
│  按时服药：98%（漏服1次）✅        │
│                                    │
│  💡 AI评估：                       │
│  药物疗效良好，副作用轻微           │
│  建议继续当前剂量                   │
│  下次复诊：4周后（常规复查）        │
│                                    │
│  [ ] 生成报告发送给医生            │
│  [ ] 预约复诊                      │
└────────────────────────────────────┘

AI优化建议：

发现：夜间血压控制欠佳
├─ 白天血压：128/80（良好）
├─ 夜间血压：138/88（偏高）
└─ 昼夜比值：0.91（理想<0.9）

建议：调整服药时间
├─ 当前：早8:00服用
├─ 建议：改为晚8:00服用
├─ 理由：长效降压药晚服可更好控制晨峰血压
└─ 预期效果：夜间血压↓5-8 mmHg

[ ] 采纳建议（需医生确认）
[ ] 咨询医生
```

---

